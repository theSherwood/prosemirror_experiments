(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function t(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(r){if(r.ep)return;r.ep=!0;const s=t(r);fetch(r.href,s)}})();function A(i){this.content=i}A.prototype={constructor:A,find:function(i){for(var e=0;e<this.content.length;e+=2)if(this.content[e]===i)return e;return-1},get:function(i){var e=this.find(i);return e==-1?void 0:this.content[e+1]},update:function(i,e,t){var n=t&&t!=i?this.remove(t):this,r=n.find(i),s=n.content.slice();return r==-1?s.push(t||i,e):(s[r+1]=e,t&&(s[r]=t)),new A(s)},remove:function(i){var e=this.find(i);if(e==-1)return this;var t=this.content.slice();return t.splice(e,2),new A(t)},addToStart:function(i,e){return new A([i,e].concat(this.remove(i).content))},addToEnd:function(i,e){var t=this.remove(i).content.slice();return t.push(i,e),new A(t)},addBefore:function(i,e,t){var n=this.remove(e),r=n.content.slice(),s=n.find(i);return r.splice(s==-1?r.length:s,0,e,t),new A(r)},forEach:function(i){for(var e=0;e<this.content.length;e+=2)i(this.content[e],this.content[e+1])},prepend:function(i){return i=A.from(i),i.size?new A(i.content.concat(this.subtract(i).content)):this},append:function(i){return i=A.from(i),i.size?new A(this.subtract(i).content.concat(i.content)):this},subtract:function(i){var e=this;i=A.from(i);for(var t=0;t<i.content.length;t+=2)e=e.remove(i.content[t]);return e},toObject:function(){var i={};return this.forEach(function(e,t){i[e]=t}),i},get size(){return this.content.length>>1}};A.from=function(i){if(i instanceof A)return i;var e=[];if(i)for(var t in i)e.push(t,i[t]);return new A(e)};function Dr(i,e,t){for(let n=0;;n++){if(n==i.childCount||n==e.childCount)return i.childCount==e.childCount?null:t;let r=i.child(n),s=e.child(n);if(r==s){t+=r.nodeSize;continue}if(!r.sameMarkup(s))return t;if(r.isText&&r.text!=s.text){for(let o=0;r.text[o]==s.text[o];o++)t++;return t}if(r.content.size||s.content.size){let o=Dr(r.content,s.content,t+1);if(o!=null)return o}t+=r.nodeSize}}function Er(i,e,t,n){for(let r=i.childCount,s=e.childCount;;){if(r==0||s==0)return r==s?null:{a:t,b:n};let o=i.child(--r),l=e.child(--s),a=o.nodeSize;if(o==l){t-=a,n-=a;continue}if(!o.sameMarkup(l))return{a:t,b:n};if(o.isText&&o.text!=l.text){let u=0,c=Math.min(o.text.length,l.text.length);for(;u<c&&o.text[o.text.length-u-1]==l.text[l.text.length-u-1];)u++,t--,n--;return{a:t,b:n}}if(o.content.size||l.content.size){let u=Er(o.content,l.content,t-1,n-1);if(u)return u}t-=a,n-=a}}class y{constructor(e,t){if(this.content=e,this.size=t||0,t==null)for(let n=0;n<e.length;n++)this.size+=e[n].nodeSize}nodesBetween(e,t,n,r=0,s){for(let o=0,l=0;l<t;o++){let a=this.content[o],u=l+a.nodeSize;if(u>e&&n(a,r+l,s||null,o)!==!1&&a.content.size){let c=l+1;a.nodesBetween(Math.max(0,e-c),Math.min(a.content.size,t-c),n,r+c)}l=u}}descendants(e){this.nodesBetween(0,this.size,e)}textBetween(e,t,n,r){let s="",o=!0;return this.nodesBetween(e,t,(l,a)=>{let u=l.isText?l.text.slice(Math.max(e,a)-a,t-a):l.isLeaf?r?typeof r=="function"?r(l):r:l.type.spec.leafText?l.type.spec.leafText(l):"":"";l.isBlock&&(l.isLeaf&&u||l.isTextblock)&&n&&(o?o=!1:s+=n),s+=u},0),s}append(e){if(!e.size)return this;if(!this.size)return e;let t=this.lastChild,n=e.firstChild,r=this.content.slice(),s=0;for(t.isText&&t.sameMarkup(n)&&(r[r.length-1]=t.withText(t.text+n.text),s=1);s<e.content.length;s++)r.push(e.content[s]);return new y(r,this.size+e.size)}cut(e,t=this.size){if(e==0&&t==this.size)return this;let n=[],r=0;if(t>e)for(let s=0,o=0;o<t;s++){let l=this.content[s],a=o+l.nodeSize;a>e&&((o<e||a>t)&&(l.isText?l=l.cut(Math.max(0,e-o),Math.min(l.text.length,t-o)):l=l.cut(Math.max(0,e-o-1),Math.min(l.content.size,t-o-1))),n.push(l),r+=l.nodeSize),o=a}return new y(n,r)}cutByIndex(e,t){return e==t?y.empty:e==0&&t==this.content.length?this:new y(this.content.slice(e,t))}replaceChild(e,t){let n=this.content[e];if(n==t)return this;let r=this.content.slice(),s=this.size+t.nodeSize-n.nodeSize;return r[e]=t,new y(r,s)}addToStart(e){return new y([e].concat(this.content),this.size+e.nodeSize)}addToEnd(e){return new y(this.content.concat(e),this.size+e.nodeSize)}eq(e){if(this.content.length!=e.content.length)return!1;for(let t=0;t<this.content.length;t++)if(!this.content[t].eq(e.content[t]))return!1;return!0}get firstChild(){return this.content.length?this.content[0]:null}get lastChild(){return this.content.length?this.content[this.content.length-1]:null}get childCount(){return this.content.length}child(e){let t=this.content[e];if(!t)throw new RangeError("Index "+e+" out of range for "+this);return t}maybeChild(e){return this.content[e]||null}forEach(e){for(let t=0,n=0;t<this.content.length;t++){let r=this.content[t];e(r,n,t),n+=r.nodeSize}}findDiffStart(e,t=0){return Dr(this,e,t)}findDiffEnd(e,t=this.size,n=e.size){return Er(this,e,t,n)}findIndex(e,t=-1){if(e==0)return It(0,e);if(e==this.size)return It(this.content.length,e);if(e>this.size||e<0)throw new RangeError(`Position ${e} outside of fragment (${this})`);for(let n=0,r=0;;n++){let s=this.child(n),o=r+s.nodeSize;if(o>=e)return o==e||t>0?It(n+1,o):It(n,r);r=o}}toString(){return"<"+this.toStringInner()+">"}toStringInner(){return this.content.join(", ")}toJSON(){return this.content.length?this.content.map(e=>e.toJSON()):null}static fromJSON(e,t){if(!t)return y.empty;if(!Array.isArray(t))throw new RangeError("Invalid input for Fragment.fromJSON");return new y(t.map(e.nodeFromJSON))}static fromArray(e){if(!e.length)return y.empty;let t,n=0;for(let r=0;r<e.length;r++){let s=e[r];n+=s.nodeSize,r&&s.isText&&e[r-1].sameMarkup(s)?(t||(t=e.slice(0,r)),t[t.length-1]=s.withText(t[t.length-1].text+s.text)):t&&t.push(s)}return new y(t||e,n)}static from(e){if(!e)return y.empty;if(e instanceof y)return e;if(Array.isArray(e))return this.fromArray(e);if(e.attrs)return new y([e],e.nodeSize);throw new RangeError("Can not convert "+e+" to a Fragment"+(e.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))}}y.empty=new y([],0);const hn={index:0,offset:0};function It(i,e){return hn.index=i,hn.offset=e,hn}function Ht(i,e){if(i===e)return!0;if(!(i&&typeof i=="object")||!(e&&typeof e=="object"))return!1;let t=Array.isArray(i);if(Array.isArray(e)!=t)return!1;if(t){if(i.length!=e.length)return!1;for(let n=0;n<i.length;n++)if(!Ht(i[n],e[n]))return!1}else{for(let n in i)if(!(n in e)||!Ht(i[n],e[n]))return!1;for(let n in e)if(!(n in i))return!1}return!0}class M{constructor(e,t){this.type=e,this.attrs=t}addToSet(e){let t,n=!1;for(let r=0;r<e.length;r++){let s=e[r];if(this.eq(s))return e;if(this.type.excludes(s.type))t||(t=e.slice(0,r));else{if(s.type.excludes(this.type))return e;!n&&s.type.rank>this.type.rank&&(t||(t=e.slice(0,r)),t.push(this),n=!0),t&&t.push(s)}}return t||(t=e.slice()),n||t.push(this),t}removeFromSet(e){for(let t=0;t<e.length;t++)if(this.eq(e[t]))return e.slice(0,t).concat(e.slice(t+1));return e}isInSet(e){for(let t=0;t<e.length;t++)if(this.eq(e[t]))return!0;return!1}eq(e){return this==e||this.type==e.type&&Ht(this.attrs,e.attrs)}toJSON(){let e={type:this.type.name};for(let t in this.attrs){e.attrs=this.attrs;break}return e}static fromJSON(e,t){if(!t)throw new RangeError("Invalid input for Mark.fromJSON");let n=e.marks[t.type];if(!n)throw new RangeError(`There is no mark type ${t.type} in this schema`);let r=n.create(t.attrs);return n.checkAttrs(r.attrs),r}static sameSet(e,t){if(e==t)return!0;if(e.length!=t.length)return!1;for(let n=0;n<e.length;n++)if(!e[n].eq(t[n]))return!1;return!0}static setFrom(e){if(!e||Array.isArray(e)&&e.length==0)return M.none;if(e instanceof M)return[e];let t=e.slice();return t.sort((n,r)=>n.type.rank-r.type.rank),t}}M.none=[];class $t extends Error{}class b{constructor(e,t,n){this.content=e,this.openStart=t,this.openEnd=n}get size(){return this.content.size-this.openStart-this.openEnd}insertAt(e,t){let n=Ar(this.content,e+this.openStart,t);return n&&new b(n,this.openStart,this.openEnd)}removeBetween(e,t){return new b(Tr(this.content,e+this.openStart,t+this.openStart),this.openStart,this.openEnd)}eq(e){return this.content.eq(e.content)&&this.openStart==e.openStart&&this.openEnd==e.openEnd}toString(){return this.content+"("+this.openStart+","+this.openEnd+")"}toJSON(){if(!this.content.size)return null;let e={content:this.content.toJSON()};return this.openStart>0&&(e.openStart=this.openStart),this.openEnd>0&&(e.openEnd=this.openEnd),e}static fromJSON(e,t){if(!t)return b.empty;let n=t.openStart||0,r=t.openEnd||0;if(typeof n!="number"||typeof r!="number")throw new RangeError("Invalid input for Slice.fromJSON");return new b(y.fromJSON(e,t.content),n,r)}static maxOpen(e,t=!0){let n=0,r=0;for(let s=e.firstChild;s&&!s.isLeaf&&(t||!s.type.spec.isolating);s=s.firstChild)n++;for(let s=e.lastChild;s&&!s.isLeaf&&(t||!s.type.spec.isolating);s=s.lastChild)r++;return new b(e,n,r)}}b.empty=new b(y.empty,0,0);function Tr(i,e,t){let{index:n,offset:r}=i.findIndex(e),s=i.maybeChild(n),{index:o,offset:l}=i.findIndex(t);if(r==e||s.isText){if(l!=t&&!i.child(o).isText)throw new RangeError("Removing non-flat range");return i.cut(0,e).append(i.cut(t))}if(n!=o)throw new RangeError("Removing non-flat range");return i.replaceChild(n,s.copy(Tr(s.content,e-r-1,t-r-1)))}function Ar(i,e,t,n){let{index:r,offset:s}=i.findIndex(e),o=i.maybeChild(r);if(s==e||o.isText)return i.cut(0,e).append(t).append(i.cut(e));let l=Ar(o.content,e-s-1,t);return l&&i.replaceChild(r,o.copy(l))}function po(i,e,t){if(t.openStart>i.depth)throw new $t("Inserted content deeper than insertion position");if(i.depth-t.openStart!=e.depth-t.openEnd)throw new $t("Inconsistent open depths");return Ir(i,e,t,0)}function Ir(i,e,t,n){let r=i.index(n),s=i.node(n);if(r==e.index(n)&&n<i.depth-t.openStart){let o=Ir(i,e,t,n+1);return s.copy(s.content.replaceChild(r,o))}else if(t.content.size)if(!t.openStart&&!t.openEnd&&i.depth==n&&e.depth==n){let o=i.parent,l=o.content;return Re(o,l.cut(0,i.parentOffset).append(t.content).append(l.cut(e.parentOffset)))}else{let{start:o,end:l}=mo(t,i);return Re(s,Rr(i,o,l,e,n))}else return Re(s,Kt(i,e,n))}function qr(i,e){if(!e.type.compatibleContent(i.type))throw new $t("Cannot join "+e.type.name+" onto "+i.type.name)}function qn(i,e,t){let n=i.node(t);return qr(n,e.node(t)),n}function qe(i,e){let t=e.length-1;t>=0&&i.isText&&i.sameMarkup(e[t])?e[t]=i.withText(e[t].text+i.text):e.push(i)}function ct(i,e,t,n){let r=(e||i).node(t),s=0,o=e?e.index(t):r.childCount;i&&(s=i.index(t),i.depth>t?s++:i.textOffset&&(qe(i.nodeAfter,n),s++));for(let l=s;l<o;l++)qe(r.child(l),n);e&&e.depth==t&&e.textOffset&&qe(e.nodeBefore,n)}function Re(i,e){return i.type.checkContent(e),i.copy(e)}function Rr(i,e,t,n,r){let s=i.depth>r&&qn(i,e,r+1),o=n.depth>r&&qn(t,n,r+1),l=[];return ct(null,i,r,l),s&&o&&e.index(r)==t.index(r)?(qr(s,o),qe(Re(s,Rr(i,e,t,n,r+1)),l)):(s&&qe(Re(s,Kt(i,e,r+1)),l),ct(e,t,r,l),o&&qe(Re(o,Kt(t,n,r+1)),l)),ct(n,null,r,l),new y(l)}function Kt(i,e,t){let n=[];if(ct(null,i,t,n),i.depth>t){let r=qn(i,e,t+1);qe(Re(r,Kt(i,e,t+1)),n)}return ct(e,null,t,n),new y(n)}function mo(i,e){let t=e.depth-i.openStart,r=e.node(t).copy(i.content);for(let s=t-1;s>=0;s--)r=e.node(s).copy(y.from(r));return{start:r.resolveNoCache(i.openStart+t),end:r.resolveNoCache(r.content.size-i.openEnd-t)}}class yt{constructor(e,t,n){this.pos=e,this.path=t,this.parentOffset=n,this.depth=t.length/3-1}resolveDepth(e){return e==null?this.depth:e<0?this.depth+e:e}get parent(){return this.node(this.depth)}get doc(){return this.node(0)}node(e){return this.path[this.resolveDepth(e)*3]}index(e){return this.path[this.resolveDepth(e)*3+1]}indexAfter(e){return e=this.resolveDepth(e),this.index(e)+(e==this.depth&&!this.textOffset?0:1)}start(e){return e=this.resolveDepth(e),e==0?0:this.path[e*3-1]+1}end(e){return e=this.resolveDepth(e),this.start(e)+this.node(e).content.size}before(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position before the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]}after(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position after the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]+this.path[e*3].nodeSize}get textOffset(){return this.pos-this.path[this.path.length-1]}get nodeAfter(){let e=this.parent,t=this.index(this.depth);if(t==e.childCount)return null;let n=this.pos-this.path[this.path.length-1],r=e.child(t);return n?e.child(t).cut(n):r}get nodeBefore(){let e=this.index(this.depth),t=this.pos-this.path[this.path.length-1];return t?this.parent.child(e).cut(0,t):e==0?null:this.parent.child(e-1)}posAtIndex(e,t){t=this.resolveDepth(t);let n=this.path[t*3],r=t==0?0:this.path[t*3-1]+1;for(let s=0;s<e;s++)r+=n.child(s).nodeSize;return r}marks(){let e=this.parent,t=this.index();if(e.content.size==0)return M.none;if(this.textOffset)return e.child(t).marks;let n=e.maybeChild(t-1),r=e.maybeChild(t);if(!n){let l=n;n=r,r=l}let s=n.marks;for(var o=0;o<s.length;o++)s[o].type.spec.inclusive===!1&&(!r||!s[o].isInSet(r.marks))&&(s=s[o--].removeFromSet(s));return s}marksAcross(e){let t=this.parent.maybeChild(this.index());if(!t||!t.isInline)return null;let n=t.marks,r=e.parent.maybeChild(e.index());for(var s=0;s<n.length;s++)n[s].type.spec.inclusive===!1&&(!r||!n[s].isInSet(r.marks))&&(n=n[s--].removeFromSet(n));return n}sharedDepth(e){for(let t=this.depth;t>0;t--)if(this.start(t)<=e&&this.end(t)>=e)return t;return 0}blockRange(e=this,t){if(e.pos<this.pos)return e.blockRange(this);for(let n=this.depth-(this.parent.inlineContent||this.pos==e.pos?1:0);n>=0;n--)if(e.pos<=this.end(n)&&(!t||t(this.node(n))))return new Ut(this,e,n);return null}sameParent(e){return this.pos-this.parentOffset==e.pos-e.parentOffset}max(e){return e.pos>this.pos?e:this}min(e){return e.pos<this.pos?e:this}toString(){let e="";for(let t=1;t<=this.depth;t++)e+=(e?"/":"")+this.node(t).type.name+"_"+this.index(t-1);return e+":"+this.parentOffset}static resolve(e,t){if(!(t>=0&&t<=e.content.size))throw new RangeError("Position "+t+" out of range");let n=[],r=0,s=t;for(let o=e;;){let{index:l,offset:a}=o.content.findIndex(s),u=s-a;if(n.push(o,l,r+a),!u||(o=o.child(l),o.isText))break;s=u-1,r+=a+1}return new yt(t,n,s)}static resolveCached(e,t){let n=Si.get(e);if(n)for(let s=0;s<n.elts.length;s++){let o=n.elts[s];if(o.pos==t)return o}else Si.set(e,n=new go);let r=n.elts[n.i]=yt.resolve(e,t);return n.i=(n.i+1)%yo,r}}class go{constructor(){this.elts=[],this.i=0}}const yo=12,Si=new WeakMap;class Ut{constructor(e,t,n){this.$from=e,this.$to=t,this.depth=n}get start(){return this.$from.before(this.depth+1)}get end(){return this.$to.after(this.depth+1)}get parent(){return this.$from.node(this.depth)}get startIndex(){return this.$from.index(this.depth)}get endIndex(){return this.$to.indexAfter(this.depth)}}const bo=Object.create(null);let Pe=class Rn{constructor(e,t,n,r=M.none){this.type=e,this.attrs=t,this.marks=r,this.content=n||y.empty}get nodeSize(){return this.isLeaf?1:2+this.content.size}get childCount(){return this.content.childCount}child(e){return this.content.child(e)}maybeChild(e){return this.content.maybeChild(e)}forEach(e){this.content.forEach(e)}nodesBetween(e,t,n,r=0){this.content.nodesBetween(e,t,n,r,this)}descendants(e){this.nodesBetween(0,this.content.size,e)}get textContent(){return this.isLeaf&&this.type.spec.leafText?this.type.spec.leafText(this):this.textBetween(0,this.content.size,"")}textBetween(e,t,n,r){return this.content.textBetween(e,t,n,r)}get firstChild(){return this.content.firstChild}get lastChild(){return this.content.lastChild}eq(e){return this==e||this.sameMarkup(e)&&this.content.eq(e.content)}sameMarkup(e){return this.hasMarkup(e.type,e.attrs,e.marks)}hasMarkup(e,t,n){return this.type==e&&Ht(this.attrs,t||e.defaultAttrs||bo)&&M.sameSet(this.marks,n||M.none)}copy(e=null){return e==this.content?this:new Rn(this.type,this.attrs,e,this.marks)}mark(e){return e==this.marks?this:new Rn(this.type,this.attrs,this.content,e)}cut(e,t=this.content.size){return e==0&&t==this.content.size?this:this.copy(this.content.cut(e,t))}slice(e,t=this.content.size,n=!1){if(e==t)return b.empty;let r=this.resolve(e),s=this.resolve(t),o=n?0:r.sharedDepth(t),l=r.start(o),u=r.node(o).content.cut(r.pos-l,s.pos-l);return new b(u,r.depth-o,s.depth-o)}replace(e,t,n){return po(this.resolve(e),this.resolve(t),n)}nodeAt(e){for(let t=this;;){let{index:n,offset:r}=t.content.findIndex(e);if(t=t.maybeChild(n),!t)return null;if(r==e||t.isText)return t;e-=r+1}}childAfter(e){let{index:t,offset:n}=this.content.findIndex(e);return{node:this.content.maybeChild(t),index:t,offset:n}}childBefore(e){if(e==0)return{node:null,index:0,offset:0};let{index:t,offset:n}=this.content.findIndex(e);if(n<e)return{node:this.content.child(t),index:t,offset:n};let r=this.content.child(t-1);return{node:r,index:t-1,offset:n-r.nodeSize}}resolve(e){return yt.resolveCached(this,e)}resolveNoCache(e){return yt.resolve(this,e)}rangeHasMark(e,t,n){let r=!1;return t>e&&this.nodesBetween(e,t,s=>(n.isInSet(s.marks)&&(r=!0),!r)),r}get isBlock(){return this.type.isBlock}get isTextblock(){return this.type.isTextblock}get inlineContent(){return this.type.inlineContent}get isInline(){return this.type.isInline}get isText(){return this.type.isText}get isLeaf(){return this.type.isLeaf}get isAtom(){return this.type.isAtom}toString(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);let e=this.type.name;return this.content.size&&(e+="("+this.content.toStringInner()+")"),Pr(this.marks,e)}contentMatchAt(e){let t=this.type.contentMatch.matchFragment(this.content,0,e);if(!t)throw new Error("Called contentMatchAt on a node with invalid content");return t}canReplace(e,t,n=y.empty,r=0,s=n.childCount){let o=this.contentMatchAt(e).matchFragment(n,r,s),l=o&&o.matchFragment(this.content,t);if(!l||!l.validEnd)return!1;for(let a=r;a<s;a++)if(!this.type.allowsMarks(n.child(a).marks))return!1;return!0}canReplaceWith(e,t,n,r){if(r&&!this.type.allowsMarks(r))return!1;let s=this.contentMatchAt(e).matchType(n),o=s&&s.matchFragment(this.content,t);return o?o.validEnd:!1}canAppend(e){return e.content.size?this.canReplace(this.childCount,this.childCount,e.content):this.type.compatibleContent(e.type)}check(){this.type.checkContent(this.content),this.type.checkAttrs(this.attrs);let e=M.none;for(let t=0;t<this.marks.length;t++){let n=this.marks[t];n.type.checkAttrs(n.attrs),e=n.addToSet(e)}if(!M.sameSet(e,this.marks))throw new RangeError(`Invalid collection of marks for node ${this.type.name}: ${this.marks.map(t=>t.type.name)}`);this.content.forEach(t=>t.check())}toJSON(){let e={type:this.type.name};for(let t in this.attrs){e.attrs=this.attrs;break}return this.content.size&&(e.content=this.content.toJSON()),this.marks.length&&(e.marks=this.marks.map(t=>t.toJSON())),e}static fromJSON(e,t){if(!t)throw new RangeError("Invalid input for Node.fromJSON");let n;if(t.marks){if(!Array.isArray(t.marks))throw new RangeError("Invalid mark data for Node.fromJSON");n=t.marks.map(e.markFromJSON)}if(t.type=="text"){if(typeof t.text!="string")throw new RangeError("Invalid text node in JSON");return e.text(t.text,n)}let r=y.fromJSON(e,t.content),s=e.nodeType(t.type).create(t.attrs,r,n);return s.type.checkAttrs(s.attrs),s}};Pe.prototype.text=void 0;class jt extends Pe{constructor(e,t,n,r){if(super(e,t,null,r),!n)throw new RangeError("Empty text nodes are not allowed");this.text=n}toString(){return this.type.spec.toDebugString?this.type.spec.toDebugString(this):Pr(this.marks,JSON.stringify(this.text))}get textContent(){return this.text}textBetween(e,t){return this.text.slice(e,t)}get nodeSize(){return this.text.length}mark(e){return e==this.marks?this:new jt(this.type,this.attrs,this.text,e)}withText(e){return e==this.text?this:new jt(this.type,this.attrs,e,this.marks)}cut(e=0,t=this.text.length){return e==0&&t==this.text.length?this:this.withText(this.text.slice(e,t))}eq(e){return this.sameMarkup(e)&&this.text==e.text}toJSON(){let e=super.toJSON();return e.text=this.text,e}}function Pr(i,e){for(let t=i.length-1;t>=0;t--)e=i[t].type.name+"("+e+")";return e}class Le{constructor(e){this.validEnd=e,this.next=[],this.wrapCache=[]}static parse(e,t){let n=new xo(e,t);if(n.next==null)return Le.empty;let r=zr(n);n.next&&n.err("Unexpected trailing text");let s=vo(Oo(r));return No(s,n),s}matchType(e){for(let t=0;t<this.next.length;t++)if(this.next[t].type==e)return this.next[t].next;return null}matchFragment(e,t=0,n=e.childCount){let r=this;for(let s=t;r&&s<n;s++)r=r.matchType(e.child(s).type);return r}get inlineContent(){return this.next.length!=0&&this.next[0].type.isInline}get defaultType(){for(let e=0;e<this.next.length;e++){let{type:t}=this.next[e];if(!(t.isText||t.hasRequiredAttrs()))return t}return null}compatible(e){for(let t=0;t<this.next.length;t++)for(let n=0;n<e.next.length;n++)if(this.next[t].type==e.next[n].type)return!0;return!1}fillBefore(e,t=!1,n=0){let r=[this];function s(o,l){let a=o.matchFragment(e,n);if(a&&(!t||a.validEnd))return y.from(l.map(u=>u.createAndFill()));for(let u=0;u<o.next.length;u++){let{type:c,next:d}=o.next[u];if(!(c.isText||c.hasRequiredAttrs())&&r.indexOf(d)==-1){r.push(d);let f=s(d,l.concat(c));if(f)return f}}return null}return s(this,[])}findWrapping(e){for(let n=0;n<this.wrapCache.length;n+=2)if(this.wrapCache[n]==e)return this.wrapCache[n+1];let t=this.computeWrapping(e);return this.wrapCache.push(e,t),t}computeWrapping(e){let t=Object.create(null),n=[{match:this,type:null,via:null}];for(;n.length;){let r=n.shift(),s=r.match;if(s.matchType(e)){let o=[];for(let l=r;l.type;l=l.via)o.push(l.type);return o.reverse()}for(let o=0;o<s.next.length;o++){let{type:l,next:a}=s.next[o];!l.isLeaf&&!l.hasRequiredAttrs()&&!(l.name in t)&&(!r.type||a.validEnd)&&(n.push({match:l.contentMatch,type:l,via:r}),t[l.name]=!0)}}return null}get edgeCount(){return this.next.length}edge(e){if(e>=this.next.length)throw new RangeError(`There's no ${e}th edge in this content match`);return this.next[e]}toString(){let e=[];function t(n){e.push(n);for(let r=0;r<n.next.length;r++)e.indexOf(n.next[r].next)==-1&&t(n.next[r].next)}return t(this),e.map((n,r)=>{let s=r+(n.validEnd?"*":" ")+" ";for(let o=0;o<n.next.length;o++)s+=(o?", ":"")+n.next[o].type.name+"->"+e.indexOf(n.next[o].next);return s}).join(`
`)}}Le.empty=new Le(!0);class xo{constructor(e,t){this.string=e,this.nodeTypes=t,this.inline=null,this.pos=0,this.tokens=e.split(/\s*(?=\b|\W|$)/),this.tokens[this.tokens.length-1]==""&&this.tokens.pop(),this.tokens[0]==""&&this.tokens.shift()}get next(){return this.tokens[this.pos]}eat(e){return this.next==e&&(this.pos++||!0)}err(e){throw new SyntaxError(e+" (in content expression '"+this.string+"')")}}function zr(i){let e=[];do e.push(ko(i));while(i.eat("|"));return e.length==1?e[0]:{type:"choice",exprs:e}}function ko(i){let e=[];do e.push(So(i));while(i.next&&i.next!=")"&&i.next!="|");return e.length==1?e[0]:{type:"seq",exprs:e}}function So(i){let e=Mo(i);for(;;)if(i.eat("+"))e={type:"plus",expr:e};else if(i.eat("*"))e={type:"star",expr:e};else if(i.eat("?"))e={type:"opt",expr:e};else if(i.eat("{"))e=wo(i,e);else break;return e}function wi(i){/\D/.test(i.next)&&i.err("Expected number, got '"+i.next+"'");let e=Number(i.next);return i.pos++,e}function wo(i,e){let t=wi(i),n=t;return i.eat(",")&&(i.next!="}"?n=wi(i):n=-1),i.eat("}")||i.err("Unclosed braced range"),{type:"range",min:t,max:n,expr:e}}function Co(i,e){let t=i.nodeTypes,n=t[e];if(n)return[n];let r=[];for(let s in t){let o=t[s];o.groups.indexOf(e)>-1&&r.push(o)}return r.length==0&&i.err("No node type or group '"+e+"' found"),r}function Mo(i){if(i.eat("(")){let e=zr(i);return i.eat(")")||i.err("Missing closing paren"),e}else if(/\W/.test(i.next))i.err("Unexpected token '"+i.next+"'");else{let e=Co(i,i.next).map(t=>(i.inline==null?i.inline=t.isInline:i.inline!=t.isInline&&i.err("Mixing inline and block content"),{type:"name",value:t}));return i.pos++,e.length==1?e[0]:{type:"choice",exprs:e}}}function Oo(i){let e=[[]];return r(s(i,0),t()),e;function t(){return e.push([])-1}function n(o,l,a){let u={term:a,to:l};return e[o].push(u),u}function r(o,l){o.forEach(a=>a.to=l)}function s(o,l){if(o.type=="choice")return o.exprs.reduce((a,u)=>a.concat(s(u,l)),[]);if(o.type=="seq")for(let a=0;;a++){let u=s(o.exprs[a],l);if(a==o.exprs.length-1)return u;r(u,l=t())}else if(o.type=="star"){let a=t();return n(l,a),r(s(o.expr,a),a),[n(a)]}else if(o.type=="plus"){let a=t();return r(s(o.expr,l),a),r(s(o.expr,a),a),[n(a)]}else{if(o.type=="opt")return[n(l)].concat(s(o.expr,l));if(o.type=="range"){let a=l;for(let u=0;u<o.min;u++){let c=t();r(s(o.expr,a),c),a=c}if(o.max==-1)r(s(o.expr,a),a);else for(let u=o.min;u<o.max;u++){let c=t();n(a,c),r(s(o.expr,a),c),a=c}return[n(a)]}else{if(o.type=="name")return[n(l,void 0,o.value)];throw new Error("Unknown expr type")}}}}function Br(i,e){return e-i}function Ci(i,e){let t=[];return n(e),t.sort(Br);function n(r){let s=i[r];if(s.length==1&&!s[0].term)return n(s[0].to);t.push(r);for(let o=0;o<s.length;o++){let{term:l,to:a}=s[o];!l&&t.indexOf(a)==-1&&n(a)}}}function vo(i){let e=Object.create(null);return t(Ci(i,0));function t(n){let r=[];n.forEach(o=>{i[o].forEach(({term:l,to:a})=>{if(!l)return;let u;for(let c=0;c<r.length;c++)r[c][0]==l&&(u=r[c][1]);Ci(i,a).forEach(c=>{u||r.push([l,u=[]]),u.indexOf(c)==-1&&u.push(c)})})});let s=e[n.join(",")]=new Le(n.indexOf(i.length-1)>-1);for(let o=0;o<r.length;o++){let l=r[o][1].sort(Br);s.next.push({type:r[o][0],next:e[l.join(",")]||t(l)})}return s}}function No(i,e){for(let t=0,n=[i];t<n.length;t++){let r=n[t],s=!r.validEnd,o=[];for(let l=0;l<r.next.length;l++){let{type:a,next:u}=r.next[l];o.push(a.name),s&&!(a.isText||a.hasRequiredAttrs())&&(s=!1),n.indexOf(u)==-1&&n.push(u)}s&&e.err("Only non-generatable nodes ("+o.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}function Vr(i){let e=Object.create(null);for(let t in i){let n=i[t];if(!n.hasDefault)return null;e[t]=n.default}return e}function Fr(i,e){let t=Object.create(null);for(let n in i){let r=e&&e[n];if(r===void 0){let s=i[n];if(s.hasDefault)r=s.default;else throw new RangeError("No value supplied for attribute "+n)}t[n]=r}return t}function Lr(i,e,t,n){for(let r in e)if(!(r in i))throw new RangeError(`Unsupported attribute ${r} for ${t} of type ${r}`);for(let r in i){let s=i[r];s.validate&&s.validate(e[r])}}function Wr(i,e){let t=Object.create(null);if(e)for(let n in e)t[n]=new Eo(i,n,e[n]);return t}let Mi=class _r{constructor(e,t,n){this.name=e,this.schema=t,this.spec=n,this.markSet=null,this.groups=n.group?n.group.split(" "):[],this.attrs=Wr(e,n.attrs),this.defaultAttrs=Vr(this.attrs),this.contentMatch=null,this.inlineContent=null,this.isBlock=!(n.inline||e=="text"),this.isText=e=="text"}get isInline(){return!this.isBlock}get isTextblock(){return this.isBlock&&this.inlineContent}get isLeaf(){return this.contentMatch==Le.empty}get isAtom(){return this.isLeaf||!!this.spec.atom}get whitespace(){return this.spec.whitespace||(this.spec.code?"pre":"normal")}hasRequiredAttrs(){for(let e in this.attrs)if(this.attrs[e].isRequired)return!0;return!1}compatibleContent(e){return this==e||this.contentMatch.compatible(e.contentMatch)}computeAttrs(e){return!e&&this.defaultAttrs?this.defaultAttrs:Fr(this.attrs,e)}create(e=null,t,n){if(this.isText)throw new Error("NodeType.create can't construct text nodes");return new Pe(this,this.computeAttrs(e),y.from(t),M.setFrom(n))}createChecked(e=null,t,n){return t=y.from(t),this.checkContent(t),new Pe(this,this.computeAttrs(e),t,M.setFrom(n))}createAndFill(e=null,t,n){if(e=this.computeAttrs(e),t=y.from(t),t.size){let o=this.contentMatch.fillBefore(t);if(!o)return null;t=o.append(t)}let r=this.contentMatch.matchFragment(t),s=r&&r.fillBefore(y.empty,!0);return s?new Pe(this,e,t.append(s),M.setFrom(n)):null}validContent(e){let t=this.contentMatch.matchFragment(e);if(!t||!t.validEnd)return!1;for(let n=0;n<e.childCount;n++)if(!this.allowsMarks(e.child(n).marks))return!1;return!0}checkContent(e){if(!this.validContent(e))throw new RangeError(`Invalid content for node ${this.name}: ${e.toString().slice(0,50)}`)}checkAttrs(e){Lr(this.attrs,e,"node",this.name)}allowsMarkType(e){return this.markSet==null||this.markSet.indexOf(e)>-1}allowsMarks(e){if(this.markSet==null)return!0;for(let t=0;t<e.length;t++)if(!this.allowsMarkType(e[t].type))return!1;return!0}allowedMarks(e){if(this.markSet==null)return e;let t;for(let n=0;n<e.length;n++)this.allowsMarkType(e[n].type)?t&&t.push(e[n]):t||(t=e.slice(0,n));return t?t.length?t:M.none:e}static compile(e,t){let n=Object.create(null);e.forEach((s,o)=>n[s]=new _r(s,t,o));let r=t.spec.topNode||"doc";if(!n[r])throw new RangeError("Schema is missing its top node type ('"+r+"')");if(!n.text)throw new RangeError("Every schema needs a 'text' type");for(let s in n.text.attrs)throw new RangeError("The text node type should not have attributes");return n}};function Do(i,e,t){let n=t.split("|");return r=>{let s=r===null?"null":typeof r;if(n.indexOf(s)<0)throw new RangeError(`Expected value of type ${n} for attribute ${e} on type ${i}, got ${s}`)}}class Eo{constructor(e,t,n){this.hasDefault=Object.prototype.hasOwnProperty.call(n,"default"),this.default=n.default,this.validate=typeof n.validate=="string"?Do(e,t,n.validate):n.validate}get isRequired(){return!this.hasDefault}}class on{constructor(e,t,n,r){this.name=e,this.rank=t,this.schema=n,this.spec=r,this.attrs=Wr(e,r.attrs),this.excluded=null;let s=Vr(this.attrs);this.instance=s?new M(this,s):null}create(e=null){return!e&&this.instance?this.instance:new M(this,Fr(this.attrs,e))}static compile(e,t){let n=Object.create(null),r=0;return e.forEach((s,o)=>n[s]=new on(s,r++,t,o)),n}removeFromSet(e){for(var t=0;t<e.length;t++)e[t].type==this&&(e=e.slice(0,t).concat(e.slice(t+1)),t--);return e}isInSet(e){for(let t=0;t<e.length;t++)if(e[t].type==this)return e[t]}checkAttrs(e){Lr(this.attrs,e,"mark",this.name)}excludes(e){return this.excluded.indexOf(e)>-1}}class Jr{constructor(e){this.linebreakReplacement=null,this.cached=Object.create(null);let t=this.spec={};for(let r in e)t[r]=e[r];t.nodes=A.from(e.nodes),t.marks=A.from(e.marks||{}),this.nodes=Mi.compile(this.spec.nodes,this),this.marks=on.compile(this.spec.marks,this);let n=Object.create(null);for(let r in this.nodes){if(r in this.marks)throw new RangeError(r+" can not be both a node and a mark");let s=this.nodes[r],o=s.spec.content||"",l=s.spec.marks;if(s.contentMatch=n[o]||(n[o]=Le.parse(o,this.nodes)),s.inlineContent=s.contentMatch.inlineContent,s.spec.linebreakReplacement){if(this.linebreakReplacement)throw new RangeError("Multiple linebreak nodes defined");if(!s.isInline||!s.isLeaf)throw new RangeError("Linebreak replacement nodes must be inline leaf nodes");this.linebreakReplacement=s}s.markSet=l=="_"?null:l?Oi(this,l.split(" ")):l==""||!s.inlineContent?[]:null}for(let r in this.marks){let s=this.marks[r],o=s.spec.excludes;s.excluded=o==null?[s]:o==""?[]:Oi(this,o.split(" "))}this.nodeFromJSON=this.nodeFromJSON.bind(this),this.markFromJSON=this.markFromJSON.bind(this),this.topNodeType=this.nodes[this.spec.topNode||"doc"],this.cached.wrappings=Object.create(null)}node(e,t=null,n,r){if(typeof e=="string")e=this.nodeType(e);else if(e instanceof Mi){if(e.schema!=this)throw new RangeError("Node type from different schema used ("+e.name+")")}else throw new RangeError("Invalid node type: "+e);return e.createChecked(t,n,r)}text(e,t){let n=this.nodes.text;return new jt(n,n.defaultAttrs,e,M.setFrom(t))}mark(e,t){return typeof e=="string"&&(e=this.marks[e]),e.create(t)}nodeFromJSON(e){return Pe.fromJSON(this,e)}markFromJSON(e){return M.fromJSON(this,e)}nodeType(e){let t=this.nodes[e];if(!t)throw new RangeError("Unknown node type: "+e);return t}}function Oi(i,e){let t=[];for(let n=0;n<e.length;n++){let r=e[n],s=i.marks[r],o=s;if(s)t.push(s);else for(let l in i.marks){let a=i.marks[l];(r=="_"||a.spec.group&&a.spec.group.split(" ").indexOf(r)>-1)&&t.push(o=a)}if(!o)throw new SyntaxError("Unknown mark type: '"+e[n]+"'")}return t}function To(i){return i.tag!=null}function Ao(i){return i.style!=null}class Ze{constructor(e,t){this.schema=e,this.rules=t,this.tags=[],this.styles=[];let n=this.matchedStyles=[];t.forEach(r=>{if(To(r))this.tags.push(r);else if(Ao(r)){let s=/[^=]*/.exec(r.style)[0];n.indexOf(s)<0&&n.push(s),this.styles.push(r)}}),this.normalizeLists=!this.tags.some(r=>{if(!/^(ul|ol)\b/.test(r.tag)||!r.node)return!1;let s=e.nodes[r.node];return s.contentMatch.matchType(s)})}parse(e,t={}){let n=new Ni(this,t,!1);return n.addAll(e,M.none,t.from,t.to),n.finish()}parseSlice(e,t={}){let n=new Ni(this,t,!0);return n.addAll(e,M.none,t.from,t.to),b.maxOpen(n.finish())}matchTag(e,t,n){for(let r=n?this.tags.indexOf(n)+1:0;r<this.tags.length;r++){let s=this.tags[r];if(Ro(e,s.tag)&&(s.namespace===void 0||e.namespaceURI==s.namespace)&&(!s.context||t.matchesContext(s.context))){if(s.getAttrs){let o=s.getAttrs(e);if(o===!1)continue;s.attrs=o||void 0}return s}}}matchStyle(e,t,n,r){for(let s=r?this.styles.indexOf(r)+1:0;s<this.styles.length;s++){let o=this.styles[s],l=o.style;if(!(l.indexOf(e)!=0||o.context&&!n.matchesContext(o.context)||l.length>e.length&&(l.charCodeAt(e.length)!=61||l.slice(e.length+1)!=t))){if(o.getAttrs){let a=o.getAttrs(t);if(a===!1)continue;o.attrs=a||void 0}return o}}}static schemaRules(e){let t=[];function n(r){let s=r.priority==null?50:r.priority,o=0;for(;o<t.length;o++){let l=t[o];if((l.priority==null?50:l.priority)<s)break}t.splice(o,0,r)}for(let r in e.marks){let s=e.marks[r].spec.parseDOM;s&&s.forEach(o=>{n(o=Di(o)),o.mark||o.ignore||o.clearMark||(o.mark=r)})}for(let r in e.nodes){let s=e.nodes[r].spec.parseDOM;s&&s.forEach(o=>{n(o=Di(o)),o.node||o.ignore||o.mark||(o.node=r)})}return t}static fromSchema(e){return e.cached.domParser||(e.cached.domParser=new Ze(e,Ze.schemaRules(e)))}}const Hr={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},Io={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},$r={ol:!0,ul:!0},Gt=1,Qt=2,dt=4;function vi(i,e,t){return e!=null?(e?Gt:0)|(e==="full"?Qt:0):i&&i.whitespace=="pre"?Gt|Qt:t&~dt}class qt{constructor(e,t,n,r,s,o){this.type=e,this.attrs=t,this.marks=n,this.solid=r,this.options=o,this.content=[],this.activeMarks=M.none,this.match=s||(o&dt?null:e.contentMatch)}findWrapping(e){if(!this.match){if(!this.type)return[];let t=this.type.contentMatch.fillBefore(y.from(e));if(t)this.match=this.type.contentMatch.matchFragment(t);else{let n=this.type.contentMatch,r;return(r=n.findWrapping(e.type))?(this.match=n,r):null}}return this.match.findWrapping(e.type)}finish(e){if(!(this.options&Gt)){let n=this.content[this.content.length-1],r;if(n&&n.isText&&(r=/[ \t\r\n\u000c]+$/.exec(n.text))){let s=n;n.text.length==r[0].length?this.content.pop():this.content[this.content.length-1]=s.withText(s.text.slice(0,s.text.length-r[0].length))}}let t=y.from(this.content);return!e&&this.match&&(t=t.append(this.match.fillBefore(y.empty,!0))),this.type?this.type.create(this.attrs,t,this.marks):t}inlineContext(e){return this.type?this.type.inlineContent:this.content.length?this.content[0].isInline:e.parentNode&&!Hr.hasOwnProperty(e.parentNode.nodeName.toLowerCase())}}class Ni{constructor(e,t,n){this.parser=e,this.options=t,this.isOpen=n,this.open=0;let r=t.topNode,s,o=vi(null,t.preserveWhitespace,0)|(n?dt:0);r?s=new qt(r.type,r.attrs,M.none,!0,t.topMatch||r.type.contentMatch,o):n?s=new qt(null,null,M.none,!0,null,o):s=new qt(e.schema.topNodeType,null,M.none,!0,null,o),this.nodes=[s],this.find=t.findPositions,this.needsBlock=!1}get top(){return this.nodes[this.open]}addDOM(e,t){e.nodeType==3?this.addTextNode(e,t):e.nodeType==1&&this.addElement(e,t)}addTextNode(e,t){let n=e.nodeValue,r=this.top;if(r.options&Qt||r.inlineContext(e)||/[^ \t\r\n\u000c]/.test(n)){if(r.options&Gt)r.options&Qt?n=n.replace(/\r\n?/g,`
`):n=n.replace(/\r?\n|\r/g," ");else if(n=n.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(n)&&this.open==this.nodes.length-1){let s=r.content[r.content.length-1],o=e.previousSibling;(!s||o&&o.nodeName=="BR"||s.isText&&/[ \t\r\n\u000c]$/.test(s.text))&&(n=n.slice(1))}n&&this.insertNode(this.parser.schema.text(n),t),this.findInText(e)}else this.findInside(e)}addElement(e,t,n){let r=e.nodeName.toLowerCase(),s;$r.hasOwnProperty(r)&&this.parser.normalizeLists&&qo(e);let o=this.options.ruleFromNode&&this.options.ruleFromNode(e)||(s=this.parser.matchTag(e,this,n));if(o?o.ignore:Io.hasOwnProperty(r))this.findInside(e),this.ignoreFallback(e,t);else if(!o||o.skip||o.closeParent){o&&o.closeParent?this.open=Math.max(0,this.open-1):o&&o.skip.nodeType&&(e=o.skip);let l,a=this.top,u=this.needsBlock;if(Hr.hasOwnProperty(r))a.content.length&&a.content[0].isInline&&this.open&&(this.open--,a=this.top),l=!0,a.type||(this.needsBlock=!0);else if(!e.firstChild){this.leafFallback(e,t);return}let c=o&&o.skip?t:this.readStyles(e,t);c&&this.addAll(e,c),l&&this.sync(a),this.needsBlock=u}else{let l=this.readStyles(e,t);l&&this.addElementByRule(e,o,l,o.consuming===!1?s:void 0)}}leafFallback(e,t){e.nodeName=="BR"&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(e.ownerDocument.createTextNode(`
`),t)}ignoreFallback(e,t){e.nodeName=="BR"&&(!this.top.type||!this.top.type.inlineContent)&&this.findPlace(this.parser.schema.text("-"),t)}readStyles(e,t){let n=e.style;if(n&&n.length)for(let r=0;r<this.parser.matchedStyles.length;r++){let s=this.parser.matchedStyles[r],o=n.getPropertyValue(s);if(o)for(let l=void 0;;){let a=this.parser.matchStyle(s,o,this,l);if(!a)break;if(a.ignore)return null;if(a.clearMark?t=t.filter(u=>!a.clearMark(u)):t=t.concat(this.parser.schema.marks[a.mark].create(a.attrs)),a.consuming===!1)l=a;else break}}return t}addElementByRule(e,t,n,r){let s,o;if(t.node)if(o=this.parser.schema.nodes[t.node],o.isLeaf)this.insertNode(o.create(t.attrs),n)||this.leafFallback(e,n);else{let a=this.enter(o,t.attrs||null,n,t.preserveWhitespace);a&&(s=!0,n=a)}else{let a=this.parser.schema.marks[t.mark];n=n.concat(a.create(t.attrs))}let l=this.top;if(o&&o.isLeaf)this.findInside(e);else if(r)this.addElement(e,n,r);else if(t.getContent)this.findInside(e),t.getContent(e,this.parser.schema).forEach(a=>this.insertNode(a,n));else{let a=e;typeof t.contentElement=="string"?a=e.querySelector(t.contentElement):typeof t.contentElement=="function"?a=t.contentElement(e):t.contentElement&&(a=t.contentElement),this.findAround(e,a,!0),this.addAll(a,n)}s&&this.sync(l)&&this.open--}addAll(e,t,n,r){let s=n||0;for(let o=n?e.childNodes[n]:e.firstChild,l=r==null?null:e.childNodes[r];o!=l;o=o.nextSibling,++s)this.findAtPoint(e,s),this.addDOM(o,t);this.findAtPoint(e,s)}findPlace(e,t){let n,r;for(let s=this.open;s>=0;s--){let o=this.nodes[s],l=o.findWrapping(e);if(l&&(!n||n.length>l.length)&&(n=l,r=o,!l.length)||o.solid)break}if(!n)return null;this.sync(r);for(let s=0;s<n.length;s++)t=this.enterInner(n[s],null,t,!1);return t}insertNode(e,t){if(e.isInline&&this.needsBlock&&!this.top.type){let r=this.textblockFromContext();r&&(t=this.enterInner(r,null,t))}let n=this.findPlace(e,t);if(n){this.closeExtra();let r=this.top;r.match&&(r.match=r.match.matchType(e.type));let s=M.none;for(let o of n.concat(e.marks))(r.type?r.type.allowsMarkType(o.type):Ei(o.type,e.type))&&(s=o.addToSet(s));return r.content.push(e.mark(s)),!0}return!1}enter(e,t,n,r){let s=this.findPlace(e.create(t),n);return s&&(s=this.enterInner(e,t,n,!0,r)),s}enterInner(e,t,n,r=!1,s){this.closeExtra();let o=this.top;o.match=o.match&&o.match.matchType(e);let l=vi(e,s,o.options);o.options&dt&&o.content.length==0&&(l|=dt);let a=M.none;return n=n.filter(u=>(o.type?o.type.allowsMarkType(u.type):Ei(u.type,e))?(a=u.addToSet(a),!1):!0),this.nodes.push(new qt(e,t,a,r,null,l)),this.open++,n}closeExtra(e=!1){let t=this.nodes.length-1;if(t>this.open){for(;t>this.open;t--)this.nodes[t-1].content.push(this.nodes[t].finish(e));this.nodes.length=this.open+1}}finish(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(this.isOpen||this.options.topOpen)}sync(e){for(let t=this.open;t>=0;t--)if(this.nodes[t]==e)return this.open=t,!0;return!1}get currentPos(){this.closeExtra();let e=0;for(let t=this.open;t>=0;t--){let n=this.nodes[t].content;for(let r=n.length-1;r>=0;r--)e+=n[r].nodeSize;t&&e++}return e}findAtPoint(e,t){if(this.find)for(let n=0;n<this.find.length;n++)this.find[n].node==e&&this.find[n].offset==t&&(this.find[n].pos=this.currentPos)}findInside(e){if(this.find)for(let t=0;t<this.find.length;t++)this.find[t].pos==null&&e.nodeType==1&&e.contains(this.find[t].node)&&(this.find[t].pos=this.currentPos)}findAround(e,t,n){if(e!=t&&this.find)for(let r=0;r<this.find.length;r++)this.find[r].pos==null&&e.nodeType==1&&e.contains(this.find[r].node)&&t.compareDocumentPosition(this.find[r].node)&(n?2:4)&&(this.find[r].pos=this.currentPos)}findInText(e){if(this.find)for(let t=0;t<this.find.length;t++)this.find[t].node==e&&(this.find[t].pos=this.currentPos-(e.nodeValue.length-this.find[t].offset))}matchesContext(e){if(e.indexOf("|")>-1)return e.split(/\s*\|\s*/).some(this.matchesContext,this);let t=e.split("/"),n=this.options.context,r=!this.isOpen&&(!n||n.parent.type==this.nodes[0].type),s=-(n?n.depth+1:0)+(r?0:1),o=(l,a)=>{for(;l>=0;l--){let u=t[l];if(u==""){if(l==t.length-1||l==0)continue;for(;a>=s;a--)if(o(l-1,a))return!0;return!1}else{let c=a>0||a==0&&r?this.nodes[a].type:n&&a>=s?n.node(a-s).type:null;if(!c||c.name!=u&&c.groups.indexOf(u)==-1)return!1;a--}}return!0};return o(t.length-1,this.open)}textblockFromContext(){let e=this.options.context;if(e)for(let t=e.depth;t>=0;t--){let n=e.node(t).contentMatchAt(e.indexAfter(t)).defaultType;if(n&&n.isTextblock&&n.defaultAttrs)return n}for(let t in this.parser.schema.nodes){let n=this.parser.schema.nodes[t];if(n.isTextblock&&n.defaultAttrs)return n}}}function qo(i){for(let e=i.firstChild,t=null;e;e=e.nextSibling){let n=e.nodeType==1?e.nodeName.toLowerCase():null;n&&$r.hasOwnProperty(n)&&t?(t.appendChild(e),e=t):n=="li"?t=e:n&&(t=null)}}function Ro(i,e){return(i.matches||i.msMatchesSelector||i.webkitMatchesSelector||i.mozMatchesSelector).call(i,e)}function Di(i){let e={};for(let t in i)e[t]=i[t];return e}function Ei(i,e){let t=e.schema.nodes;for(let n in t){let r=t[n];if(!r.allowsMarkType(i))continue;let s=[],o=l=>{s.push(l);for(let a=0;a<l.edgeCount;a++){let{type:u,next:c}=l.edge(a);if(u==e||s.indexOf(c)<0&&o(c))return!0}};if(o(r.contentMatch))return!0}}class rt{constructor(e,t){this.nodes=e,this.marks=t}serializeFragment(e,t={},n){n||(n=pn(t).createDocumentFragment());let r=n,s=[];return e.forEach(o=>{if(s.length||o.marks.length){let l=0,a=0;for(;l<s.length&&a<o.marks.length;){let u=o.marks[a];if(!this.marks[u.type.name]){a++;continue}if(!u.eq(s[l][0])||u.type.spec.spanning===!1)break;l++,a++}for(;l<s.length;)r=s.pop()[1];for(;a<o.marks.length;){let u=o.marks[a++],c=this.serializeMark(u,o.isInline,t);c&&(s.push([u,r]),r.appendChild(c.dom),r=c.contentDOM||c.dom)}}r.appendChild(this.serializeNodeInner(o,t))}),n}serializeNodeInner(e,t){let{dom:n,contentDOM:r}=Ft(pn(t),this.nodes[e.type.name](e),null,e.attrs);if(r){if(e.isLeaf)throw new RangeError("Content hole not allowed in a leaf node spec");this.serializeFragment(e.content,t,r)}return n}serializeNode(e,t={}){let n=this.serializeNodeInner(e,t);for(let r=e.marks.length-1;r>=0;r--){let s=this.serializeMark(e.marks[r],e.isInline,t);s&&((s.contentDOM||s.dom).appendChild(n),n=s.dom)}return n}serializeMark(e,t,n={}){let r=this.marks[e.type.name];return r&&Ft(pn(n),r(e,t),null,e.attrs)}static renderSpec(e,t,n=null,r){return Ft(e,t,n,r)}static fromSchema(e){return e.cached.domSerializer||(e.cached.domSerializer=new rt(this.nodesFromSchema(e),this.marksFromSchema(e)))}static nodesFromSchema(e){let t=Ti(e.nodes);return t.text||(t.text=n=>n.text),t}static marksFromSchema(e){return Ti(e.marks)}}function Ti(i){let e={};for(let t in i){let n=i[t].spec.toDOM;n&&(e[t]=n)}return e}function pn(i){return i.document||window.document}const Ai=new WeakMap;function Po(i){let e=Ai.get(i);return e===void 0&&Ai.set(i,e=zo(i)),e}function zo(i){let e=null;function t(n){if(n&&typeof n=="object")if(Array.isArray(n))if(typeof n[0]=="string")e||(e=[]),e.push(n);else for(let r=0;r<n.length;r++)t(n[r]);else for(let r in n)t(n[r])}return t(i),e}function Ft(i,e,t,n){if(typeof e=="string")return{dom:i.createTextNode(e)};if(e.nodeType!=null)return{dom:e};if(e.dom&&e.dom.nodeType!=null)return e;let r=e[0],s;if(typeof r!="string")throw new RangeError("Invalid array passed to renderSpec");if(n&&(s=Po(n))&&s.indexOf(e)>-1)throw new RangeError("Using an array from an attribute object as a DOM spec. This may be an attempted cross site scripting attack.");let o=r.indexOf(" ");o>0&&(t=r.slice(0,o),r=r.slice(o+1));let l,a=t?i.createElementNS(t,r):i.createElement(r),u=e[1],c=1;if(u&&typeof u=="object"&&u.nodeType==null&&!Array.isArray(u)){c=2;for(let d in u)if(u[d]!=null){let f=d.indexOf(" ");f>0?a.setAttributeNS(d.slice(0,f),d.slice(f+1),u[d]):a.setAttribute(d,u[d])}}for(let d=c;d<e.length;d++){let f=e[d];if(f===0){if(d<e.length-1||d>c)throw new RangeError("Content hole must be the only child of its parent node");return{dom:a,contentDOM:a}}else{let{dom:p,contentDOM:h}=Ft(i,f,t,n);if(a.appendChild(p),h){if(l)throw new RangeError("Multiple content holes");l=h}}}return{dom:a,contentDOM:l}}const Kr=65535,Ur=Math.pow(2,16);function Bo(i,e){return i+e*Ur}function Ii(i){return i&Kr}function Vo(i){return(i-(i&Kr))/Ur}const jr=1,Gr=2,Lt=4,Qr=8;class Pn{constructor(e,t,n){this.pos=e,this.delInfo=t,this.recover=n}get deleted(){return(this.delInfo&Qr)>0}get deletedBefore(){return(this.delInfo&(jr|Lt))>0}get deletedAfter(){return(this.delInfo&(Gr|Lt))>0}get deletedAcross(){return(this.delInfo&Lt)>0}}class K{constructor(e,t=!1){if(this.ranges=e,this.inverted=t,!e.length&&K.empty)return K.empty}recover(e){let t=0,n=Ii(e);if(!this.inverted)for(let r=0;r<n;r++)t+=this.ranges[r*3+2]-this.ranges[r*3+1];return this.ranges[n*3]+t+Vo(e)}mapResult(e,t=1){return this._map(e,t,!1)}map(e,t=1){return this._map(e,t,!0)}_map(e,t,n){let r=0,s=this.inverted?2:1,o=this.inverted?1:2;for(let l=0;l<this.ranges.length;l+=3){let a=this.ranges[l]-(this.inverted?r:0);if(a>e)break;let u=this.ranges[l+s],c=this.ranges[l+o],d=a+u;if(e<=d){let f=u?e==a?-1:e==d?1:t:t,p=a+r+(f<0?0:c);if(n)return p;let h=e==(t<0?a:d)?null:Bo(l/3,e-a),m=e==a?Gr:e==d?jr:Lt;return(t<0?e!=a:e!=d)&&(m|=Qr),new Pn(p,m,h)}r+=c-u}return n?e+r:new Pn(e+r,0,null)}touches(e,t){let n=0,r=Ii(t),s=this.inverted?2:1,o=this.inverted?1:2;for(let l=0;l<this.ranges.length;l+=3){let a=this.ranges[l]-(this.inverted?n:0);if(a>e)break;let u=this.ranges[l+s],c=a+u;if(e<=c&&l==r*3)return!0;n+=this.ranges[l+o]-u}return!1}forEach(e){let t=this.inverted?2:1,n=this.inverted?1:2;for(let r=0,s=0;r<this.ranges.length;r+=3){let o=this.ranges[r],l=o-(this.inverted?s:0),a=o+(this.inverted?0:s),u=this.ranges[r+t],c=this.ranges[r+n];e(l,l+u,a,a+c),s+=c-u}}invert(){return new K(this.ranges,!this.inverted)}toString(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)}static offset(e){return e==0?K.empty:new K(e<0?[0,-e,0]:[0,0,e])}}K.empty=new K([]);class Ge{constructor(e=[],t,n=0,r=e.length){this.maps=e,this.mirror=t,this.from=n,this.to=r}slice(e=0,t=this.maps.length){return new Ge(this.maps,this.mirror,e,t)}copy(){return new Ge(this.maps.slice(),this.mirror&&this.mirror.slice(),this.from,this.to)}appendMap(e,t){this.to=this.maps.push(e),t!=null&&this.setMirror(this.maps.length-1,t)}appendMapping(e){for(let t=0,n=this.maps.length;t<e.maps.length;t++){let r=e.getMirror(t);this.appendMap(e.maps[t],r!=null&&r<t?n+r:void 0)}}getMirror(e){if(this.mirror){for(let t=0;t<this.mirror.length;t++)if(this.mirror[t]==e)return this.mirror[t+(t%2?-1:1)]}}setMirror(e,t){this.mirror||(this.mirror=[]),this.mirror.push(e,t)}appendMappingInverted(e){for(let t=e.maps.length-1,n=this.maps.length+e.maps.length;t>=0;t--){let r=e.getMirror(t);this.appendMap(e.maps[t].invert(),r!=null&&r>t?n-r-1:void 0)}}invert(){let e=new Ge;return e.appendMappingInverted(this),e}map(e,t=1){if(this.mirror)return this._map(e,t,!0);for(let n=this.from;n<this.to;n++)e=this.maps[n].map(e,t);return e}mapResult(e,t=1){return this._map(e,t,!1)}_map(e,t,n){let r=0;for(let s=this.from;s<this.to;s++){let o=this.maps[s],l=o.mapResult(e,t);if(l.recover!=null){let a=this.getMirror(s);if(a!=null&&a>s&&a<this.to){s=a,e=this.maps[a].recover(l.recover);continue}}r|=l.delInfo,e=l.pos}return n?e:new Pn(e,r,null)}}const mn=Object.create(null);class T{getMap(){return K.empty}merge(e){return null}static fromJSON(e,t){if(!t||!t.stepType)throw new RangeError("Invalid input for Step.fromJSON");let n=mn[t.stepType];if(!n)throw new RangeError(`No step type ${t.stepType} defined`);return n.fromJSON(e,t)}static jsonID(e,t){if(e in mn)throw new RangeError("Duplicate use of step JSON ID "+e);return mn[e]=t,t.prototype.jsonID=e,t}}class D{constructor(e,t){this.doc=e,this.failed=t}static ok(e){return new D(e,null)}static fail(e){return new D(null,e)}static fromReplace(e,t,n,r){try{return D.ok(e.replace(t,n,r))}catch(s){if(s instanceof $t)return D.fail(s.message);throw s}}}function si(i,e,t){let n=[];for(let r=0;r<i.childCount;r++){let s=i.child(r);s.content.size&&(s=s.copy(si(s.content,e,s))),s.isInline&&(s=e(s,t,r)),n.push(s)}return y.fromArray(n)}class ke extends T{constructor(e,t,n){super(),this.from=e,this.to=t,this.mark=n}apply(e){let t=e.slice(this.from,this.to),n=e.resolve(this.from),r=n.node(n.sharedDepth(this.to)),s=new b(si(t.content,(o,l)=>!o.isAtom||!l.type.allowsMarkType(this.mark.type)?o:o.mark(this.mark.addToSet(o.marks)),r),t.openStart,t.openEnd);return D.fromReplace(e,this.from,this.to,s)}invert(){return new re(this.from,this.to,this.mark)}map(e){let t=e.mapResult(this.from,1),n=e.mapResult(this.to,-1);return t.deleted&&n.deleted||t.pos>=n.pos?null:new ke(t.pos,n.pos,this.mark)}merge(e){return e instanceof ke&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new ke(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,t){if(typeof t.from!="number"||typeof t.to!="number")throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new ke(t.from,t.to,e.markFromJSON(t.mark))}}T.jsonID("addMark",ke);class re extends T{constructor(e,t,n){super(),this.from=e,this.to=t,this.mark=n}apply(e){let t=e.slice(this.from,this.to),n=new b(si(t.content,r=>r.mark(this.mark.removeFromSet(r.marks)),e),t.openStart,t.openEnd);return D.fromReplace(e,this.from,this.to,n)}invert(){return new ke(this.from,this.to,this.mark)}map(e){let t=e.mapResult(this.from,1),n=e.mapResult(this.to,-1);return t.deleted&&n.deleted||t.pos>=n.pos?null:new re(t.pos,n.pos,this.mark)}merge(e){return e instanceof re&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new re(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,t){if(typeof t.from!="number"||typeof t.to!="number")throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new re(t.from,t.to,e.markFromJSON(t.mark))}}T.jsonID("removeMark",re);class Se extends T{constructor(e,t){super(),this.pos=e,this.mark=t}apply(e){let t=e.nodeAt(this.pos);if(!t)return D.fail("No node at mark step's position");let n=t.type.create(t.attrs,null,this.mark.addToSet(t.marks));return D.fromReplace(e,this.pos,this.pos+1,new b(y.from(n),0,t.isLeaf?0:1))}invert(e){let t=e.nodeAt(this.pos);if(t){let n=this.mark.addToSet(t.marks);if(n.length==t.marks.length){for(let r=0;r<t.marks.length;r++)if(!t.marks[r].isInSet(n))return new Se(this.pos,t.marks[r]);return new Se(this.pos,this.mark)}}return new et(this.pos,this.mark)}map(e){let t=e.mapResult(this.pos,1);return t.deletedAfter?null:new Se(t.pos,this.mark)}toJSON(){return{stepType:"addNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,t){if(typeof t.pos!="number")throw new RangeError("Invalid input for AddNodeMarkStep.fromJSON");return new Se(t.pos,e.markFromJSON(t.mark))}}T.jsonID("addNodeMark",Se);class et extends T{constructor(e,t){super(),this.pos=e,this.mark=t}apply(e){let t=e.nodeAt(this.pos);if(!t)return D.fail("No node at mark step's position");let n=t.type.create(t.attrs,null,this.mark.removeFromSet(t.marks));return D.fromReplace(e,this.pos,this.pos+1,new b(y.from(n),0,t.isLeaf?0:1))}invert(e){let t=e.nodeAt(this.pos);return!t||!this.mark.isInSet(t.marks)?this:new Se(this.pos,this.mark)}map(e){let t=e.mapResult(this.pos,1);return t.deletedAfter?null:new et(t.pos,this.mark)}toJSON(){return{stepType:"removeNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,t){if(typeof t.pos!="number")throw new RangeError("Invalid input for RemoveNodeMarkStep.fromJSON");return new et(t.pos,e.markFromJSON(t.mark))}}T.jsonID("removeNodeMark",et);class z extends T{constructor(e,t,n,r=!1){super(),this.from=e,this.to=t,this.slice=n,this.structure=r}apply(e){return this.structure&&zn(e,this.from,this.to)?D.fail("Structure replace would overwrite content"):D.fromReplace(e,this.from,this.to,this.slice)}getMap(){return new K([this.from,this.to-this.from,this.slice.size])}invert(e){return new z(this.from,this.from+this.slice.size,e.slice(this.from,this.to))}map(e){let t=e.mapResult(this.from,1),n=e.mapResult(this.to,-1);return t.deletedAcross&&n.deletedAcross?null:new z(t.pos,Math.max(t.pos,n.pos),this.slice)}merge(e){if(!(e instanceof z)||e.structure||this.structure)return null;if(this.from+this.slice.size==e.from&&!this.slice.openEnd&&!e.slice.openStart){let t=this.slice.size+e.slice.size==0?b.empty:new b(this.slice.content.append(e.slice.content),this.slice.openStart,e.slice.openEnd);return new z(this.from,this.to+(e.to-e.from),t,this.structure)}else if(e.to==this.from&&!this.slice.openStart&&!e.slice.openEnd){let t=this.slice.size+e.slice.size==0?b.empty:new b(e.slice.content.append(this.slice.content),e.slice.openStart,this.slice.openEnd);return new z(e.from,this.to,t,this.structure)}else return null}toJSON(){let e={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,t){if(typeof t.from!="number"||typeof t.to!="number")throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new z(t.from,t.to,b.fromJSON(e,t.slice),!!t.structure)}}T.jsonID("replace",z);class R extends T{constructor(e,t,n,r,s,o,l=!1){super(),this.from=e,this.to=t,this.gapFrom=n,this.gapTo=r,this.slice=s,this.insert=o,this.structure=l}apply(e){if(this.structure&&(zn(e,this.from,this.gapFrom)||zn(e,this.gapTo,this.to)))return D.fail("Structure gap-replace would overwrite content");let t=e.slice(this.gapFrom,this.gapTo);if(t.openStart||t.openEnd)return D.fail("Gap is not a flat range");let n=this.slice.insertAt(this.insert,t.content);return n?D.fromReplace(e,this.from,this.to,n):D.fail("Content does not fit in gap")}getMap(){return new K([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])}invert(e){let t=this.gapTo-this.gapFrom;return new R(this.from,this.from+this.slice.size+t,this.from+this.insert,this.from+this.insert+t,e.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)}map(e){let t=e.mapResult(this.from,1),n=e.mapResult(this.to,-1),r=this.from==this.gapFrom?t.pos:e.map(this.gapFrom,-1),s=this.to==this.gapTo?n.pos:e.map(this.gapTo,1);return t.deletedAcross&&n.deletedAcross||r<t.pos||s>n.pos?null:new R(t.pos,n.pos,r,s,this.slice,this.insert,this.structure)}toJSON(){let e={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,t){if(typeof t.from!="number"||typeof t.to!="number"||typeof t.gapFrom!="number"||typeof t.gapTo!="number"||typeof t.insert!="number")throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new R(t.from,t.to,t.gapFrom,t.gapTo,b.fromJSON(e,t.slice),t.insert,!!t.structure)}}T.jsonID("replaceAround",R);function zn(i,e,t){let n=i.resolve(e),r=t-e,s=n.depth;for(;r>0&&s>0&&n.indexAfter(s)==n.node(s).childCount;)s--,r--;if(r>0){let o=n.node(s).maybeChild(n.indexAfter(s));for(;r>0;){if(!o||o.isLeaf)return!0;o=o.firstChild,r--}}return!1}function Fo(i,e,t,n){let r=[],s=[],o,l;i.doc.nodesBetween(e,t,(a,u,c)=>{if(!a.isInline)return;let d=a.marks;if(!n.isInSet(d)&&c.type.allowsMarkType(n.type)){let f=Math.max(u,e),p=Math.min(u+a.nodeSize,t),h=n.addToSet(d);for(let m=0;m<d.length;m++)d[m].isInSet(h)||(o&&o.to==f&&o.mark.eq(d[m])?o.to=p:r.push(o=new re(f,p,d[m])));l&&l.to==f?l.to=p:s.push(l=new ke(f,p,n))}}),r.forEach(a=>i.step(a)),s.forEach(a=>i.step(a))}function Lo(i,e,t,n){let r=[],s=0;i.doc.nodesBetween(e,t,(o,l)=>{if(!o.isInline)return;s++;let a=null;if(n instanceof on){let u=o.marks,c;for(;c=n.isInSet(u);)(a||(a=[])).push(c),u=c.removeFromSet(u)}else n?n.isInSet(o.marks)&&(a=[n]):a=o.marks;if(a&&a.length){let u=Math.min(l+o.nodeSize,t);for(let c=0;c<a.length;c++){let d=a[c],f;for(let p=0;p<r.length;p++){let h=r[p];h.step==s-1&&d.eq(r[p].style)&&(f=h)}f?(f.to=u,f.step=s):r.push({style:d,from:Math.max(l,e),to:u,step:s})}}}),r.forEach(o=>i.step(new re(o.from,o.to,o.style)))}function Yr(i,e,t,n=t.contentMatch,r=!0){let s=i.doc.nodeAt(e),o=[],l=e+1;for(let a=0;a<s.childCount;a++){let u=s.child(a),c=l+u.nodeSize,d=n.matchType(u.type);if(!d)o.push(new z(l,c,b.empty));else{n=d;for(let f=0;f<u.marks.length;f++)t.allowsMarkType(u.marks[f].type)||i.step(new re(l,c,u.marks[f]));if(r&&u.isText&&t.whitespace!="pre"){let f,p=/\r?\n|\r/g,h;for(;f=p.exec(u.text);)h||(h=new b(y.from(t.schema.text(" ",t.allowedMarks(u.marks))),0,0)),o.push(new z(l+f.index,l+f.index+f[0].length,h))}}l=c}if(!n.validEnd){let a=n.fillBefore(y.empty,!0);i.replace(l,l,new b(a,0,0))}for(let a=o.length-1;a>=0;a--)i.step(o[a])}function Wo(i,e,t){return(e==0||i.canReplace(e,i.childCount))&&(t==i.childCount||i.canReplace(0,t))}function vt(i){let t=i.parent.content.cutByIndex(i.startIndex,i.endIndex);for(let n=i.depth;;--n){let r=i.$from.node(n),s=i.$from.index(n),o=i.$to.indexAfter(n);if(n<i.depth&&r.canReplace(s,o,t))return n;if(n==0||r.type.spec.isolating||!Wo(r,s,o))break}return null}function _o(i,e,t){let{$from:n,$to:r,depth:s}=e,o=n.before(s+1),l=r.after(s+1),a=o,u=l,c=y.empty,d=0;for(let h=s,m=!1;h>t;h--)m||n.index(h)>0?(m=!0,c=y.from(n.node(h).copy(c)),d++):a--;let f=y.empty,p=0;for(let h=s,m=!1;h>t;h--)m||r.after(h+1)<r.end(h)?(m=!0,f=y.from(r.node(h).copy(f)),p++):u++;i.step(new R(a,u,o,l,new b(c.append(f),d,p),c.size-d,!0))}function oi(i,e,t=null,n=i){let r=Jo(i,e),s=r&&Ho(n,e);return s?r.map(qi).concat({type:e,attrs:t}).concat(s.map(qi)):null}function qi(i){return{type:i,attrs:null}}function Jo(i,e){let{parent:t,startIndex:n,endIndex:r}=i,s=t.contentMatchAt(n).findWrapping(e);if(!s)return null;let o=s.length?s[0]:e;return t.canReplaceWith(n,r,o)?s:null}function Ho(i,e){let{parent:t,startIndex:n,endIndex:r}=i,s=t.child(n),o=e.contentMatch.findWrapping(s.type);if(!o)return null;let a=(o.length?o[o.length-1]:e).contentMatch;for(let u=n;a&&u<r;u++)a=a.matchType(t.child(u).type);return!a||!a.validEnd?null:o}function $o(i,e,t){let n=y.empty;for(let o=t.length-1;o>=0;o--){if(n.size){let l=t[o].type.contentMatch.matchFragment(n);if(!l||!l.validEnd)throw new RangeError("Wrapper type given to Transform.wrap does not form valid content of its parent wrapper")}n=y.from(t[o].type.create(t[o].attrs,n))}let r=e.start,s=e.end;i.step(new R(r,s,r,s,new b(n,0,0),t.length,!0))}function Ko(i,e,t,n,r){if(!n.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");let s=i.steps.length;i.doc.nodesBetween(e,t,(o,l)=>{let a=typeof r=="function"?r(o):r;if(o.isTextblock&&!o.hasMarkup(n,a)&&Go(i.doc,i.mapping.slice(s).map(l),n)){let u=null;if(n.schema.linebreakReplacement){let p=n.whitespace=="pre",h=!!n.contentMatch.matchType(n.schema.linebreakReplacement);p&&!h?u=!1:!p&&h&&(u=!0)}u===!1&&jo(i,o,l,s),Yr(i,i.mapping.slice(s).map(l,1),n,void 0,u===null);let c=i.mapping.slice(s),d=c.map(l,1),f=c.map(l+o.nodeSize,1);return i.step(new R(d,f,d+1,f-1,new b(y.from(n.create(a,null,o.marks)),0,0),1,!0)),u===!0&&Uo(i,o,l,s),!1}})}function Uo(i,e,t,n){e.forEach((r,s)=>{if(r.isText){let o,l=/\r?\n|\r/g;for(;o=l.exec(r.text);){let a=i.mapping.slice(n).map(t+1+s+o.index);i.replaceWith(a,a+1,e.type.schema.linebreakReplacement.create())}}})}function jo(i,e,t,n){e.forEach((r,s)=>{if(r.type==r.type.schema.linebreakReplacement){let o=i.mapping.slice(n).map(t+1+s);i.replaceWith(o,o+1,e.type.schema.text(`
`))}})}function Go(i,e,t){let n=i.resolve(e),r=n.index();return n.parent.canReplaceWith(r,r+1,t)}function Qo(i,e,t,n,r){let s=i.doc.nodeAt(e);if(!s)throw new RangeError("No node at given position");t||(t=s.type);let o=t.create(n,null,r||s.marks);if(s.isLeaf)return i.replaceWith(e,e+s.nodeSize,o);if(!t.validContent(s.content))throw new RangeError("Invalid content for node type "+t.name);i.step(new R(e,e+s.nodeSize,e+1,e+s.nodeSize-1,new b(y.from(o),0,0),1,!0))}function Qe(i,e,t=1,n){let r=i.resolve(e),s=r.depth-t,o=n&&n[n.length-1]||r.parent;if(s<0||r.parent.type.spec.isolating||!r.parent.canReplace(r.index(),r.parent.childCount)||!o.type.validContent(r.parent.content.cutByIndex(r.index(),r.parent.childCount)))return!1;for(let u=r.depth-1,c=t-2;u>s;u--,c--){let d=r.node(u),f=r.index(u);if(d.type.spec.isolating)return!1;let p=d.content.cutByIndex(f,d.childCount),h=n&&n[c+1];h&&(p=p.replaceChild(0,h.type.create(h.attrs)));let m=n&&n[c]||d;if(!d.canReplace(f+1,d.childCount)||!m.type.validContent(p))return!1}let l=r.indexAfter(s),a=n&&n[0];return r.node(s).canReplaceWith(l,l,a?a.type:r.node(s+1).type)}function Yo(i,e,t=1,n){let r=i.doc.resolve(e),s=y.empty,o=y.empty;for(let l=r.depth,a=r.depth-t,u=t-1;l>a;l--,u--){s=y.from(r.node(l).copy(s));let c=n&&n[u];o=y.from(c?c.type.create(c.attrs,o):r.node(l).copy(o))}i.step(new z(e,e,new b(s.append(o),t,t),!0))}function st(i,e){let t=i.resolve(e),n=t.index();return Xr(t.nodeBefore,t.nodeAfter)&&t.parent.canReplace(n,n+1)}function Xr(i,e){return!!(i&&e&&!i.isLeaf&&i.canAppend(e))}function Zr(i,e,t=-1){let n=i.resolve(e);for(let r=n.depth;;r--){let s,o,l=n.index(r);if(r==n.depth?(s=n.nodeBefore,o=n.nodeAfter):t>0?(s=n.node(r+1),l++,o=n.node(r).maybeChild(l)):(s=n.node(r).maybeChild(l-1),o=n.node(r+1)),s&&!s.isTextblock&&Xr(s,o)&&n.node(r).canReplace(l,l+1))return e;if(r==0)break;e=t<0?n.before(r):n.after(r)}}function Xo(i,e,t){let n=new z(e-t,e+t,b.empty,!0);i.step(n)}function Zo(i,e,t){let n=i.resolve(e);if(n.parent.canReplaceWith(n.index(),n.index(),t))return e;if(n.parentOffset==0)for(let r=n.depth-1;r>=0;r--){let s=n.index(r);if(n.node(r).canReplaceWith(s,s,t))return n.before(r+1);if(s>0)return null}if(n.parentOffset==n.parent.content.size)for(let r=n.depth-1;r>=0;r--){let s=n.indexAfter(r);if(n.node(r).canReplaceWith(s,s,t))return n.after(r+1);if(s<n.node(r).childCount)return null}return null}function es(i,e,t){let n=i.resolve(e);if(!t.content.size)return e;let r=t.content;for(let s=0;s<t.openStart;s++)r=r.firstChild.content;for(let s=1;s<=(t.openStart==0&&t.size?2:1);s++)for(let o=n.depth;o>=0;o--){let l=o==n.depth?0:n.pos<=(n.start(o+1)+n.end(o+1))/2?-1:1,a=n.index(o)+(l>0?1:0),u=n.node(o),c=!1;if(s==1)c=u.canReplace(a,a,r);else{let d=u.contentMatchAt(a).findWrapping(r.firstChild.type);c=d&&u.canReplaceWith(a,a,d[0])}if(c)return l==0?n.pos:l<0?n.before(o+1):n.after(o+1)}return null}function li(i,e,t=e,n=b.empty){if(e==t&&!n.size)return null;let r=i.resolve(e),s=i.resolve(t);return ts(r,s,n)?new z(e,t,n):new el(r,s,n).fit()}function ts(i,e,t){return!t.openStart&&!t.openEnd&&i.start()==e.start()&&i.parent.canReplace(i.index(),e.index(),t.content)}class el{constructor(e,t,n){this.$from=e,this.$to=t,this.unplaced=n,this.frontier=[],this.placed=y.empty;for(let r=0;r<=e.depth;r++){let s=e.node(r);this.frontier.push({type:s.type,match:s.contentMatchAt(e.indexAfter(r))})}for(let r=e.depth;r>0;r--)this.placed=y.from(e.node(r).copy(this.placed))}get depth(){return this.frontier.length-1}fit(){for(;this.unplaced.size;){let u=this.findFittable();u?this.placeNodes(u):this.openMore()||this.dropNode()}let e=this.mustMoveInline(),t=this.placed.size-this.depth-this.$from.depth,n=this.$from,r=this.close(e<0?this.$to:n.doc.resolve(e));if(!r)return null;let s=this.placed,o=n.depth,l=r.depth;for(;o&&l&&s.childCount==1;)s=s.firstChild.content,o--,l--;let a=new b(s,o,l);return e>-1?new R(n.pos,e,this.$to.pos,this.$to.end(),a,t):a.size||n.pos!=this.$to.pos?new z(n.pos,r.pos,a):null}findFittable(){let e=this.unplaced.openStart;for(let t=this.unplaced.content,n=0,r=this.unplaced.openEnd;n<e;n++){let s=t.firstChild;if(t.childCount>1&&(r=0),s.type.spec.isolating&&r<=n){e=n;break}t=s.content}for(let t=1;t<=2;t++)for(let n=t==1?e:this.unplaced.openStart;n>=0;n--){let r,s=null;n?(s=gn(this.unplaced.content,n-1).firstChild,r=s.content):r=this.unplaced.content;let o=r.firstChild;for(let l=this.depth;l>=0;l--){let{type:a,match:u}=this.frontier[l],c,d=null;if(t==1&&(o?u.matchType(o.type)||(d=u.fillBefore(y.from(o),!1)):s&&a.compatibleContent(s.type)))return{sliceDepth:n,frontierDepth:l,parent:s,inject:d};if(t==2&&o&&(c=u.findWrapping(o.type)))return{sliceDepth:n,frontierDepth:l,parent:s,wrap:c};if(s&&u.matchType(s.type))break}}}openMore(){let{content:e,openStart:t,openEnd:n}=this.unplaced,r=gn(e,t);return!r.childCount||r.firstChild.isLeaf?!1:(this.unplaced=new b(e,t+1,Math.max(n,r.size+t>=e.size-n?t+1:0)),!0)}dropNode(){let{content:e,openStart:t,openEnd:n}=this.unplaced,r=gn(e,t);if(r.childCount<=1&&t>0){let s=e.size-t<=t+r.size;this.unplaced=new b(lt(e,t-1,1),t-1,s?t-1:n)}else this.unplaced=new b(lt(e,t,1),t,n)}placeNodes({sliceDepth:e,frontierDepth:t,parent:n,inject:r,wrap:s}){for(;this.depth>t;)this.closeFrontierNode();if(s)for(let m=0;m<s.length;m++)this.openFrontierNode(s[m]);let o=this.unplaced,l=n?n.content:o.content,a=o.openStart-e,u=0,c=[],{match:d,type:f}=this.frontier[t];if(r){for(let m=0;m<r.childCount;m++)c.push(r.child(m));d=d.matchFragment(r)}let p=l.size+e-(o.content.size-o.openEnd);for(;u<l.childCount;){let m=l.child(u),g=d.matchType(m.type);if(!g)break;u++,(u>1||a==0||m.content.size)&&(d=g,c.push(ns(m.mark(f.allowedMarks(m.marks)),u==1?a:0,u==l.childCount?p:-1)))}let h=u==l.childCount;h||(p=-1),this.placed=at(this.placed,t,y.from(c)),this.frontier[t].match=d,h&&p<0&&n&&n.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(let m=0,g=l;m<p;m++){let x=g.lastChild;this.frontier.push({type:x.type,match:x.contentMatchAt(x.childCount)}),g=x.content}this.unplaced=h?e==0?b.empty:new b(lt(o.content,e-1,1),e-1,p<0?o.openEnd:e-1):new b(lt(o.content,e,u),o.openStart,o.openEnd)}mustMoveInline(){if(!this.$to.parent.isTextblock)return-1;let e=this.frontier[this.depth],t;if(!e.type.isTextblock||!yn(this.$to,this.$to.depth,e.type,e.match,!1)||this.$to.depth==this.depth&&(t=this.findCloseLevel(this.$to))&&t.depth==this.depth)return-1;let{depth:n}=this.$to,r=this.$to.after(n);for(;n>1&&r==this.$to.end(--n);)++r;return r}findCloseLevel(e){e:for(let t=Math.min(this.depth,e.depth);t>=0;t--){let{match:n,type:r}=this.frontier[t],s=t<e.depth&&e.end(t+1)==e.pos+(e.depth-(t+1)),o=yn(e,t,r,n,s);if(o){for(let l=t-1;l>=0;l--){let{match:a,type:u}=this.frontier[l],c=yn(e,l,u,a,!0);if(!c||c.childCount)continue e}return{depth:t,fit:o,move:s?e.doc.resolve(e.after(t+1)):e}}}}close(e){let t=this.findCloseLevel(e);if(!t)return null;for(;this.depth>t.depth;)this.closeFrontierNode();t.fit.childCount&&(this.placed=at(this.placed,t.depth,t.fit)),e=t.move;for(let n=t.depth+1;n<=e.depth;n++){let r=e.node(n),s=r.type.contentMatch.fillBefore(r.content,!0,e.index(n));this.openFrontierNode(r.type,r.attrs,s)}return e}openFrontierNode(e,t=null,n){let r=this.frontier[this.depth];r.match=r.match.matchType(e),this.placed=at(this.placed,this.depth,y.from(e.create(t,n))),this.frontier.push({type:e,match:e.contentMatch})}closeFrontierNode(){let t=this.frontier.pop().match.fillBefore(y.empty,!0);t.childCount&&(this.placed=at(this.placed,this.frontier.length,t))}}function lt(i,e,t){return e==0?i.cutByIndex(t,i.childCount):i.replaceChild(0,i.firstChild.copy(lt(i.firstChild.content,e-1,t)))}function at(i,e,t){return e==0?i.append(t):i.replaceChild(i.childCount-1,i.lastChild.copy(at(i.lastChild.content,e-1,t)))}function gn(i,e){for(let t=0;t<e;t++)i=i.firstChild.content;return i}function ns(i,e,t){if(e<=0)return i;let n=i.content;return e>1&&(n=n.replaceChild(0,ns(n.firstChild,e-1,n.childCount==1?t-1:0))),e>0&&(n=i.type.contentMatch.fillBefore(n).append(n),t<=0&&(n=n.append(i.type.contentMatch.matchFragment(n).fillBefore(y.empty,!0)))),i.copy(n)}function yn(i,e,t,n,r){let s=i.node(e),o=r?i.indexAfter(e):i.index(e);if(o==s.childCount&&!t.compatibleContent(s.type))return null;let l=n.fillBefore(s.content,!0,o);return l&&!tl(t,s.content,o)?l:null}function tl(i,e,t){for(let n=t;n<e.childCount;n++)if(!i.allowsMarks(e.child(n).marks))return!0;return!1}function nl(i){return i.spec.defining||i.spec.definingForContent}function il(i,e,t,n){if(!n.size)return i.deleteRange(e,t);let r=i.doc.resolve(e),s=i.doc.resolve(t);if(ts(r,s,n))return i.step(new z(e,t,n));let o=rs(r,i.doc.resolve(t));o[o.length-1]==0&&o.pop();let l=-(r.depth+1);o.unshift(l);for(let f=r.depth,p=r.pos-1;f>0;f--,p--){let h=r.node(f).type.spec;if(h.defining||h.definingAsContext||h.isolating)break;o.indexOf(f)>-1?l=f:r.before(f)==p&&o.splice(1,0,-f)}let a=o.indexOf(l),u=[],c=n.openStart;for(let f=n.content,p=0;;p++){let h=f.firstChild;if(u.push(h),p==n.openStart)break;f=h.content}for(let f=c-1;f>=0;f--){let p=u[f],h=nl(p.type);if(h&&!p.sameMarkup(r.node(Math.abs(l)-1)))c=f;else if(h||!p.type.isTextblock)break}for(let f=n.openStart;f>=0;f--){let p=(f+c+1)%(n.openStart+1),h=u[p];if(h)for(let m=0;m<o.length;m++){let g=o[(m+a)%o.length],x=!0;g<0&&(x=!1,g=-g);let O=r.node(g-1),W=r.index(g-1);if(O.canReplaceWith(W,W,h.type,h.marks))return i.replace(r.before(g),x?s.after(g):t,new b(is(n.content,0,n.openStart,p),p,n.openEnd))}}let d=i.steps.length;for(let f=o.length-1;f>=0&&(i.replace(e,t,n),!(i.steps.length>d));f--){let p=o[f];p<0||(e=r.before(p),t=s.after(p))}}function is(i,e,t,n,r){if(e<t){let s=i.firstChild;i=i.replaceChild(0,s.copy(is(s.content,e+1,t,n,s)))}if(e>n){let s=r.contentMatchAt(0),o=s.fillBefore(i).append(i);i=o.append(s.matchFragment(o).fillBefore(y.empty,!0))}return i}function rl(i,e,t,n){if(!n.isInline&&e==t&&i.doc.resolve(e).parent.content.size){let r=Zo(i.doc,e,n.type);r!=null&&(e=t=r)}i.replaceRange(e,t,new b(y.from(n),0,0))}function sl(i,e,t){let n=i.doc.resolve(e),r=i.doc.resolve(t),s=rs(n,r);for(let o=0;o<s.length;o++){let l=s[o],a=o==s.length-1;if(a&&l==0||n.node(l).type.contentMatch.validEnd)return i.delete(n.start(l),r.end(l));if(l>0&&(a||n.node(l-1).canReplace(n.index(l-1),r.indexAfter(l-1))))return i.delete(n.before(l),r.after(l))}for(let o=1;o<=n.depth&&o<=r.depth;o++)if(e-n.start(o)==n.depth-o&&t>n.end(o)&&r.end(o)-t!=r.depth-o)return i.delete(n.before(o),t);i.delete(e,t)}function rs(i,e){let t=[],n=Math.min(i.depth,e.depth);for(let r=n;r>=0;r--){let s=i.start(r);if(s<i.pos-(i.depth-r)||e.end(r)>e.pos+(e.depth-r)||i.node(r).type.spec.isolating||e.node(r).type.spec.isolating)break;(s==e.start(r)||r==i.depth&&r==e.depth&&i.parent.inlineContent&&e.parent.inlineContent&&r&&e.start(r-1)==s-1)&&t.push(r)}return t}class Ye extends T{constructor(e,t,n){super(),this.pos=e,this.attr=t,this.value=n}apply(e){let t=e.nodeAt(this.pos);if(!t)return D.fail("No node at attribute step's position");let n=Object.create(null);for(let s in t.attrs)n[s]=t.attrs[s];n[this.attr]=this.value;let r=t.type.create(n,null,t.marks);return D.fromReplace(e,this.pos,this.pos+1,new b(y.from(r),0,t.isLeaf?0:1))}getMap(){return K.empty}invert(e){return new Ye(this.pos,this.attr,e.nodeAt(this.pos).attrs[this.attr])}map(e){let t=e.mapResult(this.pos,1);return t.deletedAfter?null:new Ye(t.pos,this.attr,this.value)}toJSON(){return{stepType:"attr",pos:this.pos,attr:this.attr,value:this.value}}static fromJSON(e,t){if(typeof t.pos!="number"||typeof t.attr!="string")throw new RangeError("Invalid input for AttrStep.fromJSON");return new Ye(t.pos,t.attr,t.value)}}T.jsonID("attr",Ye);class bt extends T{constructor(e,t){super(),this.attr=e,this.value=t}apply(e){let t=Object.create(null);for(let r in e.attrs)t[r]=e.attrs[r];t[this.attr]=this.value;let n=e.type.create(t,e.content,e.marks);return D.ok(n)}getMap(){return K.empty}invert(e){return new bt(this.attr,e.attrs[this.attr])}map(e){return this}toJSON(){return{stepType:"docAttr",attr:this.attr,value:this.value}}static fromJSON(e,t){if(typeof t.attr!="string")throw new RangeError("Invalid input for DocAttrStep.fromJSON");return new bt(t.attr,t.value)}}T.jsonID("docAttr",bt);let tt=class extends Error{};tt=function i(e){let t=Error.call(this,e);return t.__proto__=i.prototype,t};tt.prototype=Object.create(Error.prototype);tt.prototype.constructor=tt;tt.prototype.name="TransformError";class ol{constructor(e){this.doc=e,this.steps=[],this.docs=[],this.mapping=new Ge}get before(){return this.docs.length?this.docs[0]:this.doc}step(e){let t=this.maybeStep(e);if(t.failed)throw new tt(t.failed);return this}maybeStep(e){let t=e.apply(this.doc);return t.failed||this.addStep(e,t.doc),t}get docChanged(){return this.steps.length>0}addStep(e,t){this.docs.push(this.doc),this.steps.push(e),this.mapping.appendMap(e.getMap()),this.doc=t}replace(e,t=e,n=b.empty){let r=li(this.doc,e,t,n);return r&&this.step(r),this}replaceWith(e,t,n){return this.replace(e,t,new b(y.from(n),0,0))}delete(e,t){return this.replace(e,t,b.empty)}insert(e,t){return this.replaceWith(e,e,t)}replaceRange(e,t,n){return il(this,e,t,n),this}replaceRangeWith(e,t,n){return rl(this,e,t,n),this}deleteRange(e,t){return sl(this,e,t),this}lift(e,t){return _o(this,e,t),this}join(e,t=1){return Xo(this,e,t),this}wrap(e,t){return $o(this,e,t),this}setBlockType(e,t=e,n,r=null){return Ko(this,e,t,n,r),this}setNodeMarkup(e,t,n=null,r){return Qo(this,e,t,n,r),this}setNodeAttribute(e,t,n){return this.step(new Ye(e,t,n)),this}setDocAttribute(e,t){return this.step(new bt(e,t)),this}addNodeMark(e,t){return this.step(new Se(e,t)),this}removeNodeMark(e,t){if(!(t instanceof M)){let n=this.doc.nodeAt(e);if(!n)throw new RangeError("No node at position "+e);if(t=t.isInSet(n.marks),!t)return this}return this.step(new et(e,t)),this}split(e,t=1,n){return Yo(this,e,t,n),this}addMark(e,t,n){return Fo(this,e,t,n),this}removeMark(e,t,n){return Lo(this,e,t,n),this}clearIncompatible(e,t,n){return Yr(this,e,t,n),this}}const bn=Object.create(null);class S{constructor(e,t,n){this.$anchor=e,this.$head=t,this.ranges=n||[new ll(e.min(t),e.max(t))]}get anchor(){return this.$anchor.pos}get head(){return this.$head.pos}get from(){return this.$from.pos}get to(){return this.$to.pos}get $from(){return this.ranges[0].$from}get $to(){return this.ranges[0].$to}get empty(){let e=this.ranges;for(let t=0;t<e.length;t++)if(e[t].$from.pos!=e[t].$to.pos)return!1;return!0}content(){return this.$from.doc.slice(this.from,this.to,!0)}replace(e,t=b.empty){let n=t.content.lastChild,r=null;for(let l=0;l<t.openEnd;l++)r=n,n=n.lastChild;let s=e.steps.length,o=this.ranges;for(let l=0;l<o.length;l++){let{$from:a,$to:u}=o[l],c=e.mapping.slice(s);e.replaceRange(c.map(a.pos),c.map(u.pos),l?b.empty:t),l==0&&zi(e,s,(n?n.isInline:r&&r.isTextblock)?-1:1)}}replaceWith(e,t){let n=e.steps.length,r=this.ranges;for(let s=0;s<r.length;s++){let{$from:o,$to:l}=r[s],a=e.mapping.slice(n),u=a.map(o.pos),c=a.map(l.pos);s?e.deleteRange(u,c):(e.replaceRangeWith(u,c,t),zi(e,n,t.isInline?-1:1))}}static findFrom(e,t,n=!1){let r=e.parent.inlineContent?new C(e):Ke(e.node(0),e.parent,e.pos,e.index(),t,n);if(r)return r;for(let s=e.depth-1;s>=0;s--){let o=t<0?Ke(e.node(0),e.node(s),e.before(s+1),e.index(s),t,n):Ke(e.node(0),e.node(s),e.after(s+1),e.index(s)+1,t,n);if(o)return o}return null}static near(e,t=1){return this.findFrom(e,t)||this.findFrom(e,-t)||new U(e.node(0))}static atStart(e){return Ke(e,e,0,0,1)||new U(e)}static atEnd(e){return Ke(e,e,e.content.size,e.childCount,-1)||new U(e)}static fromJSON(e,t){if(!t||!t.type)throw new RangeError("Invalid input for Selection.fromJSON");let n=bn[t.type];if(!n)throw new RangeError(`No selection type ${t.type} defined`);return n.fromJSON(e,t)}static jsonID(e,t){if(e in bn)throw new RangeError("Duplicate use of selection JSON ID "+e);return bn[e]=t,t.prototype.jsonID=e,t}getBookmark(){return C.between(this.$anchor,this.$head).getBookmark()}}S.prototype.visible=!0;class ll{constructor(e,t){this.$from=e,this.$to=t}}let Ri=!1;function Pi(i){!Ri&&!i.parent.inlineContent&&(Ri=!0,console.warn("TextSelection endpoint not pointing into a node with inline content ("+i.parent.type.name+")"))}class C extends S{constructor(e,t=e){Pi(e),Pi(t),super(e,t)}get $cursor(){return this.$anchor.pos==this.$head.pos?this.$head:null}map(e,t){let n=e.resolve(t.map(this.head));if(!n.parent.inlineContent)return S.near(n);let r=e.resolve(t.map(this.anchor));return new C(r.parent.inlineContent?r:n,n)}replace(e,t=b.empty){if(super.replace(e,t),t==b.empty){let n=this.$from.marksAcross(this.$to);n&&e.ensureMarks(n)}}eq(e){return e instanceof C&&e.anchor==this.anchor&&e.head==this.head}getBookmark(){return new ln(this.anchor,this.head)}toJSON(){return{type:"text",anchor:this.anchor,head:this.head}}static fromJSON(e,t){if(typeof t.anchor!="number"||typeof t.head!="number")throw new RangeError("Invalid input for TextSelection.fromJSON");return new C(e.resolve(t.anchor),e.resolve(t.head))}static create(e,t,n=t){let r=e.resolve(t);return new this(r,n==t?r:e.resolve(n))}static between(e,t,n){let r=e.pos-t.pos;if((!n||r)&&(n=r>=0?1:-1),!t.parent.inlineContent){let s=S.findFrom(t,n,!0)||S.findFrom(t,-n,!0);if(s)t=s.$head;else return S.near(t,n)}return e.parent.inlineContent||(r==0?e=t:(e=(S.findFrom(e,-n,!0)||S.findFrom(e,n,!0)).$anchor,e.pos<t.pos!=r<0&&(e=t))),new C(e,t)}}S.jsonID("text",C);class ln{constructor(e,t){this.anchor=e,this.head=t}map(e){return new ln(e.map(this.anchor),e.map(this.head))}resolve(e){return C.between(e.resolve(this.anchor),e.resolve(this.head))}}class k extends S{constructor(e){let t=e.nodeAfter,n=e.node(0).resolve(e.pos+t.nodeSize);super(e,n),this.node=t}map(e,t){let{deleted:n,pos:r}=t.mapResult(this.anchor),s=e.resolve(r);return n?S.near(s):new k(s)}content(){return new b(y.from(this.node),0,0)}eq(e){return e instanceof k&&e.anchor==this.anchor}toJSON(){return{type:"node",anchor:this.anchor}}getBookmark(){return new ai(this.anchor)}static fromJSON(e,t){if(typeof t.anchor!="number")throw new RangeError("Invalid input for NodeSelection.fromJSON");return new k(e.resolve(t.anchor))}static create(e,t){return new k(e.resolve(t))}static isSelectable(e){return!e.isText&&e.type.spec.selectable!==!1}}k.prototype.visible=!1;S.jsonID("node",k);class ai{constructor(e){this.anchor=e}map(e){let{deleted:t,pos:n}=e.mapResult(this.anchor);return t?new ln(n,n):new ai(n)}resolve(e){let t=e.resolve(this.anchor),n=t.nodeAfter;return n&&k.isSelectable(n)?new k(t):S.near(t)}}class U extends S{constructor(e){super(e.resolve(0),e.resolve(e.content.size))}replace(e,t=b.empty){if(t==b.empty){e.delete(0,e.doc.content.size);let n=S.atStart(e.doc);n.eq(e.selection)||e.setSelection(n)}else super.replace(e,t)}toJSON(){return{type:"all"}}static fromJSON(e){return new U(e)}map(e){return new U(e)}eq(e){return e instanceof U}getBookmark(){return al}}S.jsonID("all",U);const al={map(){return this},resolve(i){return new U(i)}};function Ke(i,e,t,n,r,s=!1){if(e.inlineContent)return C.create(i,t);for(let o=n-(r>0?0:1);r>0?o<e.childCount:o>=0;o+=r){let l=e.child(o);if(l.isAtom){if(!s&&k.isSelectable(l))return k.create(i,t-(r<0?l.nodeSize:0))}else{let a=Ke(i,l,t+r,r<0?l.childCount:0,r,s);if(a)return a}t+=l.nodeSize*r}return null}function zi(i,e,t){let n=i.steps.length-1;if(n<e)return;let r=i.steps[n];if(!(r instanceof z||r instanceof R))return;let s=i.mapping.maps[n],o;s.forEach((l,a,u,c)=>{o==null&&(o=c)}),i.setSelection(S.near(i.doc.resolve(o),t))}const Bi=1,Rt=2,Vi=4;class ul extends ol{constructor(e){super(e.doc),this.curSelectionFor=0,this.updated=0,this.meta=Object.create(null),this.time=Date.now(),this.curSelection=e.selection,this.storedMarks=e.storedMarks}get selection(){return this.curSelectionFor<this.steps.length&&(this.curSelection=this.curSelection.map(this.doc,this.mapping.slice(this.curSelectionFor)),this.curSelectionFor=this.steps.length),this.curSelection}setSelection(e){if(e.$from.doc!=this.doc)throw new RangeError("Selection passed to setSelection must point at the current document");return this.curSelection=e,this.curSelectionFor=this.steps.length,this.updated=(this.updated|Bi)&~Rt,this.storedMarks=null,this}get selectionSet(){return(this.updated&Bi)>0}setStoredMarks(e){return this.storedMarks=e,this.updated|=Rt,this}ensureMarks(e){return M.sameSet(this.storedMarks||this.selection.$from.marks(),e)||this.setStoredMarks(e),this}addStoredMark(e){return this.ensureMarks(e.addToSet(this.storedMarks||this.selection.$head.marks()))}removeStoredMark(e){return this.ensureMarks(e.removeFromSet(this.storedMarks||this.selection.$head.marks()))}get storedMarksSet(){return(this.updated&Rt)>0}addStep(e,t){super.addStep(e,t),this.updated=this.updated&~Rt,this.storedMarks=null}setTime(e){return this.time=e,this}replaceSelection(e){return this.selection.replace(this,e),this}replaceSelectionWith(e,t=!0){let n=this.selection;return t&&(e=e.mark(this.storedMarks||(n.empty?n.$from.marks():n.$from.marksAcross(n.$to)||M.none))),n.replaceWith(this,e),this}deleteSelection(){return this.selection.replace(this),this}insertText(e,t,n){let r=this.doc.type.schema;if(t==null)return e?this.replaceSelectionWith(r.text(e),!0):this.deleteSelection();{if(n==null&&(n=t),n=n??t,!e)return this.deleteRange(t,n);let s=this.storedMarks;if(!s){let o=this.doc.resolve(t);s=n==t?o.marks():o.marksAcross(this.doc.resolve(n))}return this.replaceRangeWith(t,n,r.text(e,s)),this.selection.empty||this.setSelection(S.near(this.selection.$to)),this}}setMeta(e,t){return this.meta[typeof e=="string"?e:e.key]=t,this}getMeta(e){return this.meta[typeof e=="string"?e:e.key]}get isGeneric(){for(let e in this.meta)return!1;return!0}scrollIntoView(){return this.updated|=Vi,this}get scrolledIntoView(){return(this.updated&Vi)>0}}function Fi(i,e){return!e||!i?i:i.bind(e)}class ut{constructor(e,t,n){this.name=e,this.init=Fi(t.init,n),this.apply=Fi(t.apply,n)}}const cl=[new ut("doc",{init(i){return i.doc||i.schema.topNodeType.createAndFill()},apply(i){return i.doc}}),new ut("selection",{init(i,e){return i.selection||S.atStart(e.doc)},apply(i){return i.selection}}),new ut("storedMarks",{init(i){return i.storedMarks||null},apply(i,e,t,n){return n.selection.$cursor?i.storedMarks:null}}),new ut("scrollToSelection",{init(){return 0},apply(i,e){return i.scrolledIntoView?e+1:e}})];class xn{constructor(e,t){this.schema=e,this.plugins=[],this.pluginsByKey=Object.create(null),this.fields=cl.slice(),t&&t.forEach(n=>{if(this.pluginsByKey[n.key])throw new RangeError("Adding different instances of a keyed plugin ("+n.key+")");this.plugins.push(n),this.pluginsByKey[n.key]=n,n.spec.state&&this.fields.push(new ut(n.key,n.spec.state,n))})}}class je{constructor(e){this.config=e}get schema(){return this.config.schema}get plugins(){return this.config.plugins}apply(e){return this.applyTransaction(e).state}filterTransaction(e,t=-1){for(let n=0;n<this.config.plugins.length;n++)if(n!=t){let r=this.config.plugins[n];if(r.spec.filterTransaction&&!r.spec.filterTransaction.call(r,e,this))return!1}return!0}applyTransaction(e){if(!this.filterTransaction(e))return{state:this,transactions:[]};let t=[e],n=this.applyInner(e),r=null;for(;;){let s=!1;for(let o=0;o<this.config.plugins.length;o++){let l=this.config.plugins[o];if(l.spec.appendTransaction){let a=r?r[o].n:0,u=r?r[o].state:this,c=a<t.length&&l.spec.appendTransaction.call(l,a?t.slice(a):t,u,n);if(c&&n.filterTransaction(c,o)){if(c.setMeta("appendedTransaction",e),!r){r=[];for(let d=0;d<this.config.plugins.length;d++)r.push(d<o?{state:n,n:t.length}:{state:this,n:0})}t.push(c),n=n.applyInner(c),s=!0}r&&(r[o]={state:n,n:t.length})}}if(!s)return{state:n,transactions:t}}}applyInner(e){if(!e.before.eq(this.doc))throw new RangeError("Applying a mismatched transaction");let t=new je(this.config),n=this.config.fields;for(let r=0;r<n.length;r++){let s=n[r];t[s.name]=s.apply(e,this[s.name],this,t)}return t}get tr(){return new ul(this)}static create(e){let t=new xn(e.doc?e.doc.type.schema:e.schema,e.plugins),n=new je(t);for(let r=0;r<t.fields.length;r++)n[t.fields[r].name]=t.fields[r].init(e,n);return n}reconfigure(e){let t=new xn(this.schema,e.plugins),n=t.fields,r=new je(t);for(let s=0;s<n.length;s++){let o=n[s].name;r[o]=this.hasOwnProperty(o)?this[o]:n[s].init(e,r)}return r}toJSON(e){let t={doc:this.doc.toJSON(),selection:this.selection.toJSON()};if(this.storedMarks&&(t.storedMarks=this.storedMarks.map(n=>n.toJSON())),e&&typeof e=="object")for(let n in e){if(n=="doc"||n=="selection")throw new RangeError("The JSON fields `doc` and `selection` are reserved");let r=e[n],s=r.spec.state;s&&s.toJSON&&(t[n]=s.toJSON.call(r,this[r.key]))}return t}static fromJSON(e,t,n){if(!t)throw new RangeError("Invalid input for EditorState.fromJSON");if(!e.schema)throw new RangeError("Required config field 'schema' missing");let r=new xn(e.schema,e.plugins),s=new je(r);return r.fields.forEach(o=>{if(o.name=="doc")s.doc=Pe.fromJSON(e.schema,t.doc);else if(o.name=="selection")s.selection=S.fromJSON(s.doc,t.selection);else if(o.name=="storedMarks")t.storedMarks&&(s.storedMarks=t.storedMarks.map(e.schema.markFromJSON));else{if(n)for(let l in n){let a=n[l],u=a.spec.state;if(a.key==o.name&&u&&u.fromJSON&&Object.prototype.hasOwnProperty.call(t,l)){s[o.name]=u.fromJSON.call(a,e,t[l],s);return}}s[o.name]=o.init(e,s)}}),s}}function ss(i,e,t){for(let n in i){let r=i[n];r instanceof Function?r=r.bind(e):n=="handleDOMEvents"&&(r=ss(r,e,{})),t[n]=r}return t}class le{constructor(e){this.spec=e,this.props={},e.props&&ss(e.props,this,this.props),this.key=e.key?e.key.key:ls("plugin")}getState(e){return e[this.key]}}const kn=Object.create(null);function ls(i){return i in kn?i+"$"+ ++kn[i]:(kn[i]=0,i+"$")}class ui{constructor(e="key"){this.key=ls(e)}get(e){return e.config.pluginsByKey[this.key]}getState(e){return e[this.key]}}const I=function(i){for(var e=0;;e++)if(i=i.previousSibling,!i)return e},xt=function(i){let e=i.assignedSlot||i.parentNode;return e&&e.nodeType==11?e.host:e};let Bn=null;const ue=function(i,e,t){let n=Bn||(Bn=document.createRange());return n.setEnd(i,t??i.nodeValue.length),n.setStart(i,e||0),n},dl=function(){Bn=null},We=function(i,e,t,n){return t&&(Li(i,e,t,n,-1)||Li(i,e,t,n,1))},fl=/^(img|br|input|textarea|hr)$/i;function Li(i,e,t,n,r){for(;;){if(i==t&&e==n)return!0;if(e==(r<0?0:Y(i))){let s=i.parentNode;if(!s||s.nodeType!=1||Nt(i)||fl.test(i.nodeName)||i.contentEditable=="false")return!1;e=I(i)+(r<0?0:1),i=s}else if(i.nodeType==1){if(i=i.childNodes[e+(r<0?-1:0)],i.contentEditable=="false")return!1;e=r<0?Y(i):0}else return!1}}function Y(i){return i.nodeType==3?i.nodeValue.length:i.childNodes.length}function hl(i,e){for(;;){if(i.nodeType==3&&e)return i;if(i.nodeType==1&&e>0){if(i.contentEditable=="false")return null;i=i.childNodes[e-1],e=Y(i)}else if(i.parentNode&&!Nt(i))e=I(i),i=i.parentNode;else return null}}function pl(i,e){for(;;){if(i.nodeType==3&&e<i.nodeValue.length)return i;if(i.nodeType==1&&e<i.childNodes.length){if(i.contentEditable=="false")return null;i=i.childNodes[e],e=0}else if(i.parentNode&&!Nt(i))e=I(i)+1,i=i.parentNode;else return null}}function ml(i,e,t){for(let n=e==0,r=e==Y(i);n||r;){if(i==t)return!0;let s=I(i);if(i=i.parentNode,!i)return!1;n=n&&s==0,r=r&&s==Y(i)}}function Nt(i){let e;for(let t=i;t&&!(e=t.pmViewDesc);t=t.parentNode);return e&&e.node&&e.node.isBlock&&(e.dom==i||e.contentDOM==i)}const an=function(i){return i.focusNode&&We(i.focusNode,i.focusOffset,i.anchorNode,i.anchorOffset)};function Te(i,e){let t=document.createEvent("Event");return t.initEvent("keydown",!0,!0),t.keyCode=i,t.key=t.code=e,t}function gl(i){let e=i.activeElement;for(;e&&e.shadowRoot;)e=e.shadowRoot.activeElement;return e}function yl(i,e,t){if(i.caretPositionFromPoint)try{let n=i.caretPositionFromPoint(e,t);if(n)return{node:n.offsetNode,offset:Math.min(Y(n.offsetNode),n.offset)}}catch{}if(i.caretRangeFromPoint){let n=i.caretRangeFromPoint(e,t);if(n)return{node:n.startContainer,offset:Math.min(Y(n.startContainer),n.startOffset)}}}const se=typeof navigator<"u"?navigator:null,Wi=typeof document<"u"?document:null,Ne=se&&se.userAgent||"",Vn=/Edge\/(\d+)/.exec(Ne),as=/MSIE \d/.exec(Ne),Fn=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(Ne),H=!!(as||Fn||Vn),Ce=as?document.documentMode:Fn?+Fn[1]:Vn?+Vn[1]:0,te=!H&&/gecko\/(\d+)/i.test(Ne);te&&+(/Firefox\/(\d+)/.exec(Ne)||[0,0])[1];const Ln=!H&&/Chrome\/(\d+)/.exec(Ne),B=!!Ln,us=Ln?+Ln[1]:0,V=!H&&!!se&&/Apple Computer/.test(se.vendor),nt=V&&(/Mobile\/\w+/.test(Ne)||!!se&&se.maxTouchPoints>2),G=nt||(se?/Mac/.test(se.platform):!1),bl=se?/Win/.test(se.platform):!1,Z=/Android \d/.test(Ne),Dt=!!Wi&&"webkitFontSmoothing"in Wi.documentElement.style,xl=Dt?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0;function kl(i){let e=i.defaultView&&i.defaultView.visualViewport;return e?{left:0,right:e.width,top:0,bottom:e.height}:{left:0,right:i.documentElement.clientWidth,top:0,bottom:i.documentElement.clientHeight}}function ae(i,e){return typeof i=="number"?i:i[e]}function Sl(i){let e=i.getBoundingClientRect(),t=e.width/i.offsetWidth||1,n=e.height/i.offsetHeight||1;return{left:e.left,right:e.left+i.clientWidth*t,top:e.top,bottom:e.top+i.clientHeight*n}}function _i(i,e,t){let n=i.someProp("scrollThreshold")||0,r=i.someProp("scrollMargin")||5,s=i.dom.ownerDocument;for(let o=t||i.dom;o;o=xt(o)){if(o.nodeType!=1)continue;let l=o,a=l==s.body,u=a?kl(s):Sl(l),c=0,d=0;if(e.top<u.top+ae(n,"top")?d=-(u.top-e.top+ae(r,"top")):e.bottom>u.bottom-ae(n,"bottom")&&(d=e.bottom-e.top>u.bottom-u.top?e.top+ae(r,"top")-u.top:e.bottom-u.bottom+ae(r,"bottom")),e.left<u.left+ae(n,"left")?c=-(u.left-e.left+ae(r,"left")):e.right>u.right-ae(n,"right")&&(c=e.right-u.right+ae(r,"right")),c||d)if(a)s.defaultView.scrollBy(c,d);else{let f=l.scrollLeft,p=l.scrollTop;d&&(l.scrollTop+=d),c&&(l.scrollLeft+=c);let h=l.scrollLeft-f,m=l.scrollTop-p;e={left:e.left-h,top:e.top-m,right:e.right-h,bottom:e.bottom-m}}if(a||/^(fixed|sticky)$/.test(getComputedStyle(o).position))break}}function wl(i){let e=i.dom.getBoundingClientRect(),t=Math.max(0,e.top),n,r;for(let s=(e.left+e.right)/2,o=t+1;o<Math.min(innerHeight,e.bottom);o+=5){let l=i.root.elementFromPoint(s,o);if(!l||l==i.dom||!i.dom.contains(l))continue;let a=l.getBoundingClientRect();if(a.top>=t-20){n=l,r=a.top;break}}return{refDOM:n,refTop:r,stack:cs(i.dom)}}function cs(i){let e=[],t=i.ownerDocument;for(let n=i;n&&(e.push({dom:n,top:n.scrollTop,left:n.scrollLeft}),i!=t);n=xt(n));return e}function Cl({refDOM:i,refTop:e,stack:t}){let n=i?i.getBoundingClientRect().top:0;ds(t,n==0?0:n-e)}function ds(i,e){for(let t=0;t<i.length;t++){let{dom:n,top:r,left:s}=i[t];n.scrollTop!=r+e&&(n.scrollTop=r+e),n.scrollLeft!=s&&(n.scrollLeft=s)}}let Je=null;function Ml(i){if(i.setActive)return i.setActive();if(Je)return i.focus(Je);let e=cs(i);i.focus(Je==null?{get preventScroll(){return Je={preventScroll:!0},!0}}:void 0),Je||(Je=!1,ds(e,0))}function fs(i,e){let t,n=2e8,r,s=0,o=e.top,l=e.top,a,u;for(let c=i.firstChild,d=0;c;c=c.nextSibling,d++){let f;if(c.nodeType==1)f=c.getClientRects();else if(c.nodeType==3)f=ue(c).getClientRects();else continue;for(let p=0;p<f.length;p++){let h=f[p];if(h.top<=o&&h.bottom>=l){o=Math.max(h.bottom,o),l=Math.min(h.top,l);let m=h.left>e.left?h.left-e.left:h.right<e.left?e.left-h.right:0;if(m<n){t=c,n=m,r=m&&t.nodeType==3?{left:h.right<e.left?h.right:h.left,top:e.top}:e,c.nodeType==1&&m&&(s=d+(e.left>=(h.left+h.right)/2?1:0));continue}}else h.top>e.top&&!a&&h.left<=e.left&&h.right>=e.left&&(a=c,u={left:Math.max(h.left,Math.min(h.right,e.left)),top:h.top});!t&&(e.left>=h.right&&e.top>=h.top||e.left>=h.left&&e.top>=h.bottom)&&(s=d+1)}}return!t&&a&&(t=a,r=u,n=0),t&&t.nodeType==3?Ol(t,r):!t||n&&t.nodeType==1?{node:i,offset:s}:fs(t,r)}function Ol(i,e){let t=i.nodeValue.length,n=document.createRange();for(let r=0;r<t;r++){n.setEnd(i,r+1),n.setStart(i,r);let s=me(n,1);if(s.top!=s.bottom&&ci(e,s))return{node:i,offset:r+(e.left>=(s.left+s.right)/2?1:0)}}return{node:i,offset:0}}function ci(i,e){return i.left>=e.left-1&&i.left<=e.right+1&&i.top>=e.top-1&&i.top<=e.bottom+1}function vl(i,e){let t=i.parentNode;return t&&/^li$/i.test(t.nodeName)&&e.left<i.getBoundingClientRect().left?t:i}function Nl(i,e,t){let{node:n,offset:r}=fs(e,t),s=-1;if(n.nodeType==1&&!n.firstChild){let o=n.getBoundingClientRect();s=o.left!=o.right&&t.left>(o.left+o.right)/2?1:-1}return i.docView.posFromDOM(n,r,s)}function Dl(i,e,t,n){let r=-1;for(let s=e,o=!1;s!=i.dom;){let l=i.docView.nearestDesc(s,!0);if(!l)return null;if(l.dom.nodeType==1&&(l.node.isBlock&&l.parent||!l.contentDOM)){let a=l.dom.getBoundingClientRect();if(l.node.isBlock&&l.parent&&(!o&&a.left>n.left||a.top>n.top?r=l.posBefore:(!o&&a.right<n.left||a.bottom<n.top)&&(r=l.posAfter),o=!0),!l.contentDOM&&r<0&&!l.node.isText)return(l.node.isBlock?n.top<(a.top+a.bottom)/2:n.left<(a.left+a.right)/2)?l.posBefore:l.posAfter}s=l.dom.parentNode}return r>-1?r:i.docView.posFromDOM(e,t,-1)}function hs(i,e,t){let n=i.childNodes.length;if(n&&t.top<t.bottom)for(let r=Math.max(0,Math.min(n-1,Math.floor(n*(e.top-t.top)/(t.bottom-t.top))-2)),s=r;;){let o=i.childNodes[s];if(o.nodeType==1){let l=o.getClientRects();for(let a=0;a<l.length;a++){let u=l[a];if(ci(e,u))return hs(o,e,u)}}if((s=(s+1)%n)==r)break}return i}function El(i,e){let t=i.dom.ownerDocument,n,r=0,s=yl(t,e.left,e.top);s&&({node:n,offset:r}=s);let o=(i.root.elementFromPoint?i.root:t).elementFromPoint(e.left,e.top),l;if(!o||!i.dom.contains(o.nodeType!=1?o.parentNode:o)){let u=i.dom.getBoundingClientRect();if(!ci(e,u)||(o=hs(i.dom,e,u),!o))return null}if(V)for(let u=o;n&&u;u=xt(u))u.draggable&&(n=void 0);if(o=vl(o,e),n){if(te&&n.nodeType==1&&(r=Math.min(r,n.childNodes.length),r<n.childNodes.length)){let c=n.childNodes[r],d;c.nodeName=="IMG"&&(d=c.getBoundingClientRect()).right<=e.left&&d.bottom>e.top&&r++}let u;Dt&&r&&n.nodeType==1&&(u=n.childNodes[r-1]).nodeType==1&&u.contentEditable=="false"&&u.getBoundingClientRect().top>=e.top&&r--,n==i.dom&&r==n.childNodes.length-1&&n.lastChild.nodeType==1&&e.top>n.lastChild.getBoundingClientRect().bottom?l=i.state.doc.content.size:(r==0||n.nodeType!=1||n.childNodes[r-1].nodeName!="BR")&&(l=Dl(i,n,r,e))}l==null&&(l=Nl(i,o,e));let a=i.docView.nearestDesc(o,!0);return{pos:l,inside:a?a.posAtStart-a.border:-1}}function Ji(i){return i.top<i.bottom||i.left<i.right}function me(i,e){let t=i.getClientRects();if(t.length){let n=t[e<0?0:t.length-1];if(Ji(n))return n}return Array.prototype.find.call(t,Ji)||i.getBoundingClientRect()}const Tl=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;function ps(i,e,t){let{node:n,offset:r,atom:s}=i.docView.domFromPos(e,t<0?-1:1),o=Dt||te;if(n.nodeType==3)if(o&&(Tl.test(n.nodeValue)||(t<0?!r:r==n.nodeValue.length))){let a=me(ue(n,r,r),t);if(te&&r&&/\s/.test(n.nodeValue[r-1])&&r<n.nodeValue.length){let u=me(ue(n,r-1,r-1),-1);if(u.top==a.top){let c=me(ue(n,r,r+1),-1);if(c.top!=a.top)return ot(c,c.left<u.left)}}return a}else{let a=r,u=r,c=t<0?1:-1;return t<0&&!r?(u++,c=-1):t>=0&&r==n.nodeValue.length?(a--,c=1):t<0?a--:u++,ot(me(ue(n,a,u),c),c<0)}if(!i.state.doc.resolve(e-(s||0)).parent.inlineContent){if(s==null&&r&&(t<0||r==Y(n))){let a=n.childNodes[r-1];if(a.nodeType==1)return Sn(a.getBoundingClientRect(),!1)}if(s==null&&r<Y(n)){let a=n.childNodes[r];if(a.nodeType==1)return Sn(a.getBoundingClientRect(),!0)}return Sn(n.getBoundingClientRect(),t>=0)}if(s==null&&r&&(t<0||r==Y(n))){let a=n.childNodes[r-1],u=a.nodeType==3?ue(a,Y(a)-(o?0:1)):a.nodeType==1&&(a.nodeName!="BR"||!a.nextSibling)?a:null;if(u)return ot(me(u,1),!1)}if(s==null&&r<Y(n)){let a=n.childNodes[r];for(;a.pmViewDesc&&a.pmViewDesc.ignoreForCoords;)a=a.nextSibling;let u=a?a.nodeType==3?ue(a,0,o?0:1):a.nodeType==1?a:null:null;if(u)return ot(me(u,-1),!0)}return ot(me(n.nodeType==3?ue(n):n,-t),t>=0)}function ot(i,e){if(i.width==0)return i;let t=e?i.left:i.right;return{top:i.top,bottom:i.bottom,left:t,right:t}}function Sn(i,e){if(i.height==0)return i;let t=e?i.top:i.bottom;return{top:t,bottom:t,left:i.left,right:i.right}}function ms(i,e,t){let n=i.state,r=i.root.activeElement;n!=e&&i.updateState(e),r!=i.dom&&i.focus();try{return t()}finally{n!=e&&i.updateState(n),r!=i.dom&&r&&r.focus()}}function Al(i,e,t){let n=e.selection,r=t=="up"?n.$from:n.$to;return ms(i,e,()=>{let{node:s}=i.docView.domFromPos(r.pos,t=="up"?-1:1);for(;;){let l=i.docView.nearestDesc(s,!0);if(!l)break;if(l.node.isBlock){s=l.contentDOM||l.dom;break}s=l.dom.parentNode}let o=ps(i,r.pos,1);for(let l=s.firstChild;l;l=l.nextSibling){let a;if(l.nodeType==1)a=l.getClientRects();else if(l.nodeType==3)a=ue(l,0,l.nodeValue.length).getClientRects();else continue;for(let u=0;u<a.length;u++){let c=a[u];if(c.bottom>c.top+1&&(t=="up"?o.top-c.top>(c.bottom-o.top)*2:c.bottom-o.bottom>(o.bottom-c.top)*2))return!1}}return!0})}const Il=/[\u0590-\u08ac]/;function ql(i,e,t){let{$head:n}=e.selection;if(!n.parent.isTextblock)return!1;let r=n.parentOffset,s=!r,o=r==n.parent.content.size,l=i.domSelection();return l?!Il.test(n.parent.textContent)||!l.modify?t=="left"||t=="backward"?s:o:ms(i,e,()=>{let{focusNode:a,focusOffset:u,anchorNode:c,anchorOffset:d}=i.domSelectionRange(),f=l.caretBidiLevel;l.modify("move",t,"character");let p=n.depth?i.docView.domAfterPos(n.before()):i.dom,{focusNode:h,focusOffset:m}=i.domSelectionRange(),g=h&&!p.contains(h.nodeType==1?h:h.parentNode)||a==h&&u==m;try{l.collapse(c,d),a&&(a!=c||u!=d)&&l.extend&&l.extend(a,u)}catch{}return f!=null&&(l.caretBidiLevel=f),g}):n.pos==n.start()||n.pos==n.end()}let Hi=null,$i=null,Ki=!1;function Rl(i,e,t){return Hi==e&&$i==t?Ki:(Hi=e,$i=t,Ki=t=="up"||t=="down"?Al(i,e,t):ql(i,e,t))}const X=0,Ui=1,Ae=2,oe=3;class Et{constructor(e,t,n,r){this.parent=e,this.children=t,this.dom=n,this.contentDOM=r,this.dirty=X,n.pmViewDesc=this}matchesWidget(e){return!1}matchesMark(e){return!1}matchesNode(e,t,n){return!1}matchesHack(e){return!1}parseRule(){return null}stopEvent(e){return!1}get size(){let e=0;for(let t=0;t<this.children.length;t++)e+=this.children[t].size;return e}get border(){return 0}destroy(){this.parent=void 0,this.dom.pmViewDesc==this&&(this.dom.pmViewDesc=void 0);for(let e=0;e<this.children.length;e++)this.children[e].destroy()}posBeforeChild(e){for(let t=0,n=this.posAtStart;;t++){let r=this.children[t];if(r==e)return n;n+=r.size}}get posBefore(){return this.parent.posBeforeChild(this)}get posAtStart(){return this.parent?this.parent.posBeforeChild(this)+this.border:0}get posAfter(){return this.posBefore+this.size}get posAtEnd(){return this.posAtStart+this.size-2*this.border}localPosFromDOM(e,t,n){if(this.contentDOM&&this.contentDOM.contains(e.nodeType==1?e:e.parentNode))if(n<0){let s,o;if(e==this.contentDOM)s=e.childNodes[t-1];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;s=e.previousSibling}for(;s&&!((o=s.pmViewDesc)&&o.parent==this);)s=s.previousSibling;return s?this.posBeforeChild(o)+o.size:this.posAtStart}else{let s,o;if(e==this.contentDOM)s=e.childNodes[t];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;s=e.nextSibling}for(;s&&!((o=s.pmViewDesc)&&o.parent==this);)s=s.nextSibling;return s?this.posBeforeChild(o):this.posAtEnd}let r;if(e==this.dom&&this.contentDOM)r=t>I(this.contentDOM);else if(this.contentDOM&&this.contentDOM!=this.dom&&this.dom.contains(this.contentDOM))r=e.compareDocumentPosition(this.contentDOM)&2;else if(this.dom.firstChild){if(t==0)for(let s=e;;s=s.parentNode){if(s==this.dom){r=!1;break}if(s.previousSibling)break}if(r==null&&t==e.childNodes.length)for(let s=e;;s=s.parentNode){if(s==this.dom){r=!0;break}if(s.nextSibling)break}}return r??n>0?this.posAtEnd:this.posAtStart}nearestDesc(e,t=!1){for(let n=!0,r=e;r;r=r.parentNode){let s=this.getDesc(r),o;if(s&&(!t||s.node))if(n&&(o=s.nodeDOM)&&!(o.nodeType==1?o.contains(e.nodeType==1?e:e.parentNode):o==e))n=!1;else return s}}getDesc(e){let t=e.pmViewDesc;for(let n=t;n;n=n.parent)if(n==this)return t}posFromDOM(e,t,n){for(let r=e;r;r=r.parentNode){let s=this.getDesc(r);if(s)return s.localPosFromDOM(e,t,n)}return-1}descAt(e){for(let t=0,n=0;t<this.children.length;t++){let r=this.children[t],s=n+r.size;if(n==e&&s!=n){for(;!r.border&&r.children.length;)r=r.children[0];return r}if(e<s)return r.descAt(e-n-r.border);n=s}}domFromPos(e,t){if(!this.contentDOM)return{node:this.dom,offset:0,atom:e+1};let n=0,r=0;for(let s=0;n<this.children.length;n++){let o=this.children[n],l=s+o.size;if(l>e||o instanceof ys){r=e-s;break}s=l}if(r)return this.children[n].domFromPos(r-this.children[n].border,t);for(let s;n&&!(s=this.children[n-1]).size&&s instanceof gs&&s.side>=0;n--);if(t<=0){let s,o=!0;for(;s=n?this.children[n-1]:null,!(!s||s.dom.parentNode==this.contentDOM);n--,o=!1);return s&&t&&o&&!s.border&&!s.domAtom?s.domFromPos(s.size,t):{node:this.contentDOM,offset:s?I(s.dom)+1:0}}else{let s,o=!0;for(;s=n<this.children.length?this.children[n]:null,!(!s||s.dom.parentNode==this.contentDOM);n++,o=!1);return s&&o&&!s.border&&!s.domAtom?s.domFromPos(0,t):{node:this.contentDOM,offset:s?I(s.dom):this.contentDOM.childNodes.length}}}parseRange(e,t,n=0){if(this.children.length==0)return{node:this.contentDOM,from:e,to:t,fromOffset:0,toOffset:this.contentDOM.childNodes.length};let r=-1,s=-1;for(let o=n,l=0;;l++){let a=this.children[l],u=o+a.size;if(r==-1&&e<=u){let c=o+a.border;if(e>=c&&t<=u-a.border&&a.node&&a.contentDOM&&this.contentDOM.contains(a.contentDOM))return a.parseRange(e,t,c);e=o;for(let d=l;d>0;d--){let f=this.children[d-1];if(f.size&&f.dom.parentNode==this.contentDOM&&!f.emptyChildAt(1)){r=I(f.dom)+1;break}e-=f.size}r==-1&&(r=0)}if(r>-1&&(u>t||l==this.children.length-1)){t=u;for(let c=l+1;c<this.children.length;c++){let d=this.children[c];if(d.size&&d.dom.parentNode==this.contentDOM&&!d.emptyChildAt(-1)){s=I(d.dom);break}t+=d.size}s==-1&&(s=this.contentDOM.childNodes.length);break}o=u}return{node:this.contentDOM,from:e,to:t,fromOffset:r,toOffset:s}}emptyChildAt(e){if(this.border||!this.contentDOM||!this.children.length)return!1;let t=this.children[e<0?0:this.children.length-1];return t.size==0||t.emptyChildAt(e)}domAfterPos(e){let{node:t,offset:n}=this.domFromPos(e,0);if(t.nodeType!=1||n==t.childNodes.length)throw new RangeError("No node after pos "+e);return t.childNodes[n]}setSelection(e,t,n,r=!1){let s=Math.min(e,t),o=Math.max(e,t);for(let f=0,p=0;f<this.children.length;f++){let h=this.children[f],m=p+h.size;if(s>p&&o<m)return h.setSelection(e-p-h.border,t-p-h.border,n,r);p=m}let l=this.domFromPos(e,e?-1:1),a=t==e?l:this.domFromPos(t,t?-1:1),u=n.getSelection(),c=!1;if((te||V)&&e==t){let{node:f,offset:p}=l;if(f.nodeType==3){if(c=!!(p&&f.nodeValue[p-1]==`
`),c&&p==f.nodeValue.length)for(let h=f,m;h;h=h.parentNode){if(m=h.nextSibling){m.nodeName=="BR"&&(l=a={node:m.parentNode,offset:I(m)+1});break}let g=h.pmViewDesc;if(g&&g.node&&g.node.isBlock)break}}else{let h=f.childNodes[p-1];c=h&&(h.nodeName=="BR"||h.contentEditable=="false")}}if(te&&u.focusNode&&u.focusNode!=a.node&&u.focusNode.nodeType==1){let f=u.focusNode.childNodes[u.focusOffset];f&&f.contentEditable=="false"&&(r=!0)}if(!(r||c&&V)&&We(l.node,l.offset,u.anchorNode,u.anchorOffset)&&We(a.node,a.offset,u.focusNode,u.focusOffset))return;let d=!1;if((u.extend||e==t)&&!c){u.collapse(l.node,l.offset);try{e!=t&&u.extend(a.node,a.offset),d=!0}catch{}}if(!d){if(e>t){let p=l;l=a,a=p}let f=document.createRange();f.setEnd(a.node,a.offset),f.setStart(l.node,l.offset),u.removeAllRanges(),u.addRange(f)}}ignoreMutation(e){return!this.contentDOM&&e.type!="selection"}get contentLost(){return this.contentDOM&&this.contentDOM!=this.dom&&!this.dom.contains(this.contentDOM)}markDirty(e,t){for(let n=0,r=0;r<this.children.length;r++){let s=this.children[r],o=n+s.size;if(n==o?e<=o&&t>=n:e<o&&t>n){let l=n+s.border,a=o-s.border;if(e>=l&&t<=a){this.dirty=e==n||t==o?Ae:Ui,e==l&&t==a&&(s.contentLost||s.dom.parentNode!=this.contentDOM)?s.dirty=oe:s.markDirty(e-l,t-l);return}else s.dirty=s.dom==s.contentDOM&&s.dom.parentNode==this.contentDOM&&!s.children.length?Ae:oe}n=o}this.dirty=Ae}markParentsDirty(){let e=1;for(let t=this.parent;t;t=t.parent,e++){let n=e==1?Ae:Ui;t.dirty<n&&(t.dirty=n)}}get domAtom(){return!1}get ignoreForCoords(){return!1}isText(e){return!1}}class gs extends Et{constructor(e,t,n,r){let s,o=t.type.toDOM;if(typeof o=="function"&&(o=o(n,()=>{if(!s)return r;if(s.parent)return s.parent.posBeforeChild(s)})),!t.type.spec.raw){if(o.nodeType!=1){let l=document.createElement("span");l.appendChild(o),o=l}o.contentEditable="false",o.classList.add("ProseMirror-widget")}super(e,[],o,null),this.widget=t,this.widget=t,s=this}matchesWidget(e){return this.dirty==X&&e.type.eq(this.widget.type)}parseRule(){return{ignore:!0}}stopEvent(e){let t=this.widget.spec.stopEvent;return t?t(e):!1}ignoreMutation(e){return e.type!="selection"||this.widget.spec.ignoreSelection}destroy(){this.widget.type.destroy(this.dom),super.destroy()}get domAtom(){return!0}get side(){return this.widget.type.side}}class Pl extends Et{constructor(e,t,n,r){super(e,[],t,null),this.textDOM=n,this.text=r}get size(){return this.text.length}localPosFromDOM(e,t){return e!=this.textDOM?this.posAtStart+(t?this.size:0):this.posAtStart+t}domFromPos(e){return{node:this.textDOM,offset:e}}ignoreMutation(e){return e.type==="characterData"&&e.target.nodeValue==e.oldValue}}class _e extends Et{constructor(e,t,n,r){super(e,[],n,r),this.mark=t}static create(e,t,n,r){let s=r.nodeViews[t.type.name],o=s&&s(t,r,n);return(!o||!o.dom)&&(o=rt.renderSpec(document,t.type.spec.toDOM(t,n),null,t.attrs)),new _e(e,t,o.dom,o.contentDOM||o.dom)}parseRule(){return this.dirty&oe||this.mark.type.spec.reparseInView?null:{mark:this.mark.type.name,attrs:this.mark.attrs,contentElement:this.contentDOM}}matchesMark(e){return this.dirty!=oe&&this.mark.eq(e)}markDirty(e,t){if(super.markDirty(e,t),this.dirty!=X){let n=this.parent;for(;!n.node;)n=n.parent;n.dirty<this.dirty&&(n.dirty=this.dirty),this.dirty=X}}slice(e,t,n){let r=_e.create(this.parent,this.mark,!0,n),s=this.children,o=this.size;t<o&&(s=Jn(s,t,o,n)),e>0&&(s=Jn(s,0,e,n));for(let l=0;l<s.length;l++)s[l].parent=r;return r.children=s,r}}class Me extends Et{constructor(e,t,n,r,s,o,l,a,u){super(e,[],s,o),this.node=t,this.outerDeco=n,this.innerDeco=r,this.nodeDOM=l}static create(e,t,n,r,s,o){let l=s.nodeViews[t.type.name],a,u=l&&l(t,s,()=>{if(!a)return o;if(a.parent)return a.parent.posBeforeChild(a)},n,r),c=u&&u.dom,d=u&&u.contentDOM;if(t.isText){if(!c)c=document.createTextNode(t.text);else if(c.nodeType!=3)throw new RangeError("Text must be rendered as a DOM text node")}else c||({dom:c,contentDOM:d}=rt.renderSpec(document,t.type.spec.toDOM(t),null,t.attrs));!d&&!t.isText&&c.nodeName!="BR"&&(c.hasAttribute("contenteditable")||(c.contentEditable="false"),t.type.spec.draggable&&(c.draggable=!0));let f=c;return c=ks(c,n,t),u?a=new zl(e,t,n,r,c,d||null,f,u,s,o+1):t.isText?new un(e,t,n,r,c,f,s):new Me(e,t,n,r,c,d||null,f,s,o+1)}parseRule(){if(this.node.type.spec.reparseInView)return null;let e={node:this.node.type.name,attrs:this.node.attrs};if(this.node.type.whitespace=="pre"&&(e.preserveWhitespace="full"),!this.contentDOM)e.getContent=()=>this.node.content;else if(!this.contentLost)e.contentElement=this.contentDOM;else{for(let t=this.children.length-1;t>=0;t--){let n=this.children[t];if(this.dom.contains(n.dom.parentNode)){e.contentElement=n.dom.parentNode;break}}e.contentElement||(e.getContent=()=>y.empty)}return e}matchesNode(e,t,n){return this.dirty==X&&e.eq(this.node)&&_n(t,this.outerDeco)&&n.eq(this.innerDeco)}get size(){return this.node.nodeSize}get border(){return this.node.isLeaf?0:1}updateChildren(e,t){let n=this.node.inlineContent,r=t,s=e.composing?this.localCompositionInfo(e,t):null,o=s&&s.pos>-1?s:null,l=s&&s.pos<0,a=new Vl(this,o&&o.node,e);Wl(this.node,this.innerDeco,(u,c,d)=>{u.spec.marks?a.syncToMarks(u.spec.marks,n,e):u.type.side>=0&&!d&&a.syncToMarks(c==this.node.childCount?M.none:this.node.child(c).marks,n,e),a.placeWidget(u,e,r)},(u,c,d,f)=>{a.syncToMarks(u.marks,n,e);let p;a.findNodeMatch(u,c,d,f)||l&&e.state.selection.from>r&&e.state.selection.to<r+u.nodeSize&&(p=a.findIndexWithChild(s.node))>-1&&a.updateNodeAt(u,c,d,p,e)||a.updateNextNode(u,c,d,e,f,r)||a.addNode(u,c,d,e,r),r+=u.nodeSize}),a.syncToMarks([],n,e),this.node.isTextblock&&a.addTextblockHacks(),a.destroyRest(),(a.changed||this.dirty==Ae)&&(o&&this.protectLocalComposition(e,o),bs(this.contentDOM,this.children,e),nt&&_l(this.dom))}localCompositionInfo(e,t){let{from:n,to:r}=e.state.selection;if(!(e.state.selection instanceof C)||n<t||r>t+this.node.content.size)return null;let s=e.input.compositionNode;if(!s||!this.dom.contains(s.parentNode))return null;if(this.node.inlineContent){let o=s.nodeValue,l=Jl(this.node.content,o,n-t,r-t);return l<0?null:{node:s,pos:l,text:o}}else return{node:s,pos:-1,text:""}}protectLocalComposition(e,{node:t,pos:n,text:r}){if(this.getDesc(t))return;let s=t;for(;s.parentNode!=this.contentDOM;s=s.parentNode){for(;s.previousSibling;)s.parentNode.removeChild(s.previousSibling);for(;s.nextSibling;)s.parentNode.removeChild(s.nextSibling);s.pmViewDesc&&(s.pmViewDesc=void 0)}let o=new Pl(this,s,t,r);e.input.compositionNodes.push(o),this.children=Jn(this.children,n,n+r.length,e,o)}update(e,t,n,r){return this.dirty==oe||!e.sameMarkup(this.node)?!1:(this.updateInner(e,t,n,r),!0)}updateInner(e,t,n,r){this.updateOuterDeco(t),this.node=e,this.innerDeco=n,this.contentDOM&&this.updateChildren(r,this.posAtStart),this.dirty=X}updateOuterDeco(e){if(_n(e,this.outerDeco))return;let t=this.nodeDOM.nodeType!=1,n=this.dom;this.dom=xs(this.dom,this.nodeDOM,Wn(this.outerDeco,this.node,t),Wn(e,this.node,t)),this.dom!=n&&(n.pmViewDesc=void 0,this.dom.pmViewDesc=this),this.outerDeco=e}selectNode(){this.nodeDOM.nodeType==1&&this.nodeDOM.classList.add("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&(this.dom.draggable=!0)}deselectNode(){this.nodeDOM.nodeType==1&&(this.nodeDOM.classList.remove("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&this.dom.removeAttribute("draggable"))}get domAtom(){return this.node.isAtom}}function ji(i,e,t,n,r){ks(n,e,i);let s=new Me(void 0,i,e,t,n,n,n,r,0);return s.contentDOM&&s.updateChildren(r,0),s}class un extends Me{constructor(e,t,n,r,s,o,l){super(e,t,n,r,s,null,o,l,0)}parseRule(){let e=this.nodeDOM.parentNode;for(;e&&e!=this.dom&&!e.pmIsDeco;)e=e.parentNode;return{skip:e||!0}}update(e,t,n,r){return this.dirty==oe||this.dirty!=X&&!this.inParent()||!e.sameMarkup(this.node)?!1:(this.updateOuterDeco(t),(this.dirty!=X||e.text!=this.node.text)&&e.text!=this.nodeDOM.nodeValue&&(this.nodeDOM.nodeValue=e.text,r.trackWrites==this.nodeDOM&&(r.trackWrites=null)),this.node=e,this.dirty=X,!0)}inParent(){let e=this.parent.contentDOM;for(let t=this.nodeDOM;t;t=t.parentNode)if(t==e)return!0;return!1}domFromPos(e){return{node:this.nodeDOM,offset:e}}localPosFromDOM(e,t,n){return e==this.nodeDOM?this.posAtStart+Math.min(t,this.node.text.length):super.localPosFromDOM(e,t,n)}ignoreMutation(e){return e.type!="characterData"&&e.type!="selection"}slice(e,t,n){let r=this.node.cut(e,t),s=document.createTextNode(r.text);return new un(this.parent,r,this.outerDeco,this.innerDeco,s,s,n)}markDirty(e,t){super.markDirty(e,t),this.dom!=this.nodeDOM&&(e==0||t==this.nodeDOM.nodeValue.length)&&(this.dirty=oe)}get domAtom(){return!1}isText(e){return this.node.text==e}}class ys extends Et{parseRule(){return{ignore:!0}}matchesHack(e){return this.dirty==X&&this.dom.nodeName==e}get domAtom(){return!0}get ignoreForCoords(){return this.dom.nodeName=="IMG"}}class zl extends Me{constructor(e,t,n,r,s,o,l,a,u,c){super(e,t,n,r,s,o,l,u,c),this.spec=a}update(e,t,n,r){if(this.dirty==oe)return!1;if(this.spec.update){let s=this.spec.update(e,t,n);return s&&this.updateInner(e,t,n,r),s}else return!this.contentDOM&&!e.isLeaf?!1:super.update(e,t,n,r)}selectNode(){this.spec.selectNode?this.spec.selectNode():super.selectNode()}deselectNode(){this.spec.deselectNode?this.spec.deselectNode():super.deselectNode()}setSelection(e,t,n,r){this.spec.setSelection?this.spec.setSelection(e,t,n):super.setSelection(e,t,n,r)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}stopEvent(e){return this.spec.stopEvent?this.spec.stopEvent(e):!1}ignoreMutation(e){return this.spec.ignoreMutation?this.spec.ignoreMutation(e):super.ignoreMutation(e)}}function bs(i,e,t){let n=i.firstChild,r=!1;for(let s=0;s<e.length;s++){let o=e[s],l=o.dom;if(l.parentNode==i){for(;l!=n;)n=Gi(n),r=!0;n=n.nextSibling}else r=!0,i.insertBefore(l,n);if(o instanceof _e){let a=n?n.previousSibling:i.lastChild;bs(o.contentDOM,o.children,t),n=a?a.nextSibling:i.firstChild}}for(;n;)n=Gi(n),r=!0;r&&t.trackWrites==i&&(t.trackWrites=null)}const ft=function(i){i&&(this.nodeName=i)};ft.prototype=Object.create(null);const Ie=[new ft];function Wn(i,e,t){if(i.length==0)return Ie;let n=t?Ie[0]:new ft,r=[n];for(let s=0;s<i.length;s++){let o=i[s].type.attrs;if(o){o.nodeName&&r.push(n=new ft(o.nodeName));for(let l in o){let a=o[l];a!=null&&(t&&r.length==1&&r.push(n=new ft(e.isInline?"span":"div")),l=="class"?n.class=(n.class?n.class+" ":"")+a:l=="style"?n.style=(n.style?n.style+";":"")+a:l!="nodeName"&&(n[l]=a))}}}return r}function xs(i,e,t,n){if(t==Ie&&n==Ie)return e;let r=e;for(let s=0;s<n.length;s++){let o=n[s],l=t[s];if(s){let a;l&&l.nodeName==o.nodeName&&r!=i&&(a=r.parentNode)&&a.nodeName.toLowerCase()==o.nodeName||(a=document.createElement(o.nodeName),a.pmIsDeco=!0,a.appendChild(r),l=Ie[0]),r=a}Bl(r,l||Ie[0],o)}return r}function Bl(i,e,t){for(let n in e)n!="class"&&n!="style"&&n!="nodeName"&&!(n in t)&&i.removeAttribute(n);for(let n in t)n!="class"&&n!="style"&&n!="nodeName"&&t[n]!=e[n]&&i.setAttribute(n,t[n]);if(e.class!=t.class){let n=e.class?e.class.split(" ").filter(Boolean):[],r=t.class?t.class.split(" ").filter(Boolean):[];for(let s=0;s<n.length;s++)r.indexOf(n[s])==-1&&i.classList.remove(n[s]);for(let s=0;s<r.length;s++)n.indexOf(r[s])==-1&&i.classList.add(r[s]);i.classList.length==0&&i.removeAttribute("class")}if(e.style!=t.style){if(e.style){let n=/\s*([\w\-\xa1-\uffff]+)\s*:(?:"(?:\\.|[^"])*"|'(?:\\.|[^'])*'|\(.*?\)|[^;])*/g,r;for(;r=n.exec(e.style);)i.style.removeProperty(r[1])}t.style&&(i.style.cssText+=t.style)}}function ks(i,e,t){return xs(i,i,Ie,Wn(e,t,i.nodeType!=1))}function _n(i,e){if(i.length!=e.length)return!1;for(let t=0;t<i.length;t++)if(!i[t].type.eq(e[t].type))return!1;return!0}function Gi(i){let e=i.nextSibling;return i.parentNode.removeChild(i),e}class Vl{constructor(e,t,n){this.lock=t,this.view=n,this.index=0,this.stack=[],this.changed=!1,this.top=e,this.preMatch=Fl(e.node.content,e)}destroyBetween(e,t){if(e!=t){for(let n=e;n<t;n++)this.top.children[n].destroy();this.top.children.splice(e,t-e),this.changed=!0}}destroyRest(){this.destroyBetween(this.index,this.top.children.length)}syncToMarks(e,t,n){let r=0,s=this.stack.length>>1,o=Math.min(s,e.length);for(;r<o&&(r==s-1?this.top:this.stack[r+1<<1]).matchesMark(e[r])&&e[r].type.spec.spanning!==!1;)r++;for(;r<s;)this.destroyRest(),this.top.dirty=X,this.index=this.stack.pop(),this.top=this.stack.pop(),s--;for(;s<e.length;){this.stack.push(this.top,this.index+1);let l=-1;for(let a=this.index;a<Math.min(this.index+3,this.top.children.length);a++){let u=this.top.children[a];if(u.matchesMark(e[s])&&!this.isLocked(u.dom)){l=a;break}}if(l>-1)l>this.index&&(this.changed=!0,this.destroyBetween(this.index,l)),this.top=this.top.children[this.index];else{let a=_e.create(this.top,e[s],t,n);this.top.children.splice(this.index,0,a),this.top=a,this.changed=!0}this.index=0,s++}}findNodeMatch(e,t,n,r){let s=-1,o;if(r>=this.preMatch.index&&(o=this.preMatch.matches[r-this.preMatch.index]).parent==this.top&&o.matchesNode(e,t,n))s=this.top.children.indexOf(o,this.index);else for(let l=this.index,a=Math.min(this.top.children.length,l+5);l<a;l++){let u=this.top.children[l];if(u.matchesNode(e,t,n)&&!this.preMatch.matched.has(u)){s=l;break}}return s<0?!1:(this.destroyBetween(this.index,s),this.index++,!0)}updateNodeAt(e,t,n,r,s){let o=this.top.children[r];return o.dirty==oe&&o.dom==o.contentDOM&&(o.dirty=Ae),o.update(e,t,n,s)?(this.destroyBetween(this.index,r),this.index++,!0):!1}findIndexWithChild(e){for(;;){let t=e.parentNode;if(!t)return-1;if(t==this.top.contentDOM){let n=e.pmViewDesc;if(n){for(let r=this.index;r<this.top.children.length;r++)if(this.top.children[r]==n)return r}return-1}e=t}}updateNextNode(e,t,n,r,s,o){for(let l=this.index;l<this.top.children.length;l++){let a=this.top.children[l];if(a instanceof Me){let u=this.preMatch.matched.get(a);if(u!=null&&u!=s)return!1;let c=a.dom,d,f=this.isLocked(c)&&!(e.isText&&a.node&&a.node.isText&&a.nodeDOM.nodeValue==e.text&&a.dirty!=oe&&_n(t,a.outerDeco));if(!f&&a.update(e,t,n,r))return this.destroyBetween(this.index,l),a.dom!=c&&(this.changed=!0),this.index++,!0;if(!f&&(d=this.recreateWrapper(a,e,t,n,r,o)))return this.top.children[this.index]=d,d.contentDOM&&(d.dirty=Ae,d.updateChildren(r,o+1),d.dirty=X),this.changed=!0,this.index++,!0;break}}return!1}recreateWrapper(e,t,n,r,s,o){if(e.dirty||t.isAtom||!e.children.length||!e.node.content.eq(t.content))return null;let l=Me.create(this.top,t,n,r,s,o);if(l.contentDOM){l.children=e.children,e.children=[];for(let a of l.children)a.parent=l}return e.destroy(),l}addNode(e,t,n,r,s){let o=Me.create(this.top,e,t,n,r,s);o.contentDOM&&o.updateChildren(r,s+1),this.top.children.splice(this.index++,0,o),this.changed=!0}placeWidget(e,t,n){let r=this.index<this.top.children.length?this.top.children[this.index]:null;if(r&&r.matchesWidget(e)&&(e==r.widget||!r.widget.type.toDOM.parentNode))this.index++;else{let s=new gs(this.top,e,t,n);this.top.children.splice(this.index++,0,s),this.changed=!0}}addTextblockHacks(){let e=this.top.children[this.index-1],t=this.top;for(;e instanceof _e;)t=e,e=t.children[t.children.length-1];(!e||!(e instanceof un)||/\n$/.test(e.node.text)||this.view.requiresGeckoHackNode&&/\s$/.test(e.node.text))&&((V||B)&&e&&e.dom.contentEditable=="false"&&this.addHackNode("IMG",t),this.addHackNode("BR",this.top))}addHackNode(e,t){if(t==this.top&&this.index<t.children.length&&t.children[this.index].matchesHack(e))this.index++;else{let n=document.createElement(e);e=="IMG"&&(n.className="ProseMirror-separator",n.alt=""),e=="BR"&&(n.className="ProseMirror-trailingBreak");let r=new ys(this.top,[],n,null);t!=this.top?t.children.push(r):t.children.splice(this.index++,0,r),this.changed=!0}}isLocked(e){return this.lock&&(e==this.lock||e.nodeType==1&&e.contains(this.lock.parentNode))}}function Fl(i,e){let t=e,n=t.children.length,r=i.childCount,s=new Map,o=[];e:for(;r>0;){let l;for(;;)if(n){let u=t.children[n-1];if(u instanceof _e)t=u,n=u.children.length;else{l=u,n--;break}}else{if(t==e)break e;n=t.parent.children.indexOf(t),t=t.parent}let a=l.node;if(a){if(a!=i.child(r-1))break;--r,s.set(l,r),o.push(l)}}return{index:r,matched:s,matches:o.reverse()}}function Ll(i,e){return i.type.side-e.type.side}function Wl(i,e,t,n){let r=e.locals(i),s=0;if(r.length==0){for(let u=0;u<i.childCount;u++){let c=i.child(u);n(c,r,e.forChild(s,c),u),s+=c.nodeSize}return}let o=0,l=[],a=null;for(let u=0;;){let c,d;for(;o<r.length&&r[o].to==s;){let g=r[o++];g.widget&&(c?(d||(d=[c])).push(g):c=g)}if(c)if(d){d.sort(Ll);for(let g=0;g<d.length;g++)t(d[g],u,!!a)}else t(c,u,!!a);let f,p;if(a)p=-1,f=a,a=null;else if(u<i.childCount)p=u,f=i.child(u++);else break;for(let g=0;g<l.length;g++)l[g].to<=s&&l.splice(g--,1);for(;o<r.length&&r[o].from<=s&&r[o].to>s;)l.push(r[o++]);let h=s+f.nodeSize;if(f.isText){let g=h;o<r.length&&r[o].from<g&&(g=r[o].from);for(let x=0;x<l.length;x++)l[x].to<g&&(g=l[x].to);g<h&&(a=f.cut(g-s),f=f.cut(0,g-s),h=g,p=-1)}else for(;o<r.length&&r[o].to<h;)o++;let m=f.isInline&&!f.isLeaf?l.filter(g=>!g.inline):l.slice();n(f,m,e.forChild(s,f),p),s=h}}function _l(i){if(i.nodeName=="UL"||i.nodeName=="OL"){let e=i.style.cssText;i.style.cssText=e+"; list-style: square !important",window.getComputedStyle(i).listStyle,i.style.cssText=e}}function Jl(i,e,t,n){for(let r=0,s=0;r<i.childCount&&s<=n;){let o=i.child(r++),l=s;if(s+=o.nodeSize,!o.isText)continue;let a=o.text;for(;r<i.childCount;){let u=i.child(r++);if(s+=u.nodeSize,!u.isText)break;a+=u.text}if(s>=t){if(s>=n&&a.slice(n-e.length-l,n-l)==e)return n-e.length;let u=l<n?a.lastIndexOf(e,n-l-1):-1;if(u>=0&&u+e.length+l>=t)return l+u;if(t==n&&a.length>=n+e.length-l&&a.slice(n-l,n-l+e.length)==e)return n}}return-1}function Jn(i,e,t,n,r){let s=[];for(let o=0,l=0;o<i.length;o++){let a=i[o],u=l,c=l+=a.size;u>=t||c<=e?s.push(a):(u<e&&s.push(a.slice(0,e-u,n)),r&&(s.push(r),r=void 0),c>t&&s.push(a.slice(t-u,a.size,n)))}return s}function di(i,e=null){let t=i.domSelectionRange(),n=i.state.doc;if(!t.focusNode)return null;let r=i.docView.nearestDesc(t.focusNode),s=r&&r.size==0,o=i.docView.posFromDOM(t.focusNode,t.focusOffset,1);if(o<0)return null;let l=n.resolve(o),a,u;if(an(t)){for(a=l;r&&!r.node;)r=r.parent;let c=r.node;if(r&&c.isAtom&&k.isSelectable(c)&&r.parent&&!(c.isInline&&ml(t.focusNode,t.focusOffset,r.dom))){let d=r.posBefore;u=new k(o==d?l:n.resolve(d))}}else{let c=i.docView.posFromDOM(t.anchorNode,t.anchorOffset,1);if(c<0)return null;a=n.resolve(c)}if(!u){let c=e=="pointer"||i.state.selection.head<l.pos&&!s?1:-1;u=fi(i,a,l,c)}return u}function Ss(i){return i.editable?i.hasFocus():Cs(i)&&document.activeElement&&document.activeElement.contains(i.dom)}function fe(i,e=!1){let t=i.state.selection;if(ws(i,t),!!Ss(i)){if(!e&&i.input.mouseDown&&i.input.mouseDown.allowDefault&&B){let n=i.domSelectionRange(),r=i.domObserver.currentSelection;if(n.anchorNode&&r.anchorNode&&We(n.anchorNode,n.anchorOffset,r.anchorNode,r.anchorOffset)){i.input.mouseDown.delayedSelectionSync=!0,i.domObserver.setCurSelection();return}}if(i.domObserver.disconnectSelection(),i.cursorWrapper)$l(i);else{let{anchor:n,head:r}=t,s,o;Qi&&!(t instanceof C)&&(t.$from.parent.inlineContent||(s=Yi(i,t.from)),!t.empty&&!t.$from.parent.inlineContent&&(o=Yi(i,t.to))),i.docView.setSelection(n,r,i.root,e),Qi&&(s&&Xi(s),o&&Xi(o)),t.visible?i.dom.classList.remove("ProseMirror-hideselection"):(i.dom.classList.add("ProseMirror-hideselection"),"onselectionchange"in document&&Hl(i))}i.domObserver.setCurSelection(),i.domObserver.connectSelection()}}const Qi=V||B&&us<63;function Yi(i,e){let{node:t,offset:n}=i.docView.domFromPos(e,0),r=n<t.childNodes.length?t.childNodes[n]:null,s=n?t.childNodes[n-1]:null;if(V&&r&&r.contentEditable=="false")return wn(r);if((!r||r.contentEditable=="false")&&(!s||s.contentEditable=="false")){if(r)return wn(r);if(s)return wn(s)}}function wn(i){return i.contentEditable="true",V&&i.draggable&&(i.draggable=!1,i.wasDraggable=!0),i}function Xi(i){i.contentEditable="false",i.wasDraggable&&(i.draggable=!0,i.wasDraggable=null)}function Hl(i){let e=i.dom.ownerDocument;e.removeEventListener("selectionchange",i.input.hideSelectionGuard);let t=i.domSelectionRange(),n=t.anchorNode,r=t.anchorOffset;e.addEventListener("selectionchange",i.input.hideSelectionGuard=()=>{(t.anchorNode!=n||t.anchorOffset!=r)&&(e.removeEventListener("selectionchange",i.input.hideSelectionGuard),setTimeout(()=>{(!Ss(i)||i.state.selection.visible)&&i.dom.classList.remove("ProseMirror-hideselection")},20))})}function $l(i){let e=i.domSelection(),t=document.createRange();if(!e)return;let n=i.cursorWrapper.dom,r=n.nodeName=="IMG";r?t.setStart(n.parentNode,I(n)+1):t.setStart(n,0),t.collapse(!0),e.removeAllRanges(),e.addRange(t),!r&&!i.state.selection.visible&&H&&Ce<=11&&(n.disabled=!0,n.disabled=!1)}function ws(i,e){if(e instanceof k){let t=i.docView.descAt(e.from);t!=i.lastSelectedViewDesc&&(Zi(i),t&&t.selectNode(),i.lastSelectedViewDesc=t)}else Zi(i)}function Zi(i){i.lastSelectedViewDesc&&(i.lastSelectedViewDesc.parent&&i.lastSelectedViewDesc.deselectNode(),i.lastSelectedViewDesc=void 0)}function fi(i,e,t,n){return i.someProp("createSelectionBetween",r=>r(i,e,t))||C.between(e,t,n)}function er(i){return i.editable&&!i.hasFocus()?!1:Cs(i)}function Cs(i){let e=i.domSelectionRange();if(!e.anchorNode)return!1;try{return i.dom.contains(e.anchorNode.nodeType==3?e.anchorNode.parentNode:e.anchorNode)&&(i.editable||i.dom.contains(e.focusNode.nodeType==3?e.focusNode.parentNode:e.focusNode))}catch{return!1}}function Kl(i){let e=i.docView.domFromPos(i.state.selection.anchor,0),t=i.domSelectionRange();return We(e.node,e.offset,t.anchorNode,t.anchorOffset)}function Hn(i,e){let{$anchor:t,$head:n}=i.selection,r=e>0?t.max(n):t.min(n),s=r.parent.inlineContent?r.depth?i.doc.resolve(e>0?r.after():r.before()):null:r;return s&&S.findFrom(s,e)}function ge(i,e){return i.dispatch(i.state.tr.setSelection(e).scrollIntoView()),!0}function tr(i,e,t){let n=i.state.selection;if(n instanceof C)if(t.indexOf("s")>-1){let{$head:r}=n,s=r.textOffset?null:e<0?r.nodeBefore:r.nodeAfter;if(!s||s.isText||!s.isLeaf)return!1;let o=i.state.doc.resolve(r.pos+s.nodeSize*(e<0?-1:1));return ge(i,new C(n.$anchor,o))}else if(n.empty){if(i.endOfTextblock(e>0?"forward":"backward")){let r=Hn(i.state,e);return r&&r instanceof k?ge(i,r):!1}else if(!(G&&t.indexOf("m")>-1)){let r=n.$head,s=r.textOffset?null:e<0?r.nodeBefore:r.nodeAfter,o;if(!s||s.isText)return!1;let l=e<0?r.pos-s.nodeSize:r.pos;return s.isAtom||(o=i.docView.descAt(l))&&!o.contentDOM?k.isSelectable(s)?ge(i,new k(e<0?i.state.doc.resolve(r.pos-s.nodeSize):r)):Dt?ge(i,new C(i.state.doc.resolve(e<0?l:l+s.nodeSize))):!1:!1}}else return!1;else{if(n instanceof k&&n.node.isInline)return ge(i,new C(e>0?n.$to:n.$from));{let r=Hn(i.state,e);return r?ge(i,r):!1}}}function Yt(i){return i.nodeType==3?i.nodeValue.length:i.childNodes.length}function ht(i,e){let t=i.pmViewDesc;return t&&t.size==0&&(e<0||i.nextSibling||i.nodeName!="BR")}function He(i,e){return e<0?Ul(i):jl(i)}function Ul(i){let e=i.domSelectionRange(),t=e.focusNode,n=e.focusOffset;if(!t)return;let r,s,o=!1;for(te&&t.nodeType==1&&n<Yt(t)&&ht(t.childNodes[n],-1)&&(o=!0);;)if(n>0){if(t.nodeType!=1)break;{let l=t.childNodes[n-1];if(ht(l,-1))r=t,s=--n;else if(l.nodeType==3)t=l,n=t.nodeValue.length;else break}}else{if(Ms(t))break;{let l=t.previousSibling;for(;l&&ht(l,-1);)r=t.parentNode,s=I(l),l=l.previousSibling;if(l)t=l,n=Yt(t);else{if(t=t.parentNode,t==i.dom)break;n=0}}}o?$n(i,t,n):r&&$n(i,r,s)}function jl(i){let e=i.domSelectionRange(),t=e.focusNode,n=e.focusOffset;if(!t)return;let r=Yt(t),s,o;for(;;)if(n<r){if(t.nodeType!=1)break;let l=t.childNodes[n];if(ht(l,1))s=t,o=++n;else break}else{if(Ms(t))break;{let l=t.nextSibling;for(;l&&ht(l,1);)s=l.parentNode,o=I(l)+1,l=l.nextSibling;if(l)t=l,n=0,r=Yt(t);else{if(t=t.parentNode,t==i.dom)break;n=r=0}}}s&&$n(i,s,o)}function Ms(i){let e=i.pmViewDesc;return e&&e.node&&e.node.isBlock}function Gl(i,e){for(;i&&e==i.childNodes.length&&!Nt(i);)e=I(i)+1,i=i.parentNode;for(;i&&e<i.childNodes.length;){let t=i.childNodes[e];if(t.nodeType==3)return t;if(t.nodeType==1&&t.contentEditable=="false")break;i=t,e=0}}function Ql(i,e){for(;i&&!e&&!Nt(i);)e=I(i),i=i.parentNode;for(;i&&e;){let t=i.childNodes[e-1];if(t.nodeType==3)return t;if(t.nodeType==1&&t.contentEditable=="false")break;i=t,e=i.childNodes.length}}function $n(i,e,t){if(e.nodeType!=3){let s,o;(o=Gl(e,t))?(e=o,t=0):(s=Ql(e,t))&&(e=s,t=s.nodeValue.length)}let n=i.domSelection();if(!n)return;if(an(n)){let s=document.createRange();s.setEnd(e,t),s.setStart(e,t),n.removeAllRanges(),n.addRange(s)}else n.extend&&n.extend(e,t);i.domObserver.setCurSelection();let{state:r}=i;setTimeout(()=>{i.state==r&&fe(i)},50)}function nr(i,e){let t=i.state.doc.resolve(e);if(!(B||bl)&&t.parent.inlineContent){let r=i.coordsAtPos(e);if(e>t.start()){let s=i.coordsAtPos(e-1),o=(s.top+s.bottom)/2;if(o>r.top&&o<r.bottom&&Math.abs(s.left-r.left)>1)return s.left<r.left?"ltr":"rtl"}if(e<t.end()){let s=i.coordsAtPos(e+1),o=(s.top+s.bottom)/2;if(o>r.top&&o<r.bottom&&Math.abs(s.left-r.left)>1)return s.left>r.left?"ltr":"rtl"}}return getComputedStyle(i.dom).direction=="rtl"?"rtl":"ltr"}function ir(i,e,t){let n=i.state.selection;if(n instanceof C&&!n.empty||t.indexOf("s")>-1||G&&t.indexOf("m")>-1)return!1;let{$from:r,$to:s}=n;if(!r.parent.inlineContent||i.endOfTextblock(e<0?"up":"down")){let o=Hn(i.state,e);if(o&&o instanceof k)return ge(i,o)}if(!r.parent.inlineContent){let o=e<0?r:s,l=n instanceof U?S.near(o,e):S.findFrom(o,e);return l?ge(i,l):!1}return!1}function rr(i,e){if(!(i.state.selection instanceof C))return!0;let{$head:t,$anchor:n,empty:r}=i.state.selection;if(!t.sameParent(n))return!0;if(!r)return!1;if(i.endOfTextblock(e>0?"forward":"backward"))return!0;let s=!t.textOffset&&(e<0?t.nodeBefore:t.nodeAfter);if(s&&!s.isText){let o=i.state.tr;return e<0?o.delete(t.pos-s.nodeSize,t.pos):o.delete(t.pos,t.pos+s.nodeSize),i.dispatch(o),!0}return!1}function sr(i,e,t){i.domObserver.stop(),e.contentEditable=t,i.domObserver.start()}function Yl(i){if(!V||i.state.selection.$head.parentOffset>0)return!1;let{focusNode:e,focusOffset:t}=i.domSelectionRange();if(e&&e.nodeType==1&&t==0&&e.firstChild&&e.firstChild.contentEditable=="false"){let n=e.firstChild;sr(i,n,"true"),setTimeout(()=>sr(i,n,"false"),20)}return!1}function Xl(i){let e="";return i.ctrlKey&&(e+="c"),i.metaKey&&(e+="m"),i.altKey&&(e+="a"),i.shiftKey&&(e+="s"),e}function Zl(i,e){let t=e.keyCode,n=Xl(e);if(t==8||G&&t==72&&n=="c")return rr(i,-1)||He(i,-1);if(t==46&&!e.shiftKey||G&&t==68&&n=="c")return rr(i,1)||He(i,1);if(t==13||t==27)return!0;if(t==37||G&&t==66&&n=="c"){let r=t==37?nr(i,i.state.selection.from)=="ltr"?-1:1:-1;return tr(i,r,n)||He(i,r)}else if(t==39||G&&t==70&&n=="c"){let r=t==39?nr(i,i.state.selection.from)=="ltr"?1:-1:1;return tr(i,r,n)||He(i,r)}else{if(t==38||G&&t==80&&n=="c")return ir(i,-1,n)||He(i,-1);if(t==40||G&&t==78&&n=="c")return Yl(i)||ir(i,1,n)||He(i,1);if(n==(G?"m":"c")&&(t==66||t==73||t==89||t==90))return!0}return!1}function Os(i,e){i.someProp("transformCopied",p=>{e=p(e,i)});let t=[],{content:n,openStart:r,openEnd:s}=e;for(;r>1&&s>1&&n.childCount==1&&n.firstChild.childCount==1;){r--,s--;let p=n.firstChild;t.push(p.type.name,p.attrs!=p.type.defaultAttrs?p.attrs:null),n=p.content}let o=i.someProp("clipboardSerializer")||rt.fromSchema(i.state.schema),l=As(),a=l.createElement("div");a.appendChild(o.serializeFragment(n,{document:l}));let u=a.firstChild,c,d=0;for(;u&&u.nodeType==1&&(c=Ts[u.nodeName.toLowerCase()]);){for(let p=c.length-1;p>=0;p--){let h=l.createElement(c[p]);for(;a.firstChild;)h.appendChild(a.firstChild);a.appendChild(h),d++}u=a.firstChild}u&&u.nodeType==1&&u.setAttribute("data-pm-slice",`${r} ${s}${d?` -${d}`:""} ${JSON.stringify(t)}`);let f=i.someProp("clipboardTextSerializer",p=>p(e,i))||e.content.textBetween(0,e.content.size,`

`);return{dom:a,text:f,slice:e}}function vs(i,e,t,n,r){let s=r.parent.type.spec.code,o,l;if(!t&&!e)return null;let a=e&&(n||s||!t);if(a){if(i.someProp("transformPastedText",f=>{e=f(e,s||n,i)}),s)return e?new b(y.from(i.state.schema.text(e.replace(/\r\n?/g,`
`))),0,0):b.empty;let d=i.someProp("clipboardTextParser",f=>f(e,r,n,i));if(d)l=d;else{let f=r.marks(),{schema:p}=i.state,h=rt.fromSchema(p);o=document.createElement("div"),e.split(/(?:\r\n?|\n)+/).forEach(m=>{let g=o.appendChild(document.createElement("p"));m&&g.appendChild(h.serializeNode(p.text(m,f)))})}}else i.someProp("transformPastedHTML",d=>{t=d(t,i)}),o=na(t),Dt&&ia(o);let u=o&&o.querySelector("[data-pm-slice]"),c=u&&/^(\d+) (\d+)(?: -(\d+))? (.*)/.exec(u.getAttribute("data-pm-slice")||"");if(c&&c[3])for(let d=+c[3];d>0;d--){let f=o.firstChild;for(;f&&f.nodeType!=1;)f=f.nextSibling;if(!f)break;o=f}if(l||(l=(i.someProp("clipboardParser")||i.someProp("domParser")||Ze.fromSchema(i.state.schema)).parseSlice(o,{preserveWhitespace:!!(a||c),context:r,ruleFromNode(f){return f.nodeName=="BR"&&!f.nextSibling&&f.parentNode&&!ea.test(f.parentNode.nodeName)?{ignore:!0}:null}})),c)l=ra(or(l,+c[1],+c[2]),c[4]);else if(l=b.maxOpen(ta(l.content,r),!0),l.openStart||l.openEnd){let d=0,f=0;for(let p=l.content.firstChild;d<l.openStart&&!p.type.spec.isolating;d++,p=p.firstChild);for(let p=l.content.lastChild;f<l.openEnd&&!p.type.spec.isolating;f++,p=p.lastChild);l=or(l,d,f)}return i.someProp("transformPasted",d=>{l=d(l,i)}),l}const ea=/^(a|abbr|acronym|b|cite|code|del|em|i|ins|kbd|label|output|q|ruby|s|samp|span|strong|sub|sup|time|u|tt|var)$/i;function ta(i,e){if(i.childCount<2)return i;for(let t=e.depth;t>=0;t--){let r=e.node(t).contentMatchAt(e.index(t)),s,o=[];if(i.forEach(l=>{if(!o)return;let a=r.findWrapping(l.type),u;if(!a)return o=null;if(u=o.length&&s.length&&Ds(a,s,l,o[o.length-1],0))o[o.length-1]=u;else{o.length&&(o[o.length-1]=Es(o[o.length-1],s.length));let c=Ns(l,a);o.push(c),r=r.matchType(c.type),s=a}}),o)return y.from(o)}return i}function Ns(i,e,t=0){for(let n=e.length-1;n>=t;n--)i=e[n].create(null,y.from(i));return i}function Ds(i,e,t,n,r){if(r<i.length&&r<e.length&&i[r]==e[r]){let s=Ds(i,e,t,n.lastChild,r+1);if(s)return n.copy(n.content.replaceChild(n.childCount-1,s));if(n.contentMatchAt(n.childCount).matchType(r==i.length-1?t.type:i[r+1]))return n.copy(n.content.append(y.from(Ns(t,i,r+1))))}}function Es(i,e){if(e==0)return i;let t=i.content.replaceChild(i.childCount-1,Es(i.lastChild,e-1)),n=i.contentMatchAt(i.childCount).fillBefore(y.empty,!0);return i.copy(t.append(n))}function Kn(i,e,t,n,r,s){let o=e<0?i.firstChild:i.lastChild,l=o.content;return i.childCount>1&&(s=0),r<n-1&&(l=Kn(l,e,t,n,r+1,s)),r>=t&&(l=e<0?o.contentMatchAt(0).fillBefore(l,s<=r).append(l):l.append(o.contentMatchAt(o.childCount).fillBefore(y.empty,!0))),i.replaceChild(e<0?0:i.childCount-1,o.copy(l))}function or(i,e,t){return e<i.openStart&&(i=new b(Kn(i.content,-1,e,i.openStart,0,i.openEnd),e,i.openEnd)),t<i.openEnd&&(i=new b(Kn(i.content,1,t,i.openEnd,0,0),i.openStart,t)),i}const Ts={thead:["table"],tbody:["table"],tfoot:["table"],caption:["table"],colgroup:["table"],col:["table","colgroup"],tr:["table","tbody"],td:["table","tbody","tr"],th:["table","tbody","tr"]};let lr=null;function As(){return lr||(lr=document.implementation.createHTMLDocument("title"))}function na(i){let e=/^(\s*<meta [^>]*>)*/.exec(i);e&&(i=i.slice(e[0].length));let t=As().createElement("div"),n=/<([a-z][^>\s]+)/i.exec(i),r;if((r=n&&Ts[n[1].toLowerCase()])&&(i=r.map(s=>"<"+s+">").join("")+i+r.map(s=>"</"+s+">").reverse().join("")),t.innerHTML=i,r)for(let s=0;s<r.length;s++)t=t.querySelector(r[s])||t;return t}function ia(i){let e=i.querySelectorAll(B?"span:not([class]):not([style])":"span.Apple-converted-space");for(let t=0;t<e.length;t++){let n=e[t];n.childNodes.length==1&&n.textContent==""&&n.parentNode&&n.parentNode.replaceChild(i.ownerDocument.createTextNode(" "),n)}}function ra(i,e){if(!i.size)return i;let t=i.content.firstChild.type.schema,n;try{n=JSON.parse(e)}catch{return i}let{content:r,openStart:s,openEnd:o}=i;for(let l=n.length-2;l>=0;l-=2){let a=t.nodes[n[l]];if(!a||a.hasRequiredAttrs())break;r=y.from(a.create(n[l+1],r)),s++,o++}return new b(r,s,o)}const F={},L={},sa={touchstart:!0,touchmove:!0};class oa{constructor(){this.shiftKey=!1,this.mouseDown=null,this.lastKeyCode=null,this.lastKeyCodeTime=0,this.lastClick={time:0,x:0,y:0,type:""},this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastIOSEnter=0,this.lastIOSEnterFallbackTimeout=-1,this.lastFocus=0,this.lastTouch=0,this.lastAndroidDelete=0,this.composing=!1,this.compositionNode=null,this.composingTimeout=-1,this.compositionNodes=[],this.compositionEndedAt=-2e8,this.compositionID=1,this.compositionPendingChanges=0,this.domChangeCount=0,this.eventHandlers=Object.create(null),this.hideSelectionGuard=null}}function la(i){for(let e in F){let t=F[e];i.dom.addEventListener(e,i.input.eventHandlers[e]=n=>{ua(i,n)&&!hi(i,n)&&(i.editable||!(n.type in L))&&t(i,n)},sa[e]?{passive:!0}:void 0)}V&&i.dom.addEventListener("input",()=>null),Un(i)}function we(i,e){i.input.lastSelectionOrigin=e,i.input.lastSelectionTime=Date.now()}function aa(i){i.domObserver.stop();for(let e in i.input.eventHandlers)i.dom.removeEventListener(e,i.input.eventHandlers[e]);clearTimeout(i.input.composingTimeout),clearTimeout(i.input.lastIOSEnterFallbackTimeout)}function Un(i){i.someProp("handleDOMEvents",e=>{for(let t in e)i.input.eventHandlers[t]||i.dom.addEventListener(t,i.input.eventHandlers[t]=n=>hi(i,n))})}function hi(i,e){return i.someProp("handleDOMEvents",t=>{let n=t[e.type];return n?n(i,e)||e.defaultPrevented:!1})}function ua(i,e){if(!e.bubbles)return!0;if(e.defaultPrevented)return!1;for(let t=e.target;t!=i.dom;t=t.parentNode)if(!t||t.nodeType==11||t.pmViewDesc&&t.pmViewDesc.stopEvent(e))return!1;return!0}function ca(i,e){!hi(i,e)&&F[e.type]&&(i.editable||!(e.type in L))&&F[e.type](i,e)}L.keydown=(i,e)=>{let t=e;if(i.input.shiftKey=t.keyCode==16||t.shiftKey,!qs(i,t)&&(i.input.lastKeyCode=t.keyCode,i.input.lastKeyCodeTime=Date.now(),!(Z&&B&&t.keyCode==13)))if(t.keyCode!=229&&i.domObserver.forceFlush(),nt&&t.keyCode==13&&!t.ctrlKey&&!t.altKey&&!t.metaKey){let n=Date.now();i.input.lastIOSEnter=n,i.input.lastIOSEnterFallbackTimeout=setTimeout(()=>{i.input.lastIOSEnter==n&&(i.someProp("handleKeyDown",r=>r(i,Te(13,"Enter"))),i.input.lastIOSEnter=0)},200)}else i.someProp("handleKeyDown",n=>n(i,t))||Zl(i,t)?t.preventDefault():we(i,"key")};L.keyup=(i,e)=>{e.keyCode==16&&(i.input.shiftKey=!1)};L.keypress=(i,e)=>{let t=e;if(qs(i,t)||!t.charCode||t.ctrlKey&&!t.altKey||G&&t.metaKey)return;if(i.someProp("handleKeyPress",r=>r(i,t))){t.preventDefault();return}let n=i.state.selection;if(!(n instanceof C)||!n.$from.sameParent(n.$to)){let r=String.fromCharCode(t.charCode);!/[\r\n]/.test(r)&&!i.someProp("handleTextInput",s=>s(i,n.$from.pos,n.$to.pos,r))&&i.dispatch(i.state.tr.insertText(r).scrollIntoView()),t.preventDefault()}};function cn(i){return{left:i.clientX,top:i.clientY}}function da(i,e){let t=e.x-i.clientX,n=e.y-i.clientY;return t*t+n*n<100}function pi(i,e,t,n,r){if(n==-1)return!1;let s=i.state.doc.resolve(n);for(let o=s.depth+1;o>0;o--)if(i.someProp(e,l=>o>s.depth?l(i,t,s.nodeAfter,s.before(o),r,!0):l(i,t,s.node(o),s.before(o),r,!1)))return!0;return!1}function Xe(i,e,t){if(i.focused||i.focus(),i.state.selection.eq(e))return;let n=i.state.tr.setSelection(e);n.setMeta("pointer",!0),i.dispatch(n)}function fa(i,e){if(e==-1)return!1;let t=i.state.doc.resolve(e),n=t.nodeAfter;return n&&n.isAtom&&k.isSelectable(n)?(Xe(i,new k(t)),!0):!1}function ha(i,e){if(e==-1)return!1;let t=i.state.selection,n,r;t instanceof k&&(n=t.node);let s=i.state.doc.resolve(e);for(let o=s.depth+1;o>0;o--){let l=o>s.depth?s.nodeAfter:s.node(o);if(k.isSelectable(l)){n&&t.$from.depth>0&&o>=t.$from.depth&&s.before(t.$from.depth+1)==t.$from.pos?r=s.before(t.$from.depth):r=s.before(o);break}}return r!=null?(Xe(i,k.create(i.state.doc,r)),!0):!1}function pa(i,e,t,n,r){return pi(i,"handleClickOn",e,t,n)||i.someProp("handleClick",s=>s(i,e,n))||(r?ha(i,t):fa(i,t))}function ma(i,e,t,n){return pi(i,"handleDoubleClickOn",e,t,n)||i.someProp("handleDoubleClick",r=>r(i,e,n))}function ga(i,e,t,n){return pi(i,"handleTripleClickOn",e,t,n)||i.someProp("handleTripleClick",r=>r(i,e,n))||ya(i,t,n)}function ya(i,e,t){if(t.button!=0)return!1;let n=i.state.doc;if(e==-1)return n.inlineContent?(Xe(i,C.create(n,0,n.content.size)),!0):!1;let r=n.resolve(e);for(let s=r.depth+1;s>0;s--){let o=s>r.depth?r.nodeAfter:r.node(s),l=r.before(s);if(o.inlineContent)Xe(i,C.create(n,l+1,l+1+o.content.size));else if(k.isSelectable(o))Xe(i,k.create(n,l));else continue;return!0}}function mi(i){return Xt(i)}const Is=G?"metaKey":"ctrlKey";F.mousedown=(i,e)=>{let t=e;i.input.shiftKey=t.shiftKey;let n=mi(i),r=Date.now(),s="singleClick";r-i.input.lastClick.time<500&&da(t,i.input.lastClick)&&!t[Is]&&(i.input.lastClick.type=="singleClick"?s="doubleClick":i.input.lastClick.type=="doubleClick"&&(s="tripleClick")),i.input.lastClick={time:r,x:t.clientX,y:t.clientY,type:s};let o=i.posAtCoords(cn(t));o&&(s=="singleClick"?(i.input.mouseDown&&i.input.mouseDown.done(),i.input.mouseDown=new ba(i,o,t,!!n)):(s=="doubleClick"?ma:ga)(i,o.pos,o.inside,t)?t.preventDefault():we(i,"pointer"))};class ba{constructor(e,t,n,r){this.view=e,this.pos=t,this.event=n,this.flushed=r,this.delayedSelectionSync=!1,this.mightDrag=null,this.startDoc=e.state.doc,this.selectNode=!!n[Is],this.allowDefault=n.shiftKey;let s,o;if(t.inside>-1)s=e.state.doc.nodeAt(t.inside),o=t.inside;else{let c=e.state.doc.resolve(t.pos);s=c.parent,o=c.depth?c.before():0}const l=r?null:n.target,a=l?e.docView.nearestDesc(l,!0):null;this.target=a&&a.dom.nodeType==1?a.dom:null;let{selection:u}=e.state;(n.button==0&&s.type.spec.draggable&&s.type.spec.selectable!==!1||u instanceof k&&u.from<=o&&u.to>o)&&(this.mightDrag={node:s,pos:o,addAttr:!!(this.target&&!this.target.draggable),setUneditable:!!(this.target&&te&&!this.target.hasAttribute("contentEditable"))}),this.target&&this.mightDrag&&(this.mightDrag.addAttr||this.mightDrag.setUneditable)&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&(this.target.draggable=!0),this.mightDrag.setUneditable&&setTimeout(()=>{this.view.input.mouseDown==this&&this.target.setAttribute("contentEditable","false")},20),this.view.domObserver.start()),e.root.addEventListener("mouseup",this.up=this.up.bind(this)),e.root.addEventListener("mousemove",this.move=this.move.bind(this)),we(e,"pointer")}done(){this.view.root.removeEventListener("mouseup",this.up),this.view.root.removeEventListener("mousemove",this.move),this.mightDrag&&this.target&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&this.target.removeAttribute("draggable"),this.mightDrag.setUneditable&&this.target.removeAttribute("contentEditable"),this.view.domObserver.start()),this.delayedSelectionSync&&setTimeout(()=>fe(this.view)),this.view.input.mouseDown=null}up(e){if(this.done(),!this.view.dom.contains(e.target))return;let t=this.pos;this.view.state.doc!=this.startDoc&&(t=this.view.posAtCoords(cn(e))),this.updateAllowDefault(e),this.allowDefault||!t?we(this.view,"pointer"):pa(this.view,t.pos,t.inside,e,this.selectNode)?e.preventDefault():e.button==0&&(this.flushed||V&&this.mightDrag&&!this.mightDrag.node.isAtom||B&&!this.view.state.selection.visible&&Math.min(Math.abs(t.pos-this.view.state.selection.from),Math.abs(t.pos-this.view.state.selection.to))<=2)?(Xe(this.view,S.near(this.view.state.doc.resolve(t.pos))),e.preventDefault()):we(this.view,"pointer")}move(e){this.updateAllowDefault(e),we(this.view,"pointer"),e.buttons==0&&this.done()}updateAllowDefault(e){!this.allowDefault&&(Math.abs(this.event.x-e.clientX)>4||Math.abs(this.event.y-e.clientY)>4)&&(this.allowDefault=!0)}}F.touchstart=i=>{i.input.lastTouch=Date.now(),mi(i),we(i,"pointer")};F.touchmove=i=>{i.input.lastTouch=Date.now(),we(i,"pointer")};F.contextmenu=i=>mi(i);function qs(i,e){return i.composing?!0:V&&Math.abs(e.timeStamp-i.input.compositionEndedAt)<500?(i.input.compositionEndedAt=-2e8,!0):!1}const xa=Z?5e3:-1;L.compositionstart=L.compositionupdate=i=>{if(!i.composing){i.domObserver.flush();let{state:e}=i,t=e.selection.$to;if(e.selection instanceof C&&(e.storedMarks||!t.textOffset&&t.parentOffset&&t.nodeBefore.marks.some(n=>n.type.spec.inclusive===!1)))i.markCursor=i.state.storedMarks||t.marks(),Xt(i,!0),i.markCursor=null;else if(Xt(i,!e.selection.empty),te&&e.selection.empty&&t.parentOffset&&!t.textOffset&&t.nodeBefore.marks.length){let n=i.domSelectionRange();for(let r=n.focusNode,s=n.focusOffset;r&&r.nodeType==1&&s!=0;){let o=s<0?r.lastChild:r.childNodes[s-1];if(!o)break;if(o.nodeType==3){let l=i.domSelection();l&&l.collapse(o,o.nodeValue.length);break}else r=o,s=-1}}i.input.composing=!0}Rs(i,xa)};L.compositionend=(i,e)=>{i.composing&&(i.input.composing=!1,i.input.compositionEndedAt=e.timeStamp,i.input.compositionPendingChanges=i.domObserver.pendingRecords().length?i.input.compositionID:0,i.input.compositionNode=null,i.input.compositionPendingChanges&&Promise.resolve().then(()=>i.domObserver.flush()),i.input.compositionID++,Rs(i,20))};function Rs(i,e){clearTimeout(i.input.composingTimeout),e>-1&&(i.input.composingTimeout=setTimeout(()=>Xt(i),e))}function Ps(i){for(i.composing&&(i.input.composing=!1,i.input.compositionEndedAt=Sa());i.input.compositionNodes.length>0;)i.input.compositionNodes.pop().markParentsDirty()}function ka(i){let e=i.domSelectionRange();if(!e.focusNode)return null;let t=hl(e.focusNode,e.focusOffset),n=pl(e.focusNode,e.focusOffset);if(t&&n&&t!=n){let r=n.pmViewDesc,s=i.domObserver.lastChangedTextNode;if(t==s||n==s)return s;if(!r||!r.isText(n.nodeValue))return n;if(i.input.compositionNode==n){let o=t.pmViewDesc;if(!(!o||!o.isText(t.nodeValue)))return n}}return t||n}function Sa(){let i=document.createEvent("Event");return i.initEvent("event",!0,!0),i.timeStamp}function Xt(i,e=!1){if(!(Z&&i.domObserver.flushingSoon>=0)){if(i.domObserver.forceFlush(),Ps(i),e||i.docView&&i.docView.dirty){let t=di(i);return t&&!t.eq(i.state.selection)?i.dispatch(i.state.tr.setSelection(t)):(i.markCursor||e)&&!i.state.selection.empty?i.dispatch(i.state.tr.deleteSelection()):i.updateState(i.state),!0}return!1}}function wa(i,e){if(!i.dom.parentNode)return;let t=i.dom.parentNode.appendChild(document.createElement("div"));t.appendChild(e),t.style.cssText="position: fixed; left: -10000px; top: 10px";let n=getSelection(),r=document.createRange();r.selectNodeContents(e),i.dom.blur(),n.removeAllRanges(),n.addRange(r),setTimeout(()=>{t.parentNode&&t.parentNode.removeChild(t),i.focus()},50)}const kt=H&&Ce<15||nt&&xl<604;F.copy=L.cut=(i,e)=>{let t=e,n=i.state.selection,r=t.type=="cut";if(n.empty)return;let s=kt?null:t.clipboardData,o=n.content(),{dom:l,text:a}=Os(i,o);s?(t.preventDefault(),s.clearData(),s.setData("text/html",l.innerHTML),s.setData("text/plain",a)):wa(i,l),r&&i.dispatch(i.state.tr.deleteSelection().scrollIntoView().setMeta("uiEvent","cut"))};function Ca(i){return i.openStart==0&&i.openEnd==0&&i.content.childCount==1?i.content.firstChild:null}function Ma(i,e){if(!i.dom.parentNode)return;let t=i.input.shiftKey||i.state.selection.$from.parent.type.spec.code,n=i.dom.parentNode.appendChild(document.createElement(t?"textarea":"div"));t||(n.contentEditable="true"),n.style.cssText="position: fixed; left: -10000px; top: 10px",n.focus();let r=i.input.shiftKey&&i.input.lastKeyCode!=45;setTimeout(()=>{i.focus(),n.parentNode&&n.parentNode.removeChild(n),t?St(i,n.value,null,r,e):St(i,n.textContent,n.innerHTML,r,e)},50)}function St(i,e,t,n,r){let s=vs(i,e,t,n,i.state.selection.$from);if(i.someProp("handlePaste",a=>a(i,r,s||b.empty)))return!0;if(!s)return!1;let o=Ca(s),l=o?i.state.tr.replaceSelectionWith(o,n):i.state.tr.replaceSelection(s);return i.dispatch(l.scrollIntoView().setMeta("paste",!0).setMeta("uiEvent","paste")),!0}function zs(i){let e=i.getData("text/plain")||i.getData("Text");if(e)return e;let t=i.getData("text/uri-list");return t?t.replace(/\r?\n/g," "):""}L.paste=(i,e)=>{let t=e;if(i.composing&&!Z)return;let n=kt?null:t.clipboardData,r=i.input.shiftKey&&i.input.lastKeyCode!=45;n&&St(i,zs(n),n.getData("text/html"),r,t)?t.preventDefault():Ma(i,t)};class Bs{constructor(e,t,n){this.slice=e,this.move=t,this.node=n}}const Vs=G?"altKey":"ctrlKey";F.dragstart=(i,e)=>{let t=e,n=i.input.mouseDown;if(n&&n.done(),!t.dataTransfer)return;let r=i.state.selection,s=r.empty?null:i.posAtCoords(cn(t)),o;if(!(s&&s.pos>=r.from&&s.pos<=(r instanceof k?r.to-1:r.to))){if(n&&n.mightDrag)o=k.create(i.state.doc,n.mightDrag.pos);else if(t.target&&t.target.nodeType==1){let d=i.docView.nearestDesc(t.target,!0);d&&d.node.type.spec.draggable&&d!=i.docView&&(o=k.create(i.state.doc,d.posBefore))}}let l=(o||i.state.selection).content(),{dom:a,text:u,slice:c}=Os(i,l);(!t.dataTransfer.files.length||!B||us>120)&&t.dataTransfer.clearData(),t.dataTransfer.setData(kt?"Text":"text/html",a.innerHTML),t.dataTransfer.effectAllowed="copyMove",kt||t.dataTransfer.setData("text/plain",u),i.dragging=new Bs(c,!t[Vs],o)};F.dragend=i=>{let e=i.dragging;window.setTimeout(()=>{i.dragging==e&&(i.dragging=null)},50)};L.dragover=L.dragenter=(i,e)=>e.preventDefault();L.drop=(i,e)=>{let t=e,n=i.dragging;if(i.dragging=null,!t.dataTransfer)return;let r=i.posAtCoords(cn(t));if(!r)return;let s=i.state.doc.resolve(r.pos),o=n&&n.slice;o?i.someProp("transformPasted",h=>{o=h(o,i)}):o=vs(i,zs(t.dataTransfer),kt?null:t.dataTransfer.getData("text/html"),!1,s);let l=!!(n&&!t[Vs]);if(i.someProp("handleDrop",h=>h(i,t,o||b.empty,l))){t.preventDefault();return}if(!o)return;t.preventDefault();let a=o?es(i.state.doc,s.pos,o):s.pos;a==null&&(a=s.pos);let u=i.state.tr;if(l){let{node:h}=n;h?h.replace(u):u.deleteSelection()}let c=u.mapping.map(a),d=o.openStart==0&&o.openEnd==0&&o.content.childCount==1,f=u.doc;if(d?u.replaceRangeWith(c,c,o.content.firstChild):u.replaceRange(c,c,o),u.doc.eq(f))return;let p=u.doc.resolve(c);if(d&&k.isSelectable(o.content.firstChild)&&p.nodeAfter&&p.nodeAfter.sameMarkup(o.content.firstChild))u.setSelection(new k(p));else{let h=u.mapping.map(a);u.mapping.maps[u.mapping.maps.length-1].forEach((m,g,x,O)=>h=O),u.setSelection(fi(i,p,u.doc.resolve(h)))}i.focus(),i.dispatch(u.setMeta("uiEvent","drop"))};F.focus=i=>{i.input.lastFocus=Date.now(),i.focused||(i.domObserver.stop(),i.dom.classList.add("ProseMirror-focused"),i.domObserver.start(),i.focused=!0,setTimeout(()=>{i.docView&&i.hasFocus()&&!i.domObserver.currentSelection.eq(i.domSelectionRange())&&fe(i)},20))};F.blur=(i,e)=>{let t=e;i.focused&&(i.domObserver.stop(),i.dom.classList.remove("ProseMirror-focused"),i.domObserver.start(),t.relatedTarget&&i.dom.contains(t.relatedTarget)&&i.domObserver.currentSelection.clear(),i.focused=!1)};F.beforeinput=(i,e)=>{if(B&&Z&&e.inputType=="deleteContentBackward"){i.domObserver.flushSoon();let{domChangeCount:n}=i.input;setTimeout(()=>{if(i.input.domChangeCount!=n||(i.dom.blur(),i.focus(),i.someProp("handleKeyDown",s=>s(i,Te(8,"Backspace")))))return;let{$cursor:r}=i.state.selection;r&&r.pos>0&&i.dispatch(i.state.tr.delete(r.pos-1,r.pos).scrollIntoView())},50)}};for(let i in L)F[i]=L[i];function wt(i,e){if(i==e)return!0;for(let t in i)if(i[t]!==e[t])return!1;for(let t in e)if(!(t in i))return!1;return!0}class Zt{constructor(e,t){this.toDOM=e,this.spec=t||ze,this.side=this.spec.side||0}map(e,t,n,r){let{pos:s,deleted:o}=e.mapResult(t.from+r,this.side<0?-1:1);return o?null:new J(s-n,s-n,this)}valid(){return!0}eq(e){return this==e||e instanceof Zt&&(this.spec.key&&this.spec.key==e.spec.key||this.toDOM==e.toDOM&&wt(this.spec,e.spec))}destroy(e){this.spec.destroy&&this.spec.destroy(e)}}class Oe{constructor(e,t){this.attrs=e,this.spec=t||ze}map(e,t,n,r){let s=e.map(t.from+r,this.spec.inclusiveStart?-1:1)-n,o=e.map(t.to+r,this.spec.inclusiveEnd?1:-1)-n;return s>=o?null:new J(s,o,this)}valid(e,t){return t.from<t.to}eq(e){return this==e||e instanceof Oe&&wt(this.attrs,e.attrs)&&wt(this.spec,e.spec)}static is(e){return e.type instanceof Oe}destroy(){}}class gi{constructor(e,t){this.attrs=e,this.spec=t||ze}map(e,t,n,r){let s=e.mapResult(t.from+r,1);if(s.deleted)return null;let o=e.mapResult(t.to+r,-1);return o.deleted||o.pos<=s.pos?null:new J(s.pos-n,o.pos-n,this)}valid(e,t){let{index:n,offset:r}=e.content.findIndex(t.from),s;return r==t.from&&!(s=e.child(n)).isText&&r+s.nodeSize==t.to}eq(e){return this==e||e instanceof gi&&wt(this.attrs,e.attrs)&&wt(this.spec,e.spec)}destroy(){}}class J{constructor(e,t,n){this.from=e,this.to=t,this.type=n}copy(e,t){return new J(e,t,this.type)}eq(e,t=0){return this.type.eq(e.type)&&this.from+t==e.from&&this.to+t==e.to}map(e,t,n){return this.type.map(e,this,t,n)}static widget(e,t,n){return new J(e,e,new Zt(t,n))}static inline(e,t,n,r){return new J(e,t,new Oe(n,r))}static node(e,t,n,r){return new J(e,t,new gi(n,r))}get spec(){return this.type.spec}get inline(){return this.type instanceof Oe}get widget(){return this.type instanceof Zt}}const Ue=[],ze={};class v{constructor(e,t){this.local=e.length?e:Ue,this.children=t.length?t:Ue}static create(e,t){return t.length?en(t,e,0,ze):P}find(e,t,n){let r=[];return this.findInner(e??0,t??1e9,r,0,n),r}findInner(e,t,n,r,s){for(let o=0;o<this.local.length;o++){let l=this.local[o];l.from<=t&&l.to>=e&&(!s||s(l.spec))&&n.push(l.copy(l.from+r,l.to+r))}for(let o=0;o<this.children.length;o+=3)if(this.children[o]<t&&this.children[o+1]>e){let l=this.children[o]+1;this.children[o+2].findInner(e-l,t-l,n,r+l,s)}}map(e,t,n){return this==P||e.maps.length==0?this:this.mapInner(e,t,0,0,n||ze)}mapInner(e,t,n,r,s){let o;for(let l=0;l<this.local.length;l++){let a=this.local[l].map(e,n,r);a&&a.type.valid(t,a)?(o||(o=[])).push(a):s.onRemove&&s.onRemove(this.local[l].spec)}return this.children.length?Oa(this.children,o||[],e,t,n,r,s):o?new v(o.sort(Be),Ue):P}add(e,t){return t.length?this==P?v.create(e,t):this.addInner(e,t,0):this}addInner(e,t,n){let r,s=0;e.forEach((l,a)=>{let u=a+n,c;if(c=Ls(t,l,u)){for(r||(r=this.children.slice());s<r.length&&r[s]<a;)s+=3;r[s]==a?r[s+2]=r[s+2].addInner(l,c,u+1):r.splice(s,0,a,a+l.nodeSize,en(c,l,u+1,ze)),s+=3}});let o=Fs(s?Ws(t):t,-n);for(let l=0;l<o.length;l++)o[l].type.valid(e,o[l])||o.splice(l--,1);return new v(o.length?this.local.concat(o).sort(Be):this.local,r||this.children)}remove(e){return e.length==0||this==P?this:this.removeInner(e,0)}removeInner(e,t){let n=this.children,r=this.local;for(let s=0;s<n.length;s+=3){let o,l=n[s]+t,a=n[s+1]+t;for(let c=0,d;c<e.length;c++)(d=e[c])&&d.from>l&&d.to<a&&(e[c]=null,(o||(o=[])).push(d));if(!o)continue;n==this.children&&(n=this.children.slice());let u=n[s+2].removeInner(o,l+1);u!=P?n[s+2]=u:(n.splice(s,3),s-=3)}if(r.length){for(let s=0,o;s<e.length;s++)if(o=e[s])for(let l=0;l<r.length;l++)r[l].eq(o,t)&&(r==this.local&&(r=this.local.slice()),r.splice(l--,1))}return n==this.children&&r==this.local?this:r.length||n.length?new v(r,n):P}forChild(e,t){if(this==P)return this;if(t.isLeaf)return v.empty;let n,r;for(let l=0;l<this.children.length;l+=3)if(this.children[l]>=e){this.children[l]==e&&(n=this.children[l+2]);break}let s=e+1,o=s+t.content.size;for(let l=0;l<this.local.length;l++){let a=this.local[l];if(a.from<o&&a.to>s&&a.type instanceof Oe){let u=Math.max(s,a.from)-s,c=Math.min(o,a.to)-s;u<c&&(r||(r=[])).push(a.copy(u,c))}}if(r){let l=new v(r.sort(Be),Ue);return n?new be([l,n]):l}return n||P}eq(e){if(this==e)return!0;if(!(e instanceof v)||this.local.length!=e.local.length||this.children.length!=e.children.length)return!1;for(let t=0;t<this.local.length;t++)if(!this.local[t].eq(e.local[t]))return!1;for(let t=0;t<this.children.length;t+=3)if(this.children[t]!=e.children[t]||this.children[t+1]!=e.children[t+1]||!this.children[t+2].eq(e.children[t+2]))return!1;return!0}locals(e){return yi(this.localsInner(e))}localsInner(e){if(this==P)return Ue;if(e.inlineContent||!this.local.some(Oe.is))return this.local;let t=[];for(let n=0;n<this.local.length;n++)this.local[n].type instanceof Oe||t.push(this.local[n]);return t}forEachSet(e){e(this)}}v.empty=new v([],[]);v.removeOverlap=yi;const P=v.empty;class be{constructor(e){this.members=e}map(e,t){const n=this.members.map(r=>r.map(e,t,ze));return be.from(n)}forChild(e,t){if(t.isLeaf)return v.empty;let n=[];for(let r=0;r<this.members.length;r++){let s=this.members[r].forChild(e,t);s!=P&&(s instanceof be?n=n.concat(s.members):n.push(s))}return be.from(n)}eq(e){if(!(e instanceof be)||e.members.length!=this.members.length)return!1;for(let t=0;t<this.members.length;t++)if(!this.members[t].eq(e.members[t]))return!1;return!0}locals(e){let t,n=!0;for(let r=0;r<this.members.length;r++){let s=this.members[r].localsInner(e);if(s.length)if(!t)t=s;else{n&&(t=t.slice(),n=!1);for(let o=0;o<s.length;o++)t.push(s[o])}}return t?yi(n?t:t.sort(Be)):Ue}static from(e){switch(e.length){case 0:return P;case 1:return e[0];default:return new be(e.every(t=>t instanceof v)?e:e.reduce((t,n)=>t.concat(n instanceof v?n:n.members),[]))}}forEachSet(e){for(let t=0;t<this.members.length;t++)this.members[t].forEachSet(e)}}function Oa(i,e,t,n,r,s,o){let l=i.slice();for(let u=0,c=s;u<t.maps.length;u++){let d=0;t.maps[u].forEach((f,p,h,m)=>{let g=m-h-(p-f);for(let x=0;x<l.length;x+=3){let O=l[x+1];if(O<0||f>O+c-d)continue;let W=l[x]+c-d;p>=W?l[x+1]=f<=W?-2:-1:f>=c&&g&&(l[x]+=g,l[x+1]+=g)}d+=g}),c=t.maps[u].map(c,-1)}let a=!1;for(let u=0;u<l.length;u+=3)if(l[u+1]<0){if(l[u+1]==-2){a=!0,l[u+1]=-1;continue}let c=t.map(i[u]+s),d=c-r;if(d<0||d>=n.content.size){a=!0;continue}let f=t.map(i[u+1]+s,-1),p=f-r,{index:h,offset:m}=n.content.findIndex(d),g=n.maybeChild(h);if(g&&m==d&&m+g.nodeSize==p){let x=l[u+2].mapInner(t,g,c+1,i[u]+s+1,o);x!=P?(l[u]=d,l[u+1]=p,l[u+2]=x):(l[u+1]=-2,a=!0)}else a=!0}if(a){let u=va(l,i,e,t,r,s,o),c=en(u,n,0,o);e=c.local;for(let d=0;d<l.length;d+=3)l[d+1]<0&&(l.splice(d,3),d-=3);for(let d=0,f=0;d<c.children.length;d+=3){let p=c.children[d];for(;f<l.length&&l[f]<p;)f+=3;l.splice(f,0,c.children[d],c.children[d+1],c.children[d+2])}}return new v(e.sort(Be),l)}function Fs(i,e){if(!e||!i.length)return i;let t=[];for(let n=0;n<i.length;n++){let r=i[n];t.push(new J(r.from+e,r.to+e,r.type))}return t}function va(i,e,t,n,r,s,o){function l(a,u){for(let c=0;c<a.local.length;c++){let d=a.local[c].map(n,r,u);d?t.push(d):o.onRemove&&o.onRemove(a.local[c].spec)}for(let c=0;c<a.children.length;c+=3)l(a.children[c+2],a.children[c]+u+1)}for(let a=0;a<i.length;a+=3)i[a+1]==-1&&l(i[a+2],e[a]+s+1);return t}function Ls(i,e,t){if(e.isLeaf)return null;let n=t+e.nodeSize,r=null;for(let s=0,o;s<i.length;s++)(o=i[s])&&o.from>t&&o.to<n&&((r||(r=[])).push(o),i[s]=null);return r}function Ws(i){let e=[];for(let t=0;t<i.length;t++)i[t]!=null&&e.push(i[t]);return e}function en(i,e,t,n){let r=[],s=!1;e.forEach((l,a)=>{let u=Ls(i,l,a+t);if(u){s=!0;let c=en(u,l,t+a+1,n);c!=P&&r.push(a,a+l.nodeSize,c)}});let o=Fs(s?Ws(i):i,-t).sort(Be);for(let l=0;l<o.length;l++)o[l].type.valid(e,o[l])||(n.onRemove&&n.onRemove(o[l].spec),o.splice(l--,1));return o.length||r.length?new v(o,r):P}function Be(i,e){return i.from-e.from||i.to-e.to}function yi(i){let e=i;for(let t=0;t<e.length-1;t++){let n=e[t];if(n.from!=n.to)for(let r=t+1;r<e.length;r++){let s=e[r];if(s.from==n.from){s.to!=n.to&&(e==i&&(e=i.slice()),e[r]=s.copy(s.from,n.to),ar(e,r+1,s.copy(n.to,s.to)));continue}else{s.from<n.to&&(e==i&&(e=i.slice()),e[t]=n.copy(n.from,s.from),ar(e,r,n.copy(s.from,n.to)));break}}}return e}function ar(i,e,t){for(;e<i.length&&Be(t,i[e])>0;)e++;i.splice(e,0,t)}function Cn(i){let e=[];return i.someProp("decorations",t=>{let n=t(i.state);n&&n!=P&&e.push(n)}),i.cursorWrapper&&e.push(v.create(i.state.doc,[i.cursorWrapper.deco])),be.from(e)}const Na={childList:!0,characterData:!0,characterDataOldValue:!0,attributes:!0,attributeOldValue:!0,subtree:!0},Da=H&&Ce<=11;class Ea{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}set(e){this.anchorNode=e.anchorNode,this.anchorOffset=e.anchorOffset,this.focusNode=e.focusNode,this.focusOffset=e.focusOffset}clear(){this.anchorNode=this.focusNode=null}eq(e){return e.anchorNode==this.anchorNode&&e.anchorOffset==this.anchorOffset&&e.focusNode==this.focusNode&&e.focusOffset==this.focusOffset}}class Ta{constructor(e,t){this.view=e,this.handleDOMChange=t,this.queue=[],this.flushingSoon=-1,this.observer=null,this.currentSelection=new Ea,this.onCharData=null,this.suppressingSelectionUpdates=!1,this.lastChangedTextNode=null,this.observer=window.MutationObserver&&new window.MutationObserver(n=>{for(let r=0;r<n.length;r++)this.queue.push(n[r]);H&&Ce<=11&&n.some(r=>r.type=="childList"&&r.removedNodes.length||r.type=="characterData"&&r.oldValue.length>r.target.nodeValue.length)?this.flushSoon():this.flush()}),Da&&(this.onCharData=n=>{this.queue.push({target:n.target,type:"characterData",oldValue:n.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this)}flushSoon(){this.flushingSoon<0&&(this.flushingSoon=window.setTimeout(()=>{this.flushingSoon=-1,this.flush()},20))}forceFlush(){this.flushingSoon>-1&&(window.clearTimeout(this.flushingSoon),this.flushingSoon=-1,this.flush())}start(){this.observer&&(this.observer.takeRecords(),this.observer.observe(this.view.dom,Na)),this.onCharData&&this.view.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.connectSelection()}stop(){if(this.observer){let e=this.observer.takeRecords();if(e.length){for(let t=0;t<e.length;t++)this.queue.push(e[t]);window.setTimeout(()=>this.flush(),20)}this.observer.disconnect()}this.onCharData&&this.view.dom.removeEventListener("DOMCharacterDataModified",this.onCharData),this.disconnectSelection()}connectSelection(){this.view.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)}disconnectSelection(){this.view.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange)}suppressSelectionUpdates(){this.suppressingSelectionUpdates=!0,setTimeout(()=>this.suppressingSelectionUpdates=!1,50)}onSelectionChange(){if(er(this.view)){if(this.suppressingSelectionUpdates)return fe(this.view);if(H&&Ce<=11&&!this.view.state.selection.empty){let e=this.view.domSelectionRange();if(e.focusNode&&We(e.focusNode,e.focusOffset,e.anchorNode,e.anchorOffset))return this.flushSoon()}this.flush()}}setCurSelection(){this.currentSelection.set(this.view.domSelectionRange())}ignoreSelectionChange(e){if(!e.focusNode)return!0;let t=new Set,n;for(let s=e.focusNode;s;s=xt(s))t.add(s);for(let s=e.anchorNode;s;s=xt(s))if(t.has(s)){n=s;break}let r=n&&this.view.docView.nearestDesc(n);if(r&&r.ignoreMutation({type:"selection",target:n.nodeType==3?n.parentNode:n}))return this.setCurSelection(),!0}pendingRecords(){if(this.observer)for(let e of this.observer.takeRecords())this.queue.push(e);return this.queue}flush(){let{view:e}=this;if(!e.docView||this.flushingSoon>-1)return;let t=this.pendingRecords();t.length&&(this.queue=[]);let n=e.domSelectionRange(),r=!this.suppressingSelectionUpdates&&!this.currentSelection.eq(n)&&er(e)&&!this.ignoreSelectionChange(n),s=-1,o=-1,l=!1,a=[];if(e.editable)for(let c=0;c<t.length;c++){let d=this.registerMutation(t[c],a);d&&(s=s<0?d.from:Math.min(d.from,s),o=o<0?d.to:Math.max(d.to,o),d.typeOver&&(l=!0))}if(te&&a.length){let c=a.filter(d=>d.nodeName=="BR");if(c.length==2){let[d,f]=c;d.parentNode&&d.parentNode.parentNode==f.parentNode?f.remove():d.remove()}else{let{focusNode:d}=this.currentSelection;for(let f of c){let p=f.parentNode;p&&p.nodeName=="LI"&&(!d||qa(e,d)!=p)&&f.remove()}}}let u=null;s<0&&r&&e.input.lastFocus>Date.now()-200&&Math.max(e.input.lastTouch,e.input.lastClick.time)<Date.now()-300&&an(n)&&(u=di(e))&&u.eq(S.near(e.state.doc.resolve(0),1))?(e.input.lastFocus=0,fe(e),this.currentSelection.set(n),e.scrollToSelection()):(s>-1||r)&&(s>-1&&(e.docView.markDirty(s,o),Aa(e)),this.handleDOMChange(s,o,l,a),e.docView&&e.docView.dirty?e.updateState(e.state):this.currentSelection.eq(n)||fe(e),this.currentSelection.set(n))}registerMutation(e,t){if(t.indexOf(e.target)>-1)return null;let n=this.view.docView.nearestDesc(e.target);if(e.type=="attributes"&&(n==this.view.docView||e.attributeName=="contenteditable"||e.attributeName=="style"&&!e.oldValue&&!e.target.getAttribute("style"))||!n||n.ignoreMutation(e))return null;if(e.type=="childList"){for(let c=0;c<e.addedNodes.length;c++){let d=e.addedNodes[c];t.push(d),d.nodeType==3&&(this.lastChangedTextNode=d)}if(n.contentDOM&&n.contentDOM!=n.dom&&!n.contentDOM.contains(e.target))return{from:n.posBefore,to:n.posAfter};let r=e.previousSibling,s=e.nextSibling;if(H&&Ce<=11&&e.addedNodes.length)for(let c=0;c<e.addedNodes.length;c++){let{previousSibling:d,nextSibling:f}=e.addedNodes[c];(!d||Array.prototype.indexOf.call(e.addedNodes,d)<0)&&(r=d),(!f||Array.prototype.indexOf.call(e.addedNodes,f)<0)&&(s=f)}let o=r&&r.parentNode==e.target?I(r)+1:0,l=n.localPosFromDOM(e.target,o,-1),a=s&&s.parentNode==e.target?I(s):e.target.childNodes.length,u=n.localPosFromDOM(e.target,a,1);return{from:l,to:u}}else return e.type=="attributes"?{from:n.posAtStart-n.border,to:n.posAtEnd+n.border}:(this.lastChangedTextNode=e.target,{from:n.posAtStart,to:n.posAtEnd,typeOver:e.target.nodeValue==e.oldValue})}}let ur=new WeakMap,cr=!1;function Aa(i){if(!ur.has(i)&&(ur.set(i,null),["normal","nowrap","pre-line"].indexOf(getComputedStyle(i.dom).whiteSpace)!==-1)){if(i.requiresGeckoHackNode=te,cr)return;console.warn("ProseMirror expects the CSS white-space property to be set, preferably to 'pre-wrap'. It is recommended to load style/prosemirror.css from the prosemirror-view package."),cr=!0}}function dr(i,e){let t=e.startContainer,n=e.startOffset,r=e.endContainer,s=e.endOffset,o=i.domAtPos(i.state.selection.anchor);return We(o.node,o.offset,r,s)&&([t,n,r,s]=[r,s,t,n]),{anchorNode:t,anchorOffset:n,focusNode:r,focusOffset:s}}function Ia(i,e){if(e.getComposedRanges){let r=e.getComposedRanges(i.root)[0];if(r)return dr(i,r)}let t;function n(r){r.preventDefault(),r.stopImmediatePropagation(),t=r.getTargetRanges()[0]}return i.dom.addEventListener("beforeinput",n,!0),document.execCommand("indent"),i.dom.removeEventListener("beforeinput",n,!0),t?dr(i,t):null}function qa(i,e){for(let t=e.parentNode;t&&t!=i.dom;t=t.parentNode){let n=i.docView.nearestDesc(t,!0);if(n&&n.node.isBlock)return t}return null}function Ra(i,e,t){let{node:n,fromOffset:r,toOffset:s,from:o,to:l}=i.docView.parseRange(e,t),a=i.domSelectionRange(),u,c=a.anchorNode;if(c&&i.dom.contains(c.nodeType==1?c:c.parentNode)&&(u=[{node:c,offset:a.anchorOffset}],an(a)||u.push({node:a.focusNode,offset:a.focusOffset})),B&&i.input.lastKeyCode===8)for(let g=s;g>r;g--){let x=n.childNodes[g-1],O=x.pmViewDesc;if(x.nodeName=="BR"&&!O){s=g;break}if(!O||O.size)break}let d=i.state.doc,f=i.someProp("domParser")||Ze.fromSchema(i.state.schema),p=d.resolve(o),h=null,m=f.parse(n,{topNode:p.parent,topMatch:p.parent.contentMatchAt(p.index()),topOpen:!0,from:r,to:s,preserveWhitespace:p.parent.type.whitespace=="pre"?"full":!0,findPositions:u,ruleFromNode:Pa,context:p});if(u&&u[0].pos!=null){let g=u[0].pos,x=u[1]&&u[1].pos;x==null&&(x=g),h={anchor:g+o,head:x+o}}return{doc:m,sel:h,from:o,to:l}}function Pa(i){let e=i.pmViewDesc;if(e)return e.parseRule();if(i.nodeName=="BR"&&i.parentNode){if(V&&/^(ul|ol)$/i.test(i.parentNode.nodeName)){let t=document.createElement("div");return t.appendChild(document.createElement("li")),{skip:t}}else if(i.parentNode.lastChild==i||V&&/^(tr|table)$/i.test(i.parentNode.nodeName))return{ignore:!0}}else if(i.nodeName=="IMG"&&i.getAttribute("mark-placeholder"))return{ignore:!0};return null}const za=/^(a|abbr|acronym|b|bd[io]|big|br|button|cite|code|data(list)?|del|dfn|em|i|ins|kbd|label|map|mark|meter|output|q|ruby|s|samp|small|span|strong|su[bp]|time|u|tt|var)$/i;function Ba(i,e,t,n,r){let s=i.input.compositionPendingChanges||(i.composing?i.input.compositionID:0);if(i.input.compositionPendingChanges=0,e<0){let w=i.input.lastSelectionTime>Date.now()-50?i.input.lastSelectionOrigin:null,pe=di(i,w);if(pe&&!i.state.selection.eq(pe)){if(B&&Z&&i.input.lastKeyCode===13&&Date.now()-100<i.input.lastKeyCodeTime&&i.someProp("handleKeyDown",ho=>ho(i,Te(13,"Enter"))))return;let At=i.state.tr.setSelection(pe);w=="pointer"?At.setMeta("pointer",!0):w=="key"&&At.scrollIntoView(),s&&At.setMeta("composition",s),i.dispatch(At)}return}let o=i.state.doc.resolve(e),l=o.sharedDepth(t);e=o.before(l+1),t=i.state.doc.resolve(t).after(l+1);let a=i.state.selection,u=Ra(i,e,t),c=i.state.doc,d=c.slice(u.from,u.to),f,p;i.input.lastKeyCode===8&&Date.now()-100<i.input.lastKeyCodeTime?(f=i.state.selection.to,p="end"):(f=i.state.selection.from,p="start"),i.input.lastKeyCode=null;let h=La(d.content,u.doc.content,u.from,f,p);if(h&&i.input.domChangeCount++,(nt&&i.input.lastIOSEnter>Date.now()-225||Z)&&r.some(w=>w.nodeType==1&&!za.test(w.nodeName))&&(!h||h.endA>=h.endB)&&i.someProp("handleKeyDown",w=>w(i,Te(13,"Enter")))){i.input.lastIOSEnter=0;return}if(!h)if(n&&a instanceof C&&!a.empty&&a.$head.sameParent(a.$anchor)&&!i.composing&&!(u.sel&&u.sel.anchor!=u.sel.head))h={start:a.from,endA:a.to,endB:a.to};else{if(u.sel){let w=fr(i,i.state.doc,u.sel);if(w&&!w.eq(i.state.selection)){let pe=i.state.tr.setSelection(w);s&&pe.setMeta("composition",s),i.dispatch(pe)}}return}i.state.selection.from<i.state.selection.to&&h.start==h.endB&&i.state.selection instanceof C&&(h.start>i.state.selection.from&&h.start<=i.state.selection.from+2&&i.state.selection.from>=u.from?h.start=i.state.selection.from:h.endA<i.state.selection.to&&h.endA>=i.state.selection.to-2&&i.state.selection.to<=u.to&&(h.endB+=i.state.selection.to-h.endA,h.endA=i.state.selection.to)),H&&Ce<=11&&h.endB==h.start+1&&h.endA==h.start&&h.start>u.from&&u.doc.textBetween(h.start-u.from-1,h.start-u.from+1)==" "&&(h.start--,h.endA--,h.endB--);let m=u.doc.resolveNoCache(h.start-u.from),g=u.doc.resolveNoCache(h.endB-u.from),x=c.resolve(h.start),O=m.sameParent(g)&&m.parent.inlineContent&&x.end()>=h.endA,W;if((nt&&i.input.lastIOSEnter>Date.now()-225&&(!O||r.some(w=>w.nodeName=="DIV"||w.nodeName=="P"))||!O&&m.pos<u.doc.content.size&&!m.sameParent(g)&&(W=S.findFrom(u.doc.resolve(m.pos+1),1,!0))&&W.head==g.pos)&&i.someProp("handleKeyDown",w=>w(i,Te(13,"Enter")))){i.input.lastIOSEnter=0;return}if(i.state.selection.anchor>h.start&&Fa(c,h.start,h.endA,m,g)&&i.someProp("handleKeyDown",w=>w(i,Te(8,"Backspace")))){Z&&B&&i.domObserver.suppressSelectionUpdates();return}B&&Z&&h.endB==h.start&&(i.input.lastAndroidDelete=Date.now()),Z&&!O&&m.start()!=g.start()&&g.parentOffset==0&&m.depth==g.depth&&u.sel&&u.sel.anchor==u.sel.head&&u.sel.head==h.endA&&(h.endB-=2,g=u.doc.resolveNoCache(h.endB-u.from),setTimeout(()=>{i.someProp("handleKeyDown",function(w){return w(i,Te(13,"Enter"))})},20));let he=h.start,Ee=h.endA,$,fn,Tt;if(O){if(m.pos==g.pos)H&&Ce<=11&&m.parentOffset==0&&(i.domObserver.suppressSelectionUpdates(),setTimeout(()=>fe(i),20)),$=i.state.tr.delete(he,Ee),fn=c.resolve(h.start).marksAcross(c.resolve(h.endA));else if(h.endA==h.endB&&(Tt=Va(m.parent.content.cut(m.parentOffset,g.parentOffset),x.parent.content.cut(x.parentOffset,h.endA-x.start()))))$=i.state.tr,Tt.type=="add"?$.addMark(he,Ee,Tt.mark):$.removeMark(he,Ee,Tt.mark);else if(m.parent.child(m.index()).isText&&m.index()==g.index()-(g.textOffset?0:1)){let w=m.parent.textBetween(m.parentOffset,g.parentOffset);if(i.someProp("handleTextInput",pe=>pe(i,he,Ee,w)))return;$=i.state.tr.insertText(w,he,Ee)}}if($||($=i.state.tr.replace(he,Ee,u.doc.slice(h.start-u.from,h.endB-u.from))),u.sel){let w=fr(i,$.doc,u.sel);w&&!(B&&Z&&i.composing&&w.empty&&(h.start!=h.endB||i.input.lastAndroidDelete<Date.now()-100)&&(w.head==he||w.head==$.mapping.map(Ee)-1)||H&&w.empty&&w.head==he)&&$.setSelection(w)}fn&&$.ensureMarks(fn),s&&$.setMeta("composition",s),i.dispatch($.scrollIntoView())}function fr(i,e,t){return Math.max(t.anchor,t.head)>e.content.size?null:fi(i,e.resolve(t.anchor),e.resolve(t.head))}function Va(i,e){let t=i.firstChild.marks,n=e.firstChild.marks,r=t,s=n,o,l,a;for(let c=0;c<n.length;c++)r=n[c].removeFromSet(r);for(let c=0;c<t.length;c++)s=t[c].removeFromSet(s);if(r.length==1&&s.length==0)l=r[0],o="add",a=c=>c.mark(l.addToSet(c.marks));else if(r.length==0&&s.length==1)l=s[0],o="remove",a=c=>c.mark(l.removeFromSet(c.marks));else return null;let u=[];for(let c=0;c<e.childCount;c++)u.push(a(e.child(c)));if(y.from(u).eq(i))return{mark:l,type:o}}function Fa(i,e,t,n,r){if(t-e<=r.pos-n.pos||Mn(n,!0,!1)<r.pos)return!1;let s=i.resolve(e);if(!n.parent.isTextblock){let l=s.nodeAfter;return l!=null&&t==e+l.nodeSize}if(s.parentOffset<s.parent.content.size||!s.parent.isTextblock)return!1;let o=i.resolve(Mn(s,!0,!0));return!o.parent.isTextblock||o.pos>t||Mn(o,!0,!1)<t?!1:n.parent.content.cut(n.parentOffset).eq(o.parent.content)}function Mn(i,e,t){let n=i.depth,r=e?i.end():i.pos;for(;n>0&&(e||i.indexAfter(n)==i.node(n).childCount);)n--,r++,e=!1;if(t){let s=i.node(n).maybeChild(i.indexAfter(n));for(;s&&!s.isLeaf;)s=s.firstChild,r++}return r}function La(i,e,t,n,r){let s=i.findDiffStart(e,t);if(s==null)return null;let{a:o,b:l}=i.findDiffEnd(e,t+i.size,t+e.size);if(r=="end"){let a=Math.max(0,s-Math.min(o,l));n-=o+a-s}if(o<s&&i.size<e.size){let a=n<=s&&n>=o?s-n:0;s-=a,s&&s<e.size&&hr(e.textBetween(s-1,s+1))&&(s+=a?1:-1),l=s+(l-o),o=s}else if(l<s){let a=n<=s&&n>=l?s-n:0;s-=a,s&&s<i.size&&hr(i.textBetween(s-1,s+1))&&(s+=a?1:-1),o=s+(o-l),l=s}return{start:s,endA:o,endB:l}}function hr(i){if(i.length!=2)return!1;let e=i.charCodeAt(0),t=i.charCodeAt(1);return e>=56320&&e<=57343&&t>=55296&&t<=56319}class Wa{constructor(e,t){this._root=null,this.focused=!1,this.trackWrites=null,this.mounted=!1,this.markCursor=null,this.cursorWrapper=null,this.lastSelectedViewDesc=void 0,this.input=new oa,this.prevDirectPlugins=[],this.pluginViews=[],this.requiresGeckoHackNode=!1,this.dragging=null,this._props=t,this.state=t.state,this.directPlugins=t.plugins||[],this.directPlugins.forEach(br),this.dispatch=this.dispatch.bind(this),this.dom=e&&e.mount||document.createElement("div"),e&&(e.appendChild?e.appendChild(this.dom):typeof e=="function"?e(this.dom):e.mount&&(this.mounted=!0)),this.editable=gr(this),mr(this),this.nodeViews=yr(this),this.docView=ji(this.state.doc,pr(this),Cn(this),this.dom,this),this.domObserver=new Ta(this,(n,r,s,o)=>Ba(this,n,r,s,o)),this.domObserver.start(),la(this),this.updatePluginViews()}get composing(){return this.input.composing}get props(){if(this._props.state!=this.state){let e=this._props;this._props={};for(let t in e)this._props[t]=e[t];this._props.state=this.state}return this._props}update(e){e.handleDOMEvents!=this._props.handleDOMEvents&&Un(this);let t=this._props;this._props=e,e.plugins&&(e.plugins.forEach(br),this.directPlugins=e.plugins),this.updateStateInner(e.state,t)}setProps(e){let t={};for(let n in this._props)t[n]=this._props[n];t.state=this.state;for(let n in e)t[n]=e[n];this.update(t)}updateState(e){this.updateStateInner(e,this._props)}updateStateInner(e,t){var n;let r=this.state,s=!1,o=!1;e.storedMarks&&this.composing&&(Ps(this),o=!0),this.state=e;let l=r.plugins!=e.plugins||this._props.plugins!=t.plugins;if(l||this._props.plugins!=t.plugins||this._props.nodeViews!=t.nodeViews){let p=yr(this);Ja(p,this.nodeViews)&&(this.nodeViews=p,s=!0)}(l||t.handleDOMEvents!=this._props.handleDOMEvents)&&Un(this),this.editable=gr(this),mr(this);let a=Cn(this),u=pr(this),c=r.plugins!=e.plugins&&!r.doc.eq(e.doc)?"reset":e.scrollToSelection>r.scrollToSelection?"to selection":"preserve",d=s||!this.docView.matchesNode(e.doc,u,a);(d||!e.selection.eq(r.selection))&&(o=!0);let f=c=="preserve"&&o&&this.dom.style.overflowAnchor==null&&wl(this);if(o){this.domObserver.stop();let p=d&&(H||B)&&!this.composing&&!r.selection.empty&&!e.selection.empty&&_a(r.selection,e.selection);if(d){let h=B?this.trackWrites=this.domSelectionRange().focusNode:null;this.composing&&(this.input.compositionNode=ka(this)),(s||!this.docView.update(e.doc,u,a,this))&&(this.docView.updateOuterDeco(u),this.docView.destroy(),this.docView=ji(e.doc,u,a,this.dom,this)),h&&!this.trackWrites&&(p=!0)}p||!(this.input.mouseDown&&this.domObserver.currentSelection.eq(this.domSelectionRange())&&Kl(this))?fe(this,p):(ws(this,e.selection),this.domObserver.setCurSelection()),this.domObserver.start()}this.updatePluginViews(r),!((n=this.dragging)===null||n===void 0)&&n.node&&!r.doc.eq(e.doc)&&this.updateDraggedNode(this.dragging,r),c=="reset"?this.dom.scrollTop=0:c=="to selection"?this.scrollToSelection():f&&Cl(f)}scrollToSelection(){let e=this.domSelectionRange().focusNode;if(!this.someProp("handleScrollToSelection",t=>t(this)))if(this.state.selection instanceof k){let t=this.docView.domAfterPos(this.state.selection.from);t.nodeType==1&&_i(this,t.getBoundingClientRect(),e)}else _i(this,this.coordsAtPos(this.state.selection.head,1),e)}destroyPluginViews(){let e;for(;e=this.pluginViews.pop();)e.destroy&&e.destroy()}updatePluginViews(e){if(!e||e.plugins!=this.state.plugins||this.directPlugins!=this.prevDirectPlugins){this.prevDirectPlugins=this.directPlugins,this.destroyPluginViews();for(let t=0;t<this.directPlugins.length;t++){let n=this.directPlugins[t];n.spec.view&&this.pluginViews.push(n.spec.view(this))}for(let t=0;t<this.state.plugins.length;t++){let n=this.state.plugins[t];n.spec.view&&this.pluginViews.push(n.spec.view(this))}}else for(let t=0;t<this.pluginViews.length;t++){let n=this.pluginViews[t];n.update&&n.update(this,e)}}updateDraggedNode(e,t){let n=e.node,r=-1;if(this.state.doc.nodeAt(n.from)==n.node)r=n.from;else{let s=n.from+(this.state.doc.content.size-t.doc.content.size);(s>0&&this.state.doc.nodeAt(s))==n.node&&(r=s)}this.dragging=new Bs(e.slice,e.move,r<0?void 0:k.create(this.state.doc,r))}someProp(e,t){let n=this._props&&this._props[e],r;if(n!=null&&(r=t?t(n):n))return r;for(let o=0;o<this.directPlugins.length;o++){let l=this.directPlugins[o].props[e];if(l!=null&&(r=t?t(l):l))return r}let s=this.state.plugins;if(s)for(let o=0;o<s.length;o++){let l=s[o].props[e];if(l!=null&&(r=t?t(l):l))return r}}hasFocus(){if(H){let e=this.root.activeElement;if(e==this.dom)return!0;if(!e||!this.dom.contains(e))return!1;for(;e&&this.dom!=e&&this.dom.contains(e);){if(e.contentEditable=="false")return!1;e=e.parentElement}return!0}return this.root.activeElement==this.dom}focus(){this.domObserver.stop(),this.editable&&Ml(this.dom),fe(this),this.domObserver.start()}get root(){let e=this._root;if(e==null){for(let t=this.dom.parentNode;t;t=t.parentNode)if(t.nodeType==9||t.nodeType==11&&t.host)return t.getSelection||(Object.getPrototypeOf(t).getSelection=()=>t.ownerDocument.getSelection()),this._root=t}return e||document}updateRoot(){this._root=null}posAtCoords(e){return El(this,e)}coordsAtPos(e,t=1){return ps(this,e,t)}domAtPos(e,t=0){return this.docView.domFromPos(e,t)}nodeDOM(e){let t=this.docView.descAt(e);return t?t.nodeDOM:null}posAtDOM(e,t,n=-1){let r=this.docView.posFromDOM(e,t,n);if(r==null)throw new RangeError("DOM position not inside the editor");return r}endOfTextblock(e,t){return Rl(this,t||this.state,e)}pasteHTML(e,t){return St(this,"",e,!1,t||new ClipboardEvent("paste"))}pasteText(e,t){return St(this,e,null,!0,t||new ClipboardEvent("paste"))}destroy(){this.docView&&(aa(this),this.destroyPluginViews(),this.mounted?(this.docView.update(this.state.doc,[],Cn(this),this),this.dom.textContent=""):this.dom.parentNode&&this.dom.parentNode.removeChild(this.dom),this.docView.destroy(),this.docView=null,dl())}get isDestroyed(){return this.docView==null}dispatchEvent(e){return ca(this,e)}dispatch(e){let t=this._props.dispatchTransaction;t?t.call(this,e):this.updateState(this.state.apply(e))}domSelectionRange(){let e=this.domSelection();return e?V&&this.root.nodeType===11&&gl(this.dom.ownerDocument)==this.dom&&Ia(this,e)||e:{focusNode:null,focusOffset:0,anchorNode:null,anchorOffset:0}}domSelection(){return this.root.getSelection()}}function pr(i){let e=Object.create(null);return e.class="ProseMirror",e.contenteditable=String(i.editable),i.someProp("attributes",t=>{if(typeof t=="function"&&(t=t(i.state)),t)for(let n in t)n=="class"?e.class+=" "+t[n]:n=="style"?e.style=(e.style?e.style+";":"")+t[n]:!e[n]&&n!="contenteditable"&&n!="nodeName"&&(e[n]=String(t[n]))}),e.translate||(e.translate="no"),[J.node(0,i.state.doc.content.size,e)]}function mr(i){if(i.markCursor){let e=document.createElement("img");e.className="ProseMirror-separator",e.setAttribute("mark-placeholder","true"),e.setAttribute("alt",""),i.cursorWrapper={dom:e,deco:J.widget(i.state.selection.from,e,{raw:!0,marks:i.markCursor})}}else i.cursorWrapper=null}function gr(i){return!i.someProp("editable",e=>e(i.state)===!1)}function _a(i,e){let t=Math.min(i.$anchor.sharedDepth(i.head),e.$anchor.sharedDepth(e.head));return i.$anchor.start(t)!=e.$anchor.start(t)}function yr(i){let e=Object.create(null);function t(n){for(let r in n)Object.prototype.hasOwnProperty.call(e,r)||(e[r]=n[r])}return i.someProp("nodeViews",t),i.someProp("markViews",t),e}function Ja(i,e){let t=0,n=0;for(let r in i){if(i[r]!=e[r])return!0;t++}for(let r in e)n++;return t!=n}function br(i){if(i.spec.state||i.spec.filterTransaction||i.spec.appendTransaction)throw new RangeError("Plugins passed directly to the view must not have a state component")}const Ha=["p",0],$a=["blockquote",0],Ka=["hr"],Ua=["pre",["code",0]],ja=["br"],Ga={doc:{content:"block+"},paragraph:{content:"inline*",group:"block",parseDOM:[{tag:"p"}],toDOM(){return Ha}},blockquote:{content:"block+",group:"block",defining:!0,parseDOM:[{tag:"blockquote"}],toDOM(){return $a}},horizontal_rule:{group:"block",parseDOM:[{tag:"hr"}],toDOM(){return Ka}},heading:{attrs:{level:{default:1,validate:"number"}},content:"inline*",group:"block",defining:!0,parseDOM:[{tag:"h1",attrs:{level:1}},{tag:"h2",attrs:{level:2}},{tag:"h3",attrs:{level:3}},{tag:"h4",attrs:{level:4}},{tag:"h5",attrs:{level:5}},{tag:"h6",attrs:{level:6}}],toDOM(i){return["h"+i.attrs.level,0]}},code_block:{content:"text*",marks:"",group:"block",code:!0,defining:!0,parseDOM:[{tag:"pre",preserveWhitespace:"full"}],toDOM(){return Ua}},text:{group:"inline"},image:{inline:!0,attrs:{src:{validate:"string"},alt:{default:null,validate:"string|null"},title:{default:null,validate:"string|null"}},group:"inline",draggable:!0,parseDOM:[{tag:"img[src]",getAttrs(i){return{src:i.getAttribute("src"),title:i.getAttribute("title"),alt:i.getAttribute("alt")}}}],toDOM(i){let{src:e,alt:t,title:n}=i.attrs;return["img",{src:e,alt:t,title:n}]}},hard_break:{inline:!0,group:"inline",selectable:!1,parseDOM:[{tag:"br"}],toDOM(){return ja}}},Qa=["em",0],Ya=["strong",0],Xa=["code",0],Za={link:{attrs:{href:{validate:"string"},title:{default:null,validate:"string|null"}},inclusive:!1,parseDOM:[{tag:"a[href]",getAttrs(i){return{href:i.getAttribute("href"),title:i.getAttribute("title")}}}],toDOM(i){let{href:e,title:t}=i.attrs;return["a",{href:e,title:t},0]}},em:{parseDOM:[{tag:"i"},{tag:"em"},{style:"font-style=italic"},{style:"font-style=normal",clearMark:i=>i.type.name=="em"}],toDOM(){return Qa}},strong:{parseDOM:[{tag:"strong"},{tag:"b",getAttrs:i=>i.style.fontWeight!="normal"&&null},{style:"font-weight=400",clearMark:i=>i.type.name=="strong"},{style:"font-weight",getAttrs:i=>/^(bold(er)?|[5-9]\d{2,})$/.test(i)&&null}],toDOM(){return Ya}},code:{parseDOM:[{tag:"code"}],toDOM(){return Xa}}},xr=new Jr({nodes:Ga,marks:Za}),eu=["ol",0],tu=["ul",0],nu=["li",0],iu={attrs:{order:{default:1,validate:"number"}},parseDOM:[{tag:"ol",getAttrs(i){return{order:i.hasAttribute("start")?+i.getAttribute("start"):1}}}],toDOM(i){return i.attrs.order==1?eu:["ol",{start:i.attrs.order},0]}},ru={parseDOM:[{tag:"ul"}],toDOM(){return tu}},su={parseDOM:[{tag:"li"}],toDOM(){return nu},defining:!0};function On(i,e){let t={};for(let n in i)t[n]=i[n];for(let n in e)t[n]=e[n];return t}function ou(i,e,t){return i.append({ordered_list:On(iu,{content:"list_item+",group:t}),bullet_list:On(ru,{content:"list_item+",group:t}),list_item:On(su,{content:e})})}function jn(i,e=null){return function(t,n){let{$from:r,$to:s}=t.selection,o=r.blockRange(s),l=!1,a=o;if(!o)return!1;if(o.depth>=2&&r.node(o.depth-1).type.compatibleContent(i)&&o.startIndex==0){if(r.index(o.depth-1)==0)return!1;let c=t.doc.resolve(o.start-2);a=new Ut(c,c,o.depth),o.endIndex<o.parent.childCount&&(o=new Ut(r,t.doc.resolve(s.end(o.depth)),o.depth)),l=!0}let u=oi(a,i,e,o);return u?(n&&n(lu(t.tr,o,u,l,i).scrollIntoView()),!0):!1}}function lu(i,e,t,n,r){let s=y.empty;for(let c=t.length-1;c>=0;c--)s=y.from(t[c].type.create(t[c].attrs,s));i.step(new R(e.start-(n?2:0),e.end,e.start,e.end,new b(s,0,0),t.length,!0));let o=0;for(let c=0;c<t.length;c++)t[c].type==r&&(o=c+1);let l=t.length-o,a=e.start+t.length-(n?2:0),u=e.parent;for(let c=e.startIndex,d=e.endIndex,f=!0;c<d;c++,f=!1)!f&&Qe(i.doc,a,l)&&(i.split(a,l),a+=2*l),a+=u.child(c).nodeSize;return i}function au(i,e){return function(t,n){let{$from:r,$to:s,node:o}=t.selection;if(o&&o.isBlock||r.depth<2||!r.sameParent(s))return!1;let l=r.node(-1);if(l.type!=i)return!1;if(r.parent.content.size==0&&r.node(-1).childCount==r.indexAfter(-1)){if(r.depth==3||r.node(-3).type!=i||r.index(-2)!=r.node(-2).childCount-1)return!1;if(n){let d=y.empty,f=r.index(-1)?1:r.index(-2)?2:3;for(let x=r.depth-f;x>=r.depth-3;x--)d=y.from(r.node(x).copy(d));let p=r.indexAfter(-1)<r.node(-2).childCount?1:r.indexAfter(-2)<r.node(-3).childCount?2:3;d=d.append(y.from(i.createAndFill()));let h=r.before(r.depth-(f-1)),m=t.tr.replace(h,r.after(-p),new b(d,4-f,0)),g=-1;m.doc.nodesBetween(h,m.doc.content.size,(x,O)=>{if(g>-1)return!1;x.isTextblock&&x.content.size==0&&(g=O+1)}),g>-1&&m.setSelection(S.near(m.doc.resolve(g))),n(m.scrollIntoView())}return!0}let a=s.pos==r.end()?l.contentMatchAt(0).defaultType:null,u=t.tr.delete(r.pos,s.pos),c=a?[null,{type:a}]:void 0;return Qe(u.doc,r.pos,2,c)?(n&&n(u.split(r.pos,2,c).scrollIntoView()),!0):!1}}function uu(i){return function(e,t){let{$from:n,$to:r}=e.selection,s=n.blockRange(r,o=>o.childCount>0&&o.firstChild.type==i);return s?t?n.node(s.depth-1).type==i?cu(e,t,i,s):du(e,t,s):!0:!1}}function cu(i,e,t,n){let r=i.tr,s=n.end,o=n.$to.end(n.depth);s<o&&(r.step(new R(s-1,o,s,o,new b(y.from(t.create(null,n.parent.copy())),1,0),1,!0)),n=new Ut(r.doc.resolve(n.$from.pos),r.doc.resolve(o),n.depth));const l=vt(n);if(l==null)return!1;r.lift(n,l);let a=r.mapping.map(s,-1)-1;return st(r.doc,a)&&r.join(a),e(r.scrollIntoView()),!0}function du(i,e,t){let n=i.tr,r=t.parent;for(let p=t.end,h=t.endIndex-1,m=t.startIndex;h>m;h--)p-=r.child(h).nodeSize,n.delete(p-1,p+1);let s=n.doc.resolve(t.start),o=s.nodeAfter;if(n.mapping.map(t.end)!=t.start+s.nodeAfter.nodeSize)return!1;let l=t.startIndex==0,a=t.endIndex==r.childCount,u=s.node(-1),c=s.index(-1);if(!u.canReplace(c+(l?0:1),c+1,o.content.append(a?y.empty:y.from(r))))return!1;let d=s.pos,f=d+o.nodeSize;return n.step(new R(d-(l?1:0),f+(a?1:0),d+1,f-1,new b((l?y.empty:y.from(r.copy(y.empty))).append(a?y.empty:y.from(r.copy(y.empty))),l?0:1,a?0:1),l?0:1)),e(n.scrollIntoView()),!0}function fu(i){return function(e,t){let{$from:n,$to:r}=e.selection,s=n.blockRange(r,u=>u.childCount>0&&u.firstChild.type==i);if(!s)return!1;let o=s.startIndex;if(o==0)return!1;let l=s.parent,a=l.child(o-1);if(a.type!=i)return!1;if(t){let u=a.lastChild&&a.lastChild.type==l.type,c=y.from(u?i.create():null),d=new b(y.from(i.create(null,y.from(l.type.create(null,c)))),u?3:1,0),f=s.start,p=s.end;t(e.tr.step(new R(f-(u?3:1),p,f,p,d,1,!0)).scrollIntoView())}return!0}}class _s{constructor(e,t,n){this.step=e,this.inverted=t,this.origin=n}}function hu(i,e,t){for(let r=i.length-1;r>=0;r--)t.step(i[r].inverted);for(let r=0;r<e.length;r++)t.step(e[r]);let n=[];for(let r=0,s=i.length;r<i.length;r++){let o=i[r].step.map(t.mapping.slice(s));s--,o&&!t.maybeStep(o).failed&&(t.mapping.setMirror(s,t.steps.length-1),n.push(new _s(o,o.invert(t.docs[t.docs.length-1]),i[r].origin)))}return n}class tn{constructor(e,t){this.version=e,this.unconfirmed=t}}function pu(i){let e=[];for(let t=0;t<i.steps.length;t++)e.push(new _s(i.steps[t],i.steps[t].invert(i.docs[t]),i));return e}const de=new ui("collab");function mu(i={}){let e={version:i.version||0,clientID:i.clientID==null?Math.floor(Math.random()*4294967295):i.clientID};return new le({key:de,state:{init:()=>new tn(e.version,[]),apply(t,n){let r=t.getMeta(de);return r||(t.docChanged?new tn(n.version,n.unconfirmed.concat(pu(t))):n)}},config:e,historyPreserveItems:!0})}function gu(i,e,t,n={}){let r=de.getState(i),s=r.version+e.length,o=de.get(i).spec.config.clientID,l=0;for(;l<t.length&&t[l]==o;)++l;let a=r.unconfirmed.slice(l);if(e=l?e.slice(l):e,!e.length)return i.tr.setMeta(de,new tn(s,a));let u=a.length,c=i.tr;if(u)a=hu(a,e,c);else{for(let f=0;f<e.length;f++)c.step(e[f]);a=[]}let d=new tn(s,a);return n&&n.mapSelectionBackward&&i.selection instanceof C&&(c.setSelection(C.between(c.doc.resolve(c.mapping.map(i.selection.anchor,-1)),c.doc.resolve(c.mapping.map(i.selection.head,-1)),-1)),c.updated&=-2),c.setMeta("rebased",u).setMeta("addToHistory",!1).setMeta(de,d)}function yu(i){let e=de.getState(i);return e.unconfirmed.length==0?null:{version:e.version,steps:e.unconfirmed.map(t=>t.step),clientID:de.get(i).spec.config.clientID,get origins(){return this._origins||(this._origins=e.unconfirmed.map(t=>t.origin))}}}function bu(i){return de.getState(i).version}var ve={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},nn={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"'},xu=typeof navigator<"u"&&/Mac/.test(navigator.platform),ku=typeof navigator<"u"&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent);for(var q=0;q<10;q++)ve[48+q]=ve[96+q]=String(q);for(var q=1;q<=24;q++)ve[q+111]="F"+q;for(var q=65;q<=90;q++)ve[q]=String.fromCharCode(q+32),nn[q]=String.fromCharCode(q);for(var vn in ve)nn.hasOwnProperty(vn)||(nn[vn]=ve[vn]);function Su(i){var e=xu&&i.metaKey&&i.shiftKey&&!i.ctrlKey&&!i.altKey||ku&&i.shiftKey&&i.key&&i.key.length==1||i.key=="Unidentified",t=!e&&i.key||(i.shiftKey?nn:ve)[i.keyCode]||i.key||"Unidentified";return t=="Esc"&&(t="Escape"),t=="Del"&&(t="Delete"),t=="Left"&&(t="ArrowLeft"),t=="Up"&&(t="ArrowUp"),t=="Right"&&(t="ArrowRight"),t=="Down"&&(t="ArrowDown"),t}const wu=typeof navigator<"u"?/Mac|iP(hone|[oa]d)/.test(navigator.platform):!1;function Cu(i){let e=i.split(/-(?!$)/),t=e[e.length-1];t=="Space"&&(t=" ");let n,r,s,o;for(let l=0;l<e.length-1;l++){let a=e[l];if(/^(cmd|meta|m)$/i.test(a))o=!0;else if(/^a(lt)?$/i.test(a))n=!0;else if(/^(c|ctrl|control)$/i.test(a))r=!0;else if(/^s(hift)?$/i.test(a))s=!0;else if(/^mod$/i.test(a))wu?o=!0:r=!0;else throw new Error("Unrecognized modifier name: "+a)}return n&&(t="Alt-"+t),r&&(t="Ctrl-"+t),o&&(t="Meta-"+t),s&&(t="Shift-"+t),t}function Mu(i){let e=Object.create(null);for(let t in i)e[Cu(t)]=i[t];return e}function Nn(i,e,t=!0){return e.altKey&&(i="Alt-"+i),e.ctrlKey&&(i="Ctrl-"+i),e.metaKey&&(i="Meta-"+i),t&&e.shiftKey&&(i="Shift-"+i),i}function Gn(i){return new le({props:{handleKeyDown:Js(i)}})}function Js(i){let e=Mu(i);return function(t,n){let r=Su(n),s,o=e[Nn(r,n)];if(o&&o(t.state,t.dispatch,t))return!0;if(r.length==1&&r!=" "){if(n.shiftKey){let l=e[Nn(r,n,!1)];if(l&&l(t.state,t.dispatch,t))return!0}if((n.shiftKey||n.altKey||n.metaKey||r.charCodeAt(0)>127)&&(s=ve[n.keyCode])&&s!=r){let l=e[Nn(s,n)];if(l&&l(t.state,t.dispatch,t))return!0}}return!1}}var rn=200,E=function(){};E.prototype.append=function(e){return e.length?(e=E.from(e),!this.length&&e||e.length<rn&&this.leafAppend(e)||this.length<rn&&e.leafPrepend(this)||this.appendInner(e)):this};E.prototype.prepend=function(e){return e.length?E.from(e).append(this):this};E.prototype.appendInner=function(e){return new Ou(this,e)};E.prototype.slice=function(e,t){return e===void 0&&(e=0),t===void 0&&(t=this.length),e>=t?E.empty:this.sliceInner(Math.max(0,e),Math.min(this.length,t))};E.prototype.get=function(e){if(!(e<0||e>=this.length))return this.getInner(e)};E.prototype.forEach=function(e,t,n){t===void 0&&(t=0),n===void 0&&(n=this.length),t<=n?this.forEachInner(e,t,n,0):this.forEachInvertedInner(e,t,n,0)};E.prototype.map=function(e,t,n){t===void 0&&(t=0),n===void 0&&(n=this.length);var r=[];return this.forEach(function(s,o){return r.push(e(s,o))},t,n),r};E.from=function(e){return e instanceof E?e:e&&e.length?new Hs(e):E.empty};var Hs=function(i){function e(n){i.call(this),this.values=n}i&&(e.__proto__=i),e.prototype=Object.create(i&&i.prototype),e.prototype.constructor=e;var t={length:{configurable:!0},depth:{configurable:!0}};return e.prototype.flatten=function(){return this.values},e.prototype.sliceInner=function(r,s){return r==0&&s==this.length?this:new e(this.values.slice(r,s))},e.prototype.getInner=function(r){return this.values[r]},e.prototype.forEachInner=function(r,s,o,l){for(var a=s;a<o;a++)if(r(this.values[a],l+a)===!1)return!1},e.prototype.forEachInvertedInner=function(r,s,o,l){for(var a=s-1;a>=o;a--)if(r(this.values[a],l+a)===!1)return!1},e.prototype.leafAppend=function(r){if(this.length+r.length<=rn)return new e(this.values.concat(r.flatten()))},e.prototype.leafPrepend=function(r){if(this.length+r.length<=rn)return new e(r.flatten().concat(this.values))},t.length.get=function(){return this.values.length},t.depth.get=function(){return 0},Object.defineProperties(e.prototype,t),e}(E);E.empty=new Hs([]);var Ou=function(i){function e(t,n){i.call(this),this.left=t,this.right=n,this.length=t.length+n.length,this.depth=Math.max(t.depth,n.depth)+1}return i&&(e.__proto__=i),e.prototype=Object.create(i&&i.prototype),e.prototype.constructor=e,e.prototype.flatten=function(){return this.left.flatten().concat(this.right.flatten())},e.prototype.getInner=function(n){return n<this.left.length?this.left.get(n):this.right.get(n-this.left.length)},e.prototype.forEachInner=function(n,r,s,o){var l=this.left.length;if(r<l&&this.left.forEachInner(n,r,Math.min(s,l),o)===!1||s>l&&this.right.forEachInner(n,Math.max(r-l,0),Math.min(this.length,s)-l,o+l)===!1)return!1},e.prototype.forEachInvertedInner=function(n,r,s,o){var l=this.left.length;if(r>l&&this.right.forEachInvertedInner(n,r-l,Math.max(s,l)-l,o+l)===!1||s<l&&this.left.forEachInvertedInner(n,Math.min(r,l),s,o)===!1)return!1},e.prototype.sliceInner=function(n,r){if(n==0&&r==this.length)return this;var s=this.left.length;return r<=s?this.left.slice(n,r):n>=s?this.right.slice(n-s,r-s):this.left.slice(n,s).append(this.right.slice(0,r-s))},e.prototype.leafAppend=function(n){var r=this.right.leafAppend(n);if(r)return new e(this.left,r)},e.prototype.leafPrepend=function(n){var r=this.left.leafPrepend(n);if(r)return new e(r,this.right)},e.prototype.appendInner=function(n){return this.left.depth>=Math.max(this.right.depth,n.depth)+1?new e(this.left,new e(this.right,n)):new e(this,n)},e}(E);const vu=500;class ee{constructor(e,t){this.items=e,this.eventCount=t}popEvent(e,t){if(this.eventCount==0)return null;let n=this.items.length;for(;;n--)if(this.items.get(n-1).selection){--n;break}let r,s;t&&(r=this.remapping(n,this.items.length),s=r.maps.length);let o=e.tr,l,a,u=[],c=[];return this.items.forEach((d,f)=>{if(!d.step){r||(r=this.remapping(n,f+1),s=r.maps.length),s--,c.push(d);return}if(r){c.push(new ie(d.map));let p=d.step.map(r.slice(s)),h;p&&o.maybeStep(p).doc&&(h=o.mapping.maps[o.mapping.maps.length-1],u.push(new ie(h,void 0,void 0,u.length+c.length))),s--,h&&r.appendMap(h,s)}else o.maybeStep(d.step);if(d.selection)return l=r?d.selection.map(r.slice(s)):d.selection,a=new ee(this.items.slice(0,n).append(c.reverse().concat(u)),this.eventCount-1),!1},this.items.length,0),{remaining:a,transform:o,selection:l}}addTransform(e,t,n,r){let s=[],o=this.eventCount,l=this.items,a=!r&&l.length?l.get(l.length-1):null;for(let c=0;c<e.steps.length;c++){let d=e.steps[c].invert(e.docs[c]),f=new ie(e.mapping.maps[c],d,t),p;(p=a&&a.merge(f))&&(f=p,c?s.pop():l=l.slice(0,l.length-1)),s.push(f),t&&(o++,t=void 0),r||(a=f)}let u=o-n.depth;return u>Du&&(l=Nu(l,u),o-=u),new ee(l.append(s),o)}remapping(e,t){let n=new Ge;return this.items.forEach((r,s)=>{let o=r.mirrorOffset!=null&&s-r.mirrorOffset>=e?n.maps.length-r.mirrorOffset:void 0;n.appendMap(r.map,o)},e,t),n}addMaps(e){return this.eventCount==0?this:new ee(this.items.append(e.map(t=>new ie(t))),this.eventCount)}rebased(e,t){if(!this.eventCount)return this;let n=[],r=Math.max(0,this.items.length-t),s=e.mapping,o=e.steps.length,l=this.eventCount;this.items.forEach(f=>{f.selection&&l--},r);let a=t;this.items.forEach(f=>{let p=s.getMirror(--a);if(p==null)return;o=Math.min(o,p);let h=s.maps[p];if(f.step){let m=e.steps[p].invert(e.docs[p]),g=f.selection&&f.selection.map(s.slice(a+1,p));g&&l++,n.push(new ie(h,m,g))}else n.push(new ie(h))},r);let u=[];for(let f=t;f<o;f++)u.push(new ie(s.maps[f]));let c=this.items.slice(0,r).append(u).append(n),d=new ee(c,l);return d.emptyItemCount()>vu&&(d=d.compress(this.items.length-n.length)),d}emptyItemCount(){let e=0;return this.items.forEach(t=>{t.step||e++}),e}compress(e=this.items.length){let t=this.remapping(0,e),n=t.maps.length,r=[],s=0;return this.items.forEach((o,l)=>{if(l>=e)r.push(o),o.selection&&s++;else if(o.step){let a=o.step.map(t.slice(n)),u=a&&a.getMap();if(n--,u&&t.appendMap(u,n),a){let c=o.selection&&o.selection.map(t.slice(n));c&&s++;let d=new ie(u.invert(),a,c),f,p=r.length-1;(f=r.length&&r[p].merge(d))?r[p]=f:r.push(d)}}else o.map&&n--},this.items.length,0),new ee(E.from(r.reverse()),s)}}ee.empty=new ee(E.empty,0);function Nu(i,e){let t;return i.forEach((n,r)=>{if(n.selection&&e--==0)return t=r,!1}),i.slice(t)}class ie{constructor(e,t,n,r){this.map=e,this.step=t,this.selection=n,this.mirrorOffset=r}merge(e){if(this.step&&e.step&&!e.selection){let t=e.step.merge(this.step);if(t)return new ie(t.getMap().invert(),t,this.selection)}}}class ye{constructor(e,t,n,r,s){this.done=e,this.undone=t,this.prevRanges=n,this.prevTime=r,this.prevComposition=s}}const Du=20;function Eu(i,e,t,n){let r=t.getMeta(Ve),s;if(r)return r.historyState;t.getMeta(Iu)&&(i=new ye(i.done,i.undone,null,0,-1));let o=t.getMeta("appendedTransaction");if(t.steps.length==0)return i;if(o&&o.getMeta(Ve))return o.getMeta(Ve).redo?new ye(i.done.addTransform(t,void 0,n,Wt(e)),i.undone,kr(t.mapping.maps),i.prevTime,i.prevComposition):new ye(i.done,i.undone.addTransform(t,void 0,n,Wt(e)),null,i.prevTime,i.prevComposition);if(t.getMeta("addToHistory")!==!1&&!(o&&o.getMeta("addToHistory")===!1)){let l=t.getMeta("composition"),a=i.prevTime==0||!o&&i.prevComposition!=l&&(i.prevTime<(t.time||0)-n.newGroupDelay||!Tu(t,i.prevRanges)),u=o?Dn(i.prevRanges,t.mapping):kr(t.mapping.maps);return new ye(i.done.addTransform(t,a?e.selection.getBookmark():void 0,n,Wt(e)),ee.empty,u,t.time,l??i.prevComposition)}else return(s=t.getMeta("rebased"))?new ye(i.done.rebased(t,s),i.undone.rebased(t,s),Dn(i.prevRanges,t.mapping),i.prevTime,i.prevComposition):new ye(i.done.addMaps(t.mapping.maps),i.undone.addMaps(t.mapping.maps),Dn(i.prevRanges,t.mapping),i.prevTime,i.prevComposition)}function Tu(i,e){if(!e)return!1;if(!i.docChanged)return!0;let t=!1;return i.mapping.maps[0].forEach((n,r)=>{for(let s=0;s<e.length;s+=2)n<=e[s+1]&&r>=e[s]&&(t=!0)}),t}function kr(i){let e=[];for(let t=i.length-1;t>=0&&e.length==0;t--)i[t].forEach((n,r,s,o)=>e.push(s,o));return e}function Dn(i,e){if(!i)return null;let t=[];for(let n=0;n<i.length;n+=2){let r=e.map(i[n],1),s=e.map(i[n+1],-1);r<=s&&t.push(r,s)}return t}function Au(i,e,t){let n=Wt(e),r=Ve.get(e).spec.config,s=(t?i.undone:i.done).popEvent(e,n);if(!s)return null;let o=s.selection.resolve(s.transform.doc),l=(t?i.done:i.undone).addTransform(s.transform,e.selection.getBookmark(),r,n),a=new ye(t?l:s.remaining,t?s.remaining:l,null,0,-1);return s.transform.setSelection(o).setMeta(Ve,{redo:t,historyState:a})}let En=!1,Sr=null;function Wt(i){let e=i.plugins;if(Sr!=e){En=!1,Sr=e;for(let t=0;t<e.length;t++)if(e[t].spec.historyPreserveItems){En=!0;break}}return En}const Ve=new ui("history"),Iu=new ui("closeHistory");function qu(i={}){return i={depth:i.depth||100,newGroupDelay:i.newGroupDelay||500},new le({key:Ve,state:{init(){return new ye(ee.empty,ee.empty,null,0,-1)},apply(e,t,n){return Eu(t,n,e,i)}},config:i,props:{handleDOMEvents:{beforeinput(e,t){let n=t.inputType,r=n=="historyUndo"?sn:n=="historyRedo"?Ct:null;return r?(t.preventDefault(),r(e.state,e.dispatch)):!1}}}})}function $s(i,e){return(t,n)=>{let r=Ve.getState(t);if(!r||(i?r.undone:r.done).eventCount==0)return!1;if(n){let s=Au(r,t,i);s&&n(e?s.scrollIntoView():s)}return!0}}const sn=$s(!1,!0),Ct=$s(!0,!0),Ks=(i,e)=>i.selection.empty?!1:(e&&e(i.tr.deleteSelection().scrollIntoView()),!0);function Ru(i,e){let{$cursor:t}=i.selection;return!t||(e?!e.endOfTextblock("backward",i):t.parentOffset>0)?null:t}const Pu=(i,e,t)=>{let n=Ru(i,t);if(!n)return!1;let r=Us(n);if(!r){let o=n.blockRange(),l=o&&vt(o);return l==null?!1:(e&&e(i.tr.lift(o,l).scrollIntoView()),!0)}let s=r.nodeBefore;if(Qs(i,r,e,-1))return!0;if(n.parent.content.size==0&&(it(s,"end")||k.isSelectable(s)))for(let o=n.depth;;o--){let l=li(i.doc,n.before(o),n.after(o),b.empty);if(l&&l.slice.size<l.to-l.from){if(e){let a=i.tr.step(l);a.setSelection(it(s,"end")?S.findFrom(a.doc.resolve(a.mapping.map(r.pos,-1)),-1):k.create(a.doc,r.pos-s.nodeSize)),e(a.scrollIntoView())}return!0}if(o==1||n.node(o-1).childCount>1)break}return s.isAtom&&r.depth==n.depth-1?(e&&e(i.tr.delete(r.pos-s.nodeSize,r.pos).scrollIntoView()),!0):!1};function it(i,e,t=!1){for(let n=i;n;n=e=="start"?n.firstChild:n.lastChild){if(n.isTextblock)return!0;if(t&&n.childCount!=1)return!1}return!1}const zu=(i,e,t)=>{let{$head:n,empty:r}=i.selection,s=n;if(!r)return!1;if(n.parent.isTextblock){if(t?!t.endOfTextblock("backward",i):n.parentOffset>0)return!1;s=Us(n)}let o=s&&s.nodeBefore;return!o||!k.isSelectable(o)?!1:(e&&e(i.tr.setSelection(k.create(i.doc,s.pos-o.nodeSize)).scrollIntoView()),!0)};function Us(i){if(!i.parent.type.spec.isolating)for(let e=i.depth-1;e>=0;e--){if(i.index(e)>0)return i.doc.resolve(i.before(e+1));if(i.node(e).type.spec.isolating)break}return null}function Bu(i,e){let{$cursor:t}=i.selection;return!t||(e?!e.endOfTextblock("forward",i):t.parentOffset<t.parent.content.size)?null:t}const Vu=(i,e,t)=>{let n=Bu(i,t);if(!n)return!1;let r=js(n);if(!r)return!1;let s=r.nodeAfter;if(Qs(i,r,e,1))return!0;if(n.parent.content.size==0&&(it(s,"start")||k.isSelectable(s))){let o=li(i.doc,n.before(),n.after(),b.empty);if(o&&o.slice.size<o.to-o.from){if(e){let l=i.tr.step(o);l.setSelection(it(s,"start")?S.findFrom(l.doc.resolve(l.mapping.map(r.pos)),1):k.create(l.doc,l.mapping.map(r.pos))),e(l.scrollIntoView())}return!0}}return s.isAtom&&r.depth==n.depth-1?(e&&e(i.tr.delete(r.pos,r.pos+s.nodeSize).scrollIntoView()),!0):!1},Fu=(i,e,t)=>{let{$head:n,empty:r}=i.selection,s=n;if(!r)return!1;if(n.parent.isTextblock){if(t?!t.endOfTextblock("forward",i):n.parentOffset<n.parent.content.size)return!1;s=js(n)}let o=s&&s.nodeAfter;return!o||!k.isSelectable(o)?!1:(e&&e(i.tr.setSelection(k.create(i.doc,s.pos)).scrollIntoView()),!0)};function js(i){if(!i.parent.type.spec.isolating)for(let e=i.depth-1;e>=0;e--){let t=i.node(e);if(i.index(e)+1<t.childCount)return i.doc.resolve(i.after(e+1));if(t.type.spec.isolating)break}return null}const Qn=(i,e)=>{let t=i.selection,n=t instanceof k,r;if(n){if(t.node.isTextblock||!st(i.doc,t.from))return!1;r=t.from}else if(r=Zr(i.doc,t.from,-1),r==null)return!1;if(e){let s=i.tr.join(r);n&&s.setSelection(k.create(s.doc,r-i.doc.resolve(r).nodeBefore.nodeSize)),e(s.scrollIntoView())}return!0},Lu=(i,e)=>{let t=i.selection,n;if(t instanceof k){if(t.node.isTextblock||!st(i.doc,t.to))return!1;n=t.to}else if(n=Zr(i.doc,t.to,1),n==null)return!1;return e&&e(i.tr.join(n).scrollIntoView()),!0},Yn=(i,e)=>{let{$from:t,$to:n}=i.selection,r=t.blockRange(n),s=r&&vt(r);return s==null?!1:(e&&e(i.tr.lift(r,s).scrollIntoView()),!0)},Wu=(i,e)=>{let{$head:t,$anchor:n}=i.selection;return!t.parent.type.spec.code||!t.sameParent(n)?!1:(e&&e(i.tr.insertText(`
`).scrollIntoView()),!0)};function bi(i){for(let e=0;e<i.edgeCount;e++){let{type:t}=i.edge(e);if(t.isTextblock&&!t.hasRequiredAttrs())return t}return null}const Gs=(i,e)=>{let{$head:t,$anchor:n}=i.selection;if(!t.parent.type.spec.code||!t.sameParent(n))return!1;let r=t.node(-1),s=t.indexAfter(-1),o=bi(r.contentMatchAt(s));if(!o||!r.canReplaceWith(s,s,o))return!1;if(e){let l=t.after(),a=i.tr.replaceWith(l,l,o.createAndFill());a.setSelection(S.near(a.doc.resolve(l),1)),e(a.scrollIntoView())}return!0},_u=(i,e)=>{let t=i.selection,{$from:n,$to:r}=t;if(t instanceof U||n.parent.inlineContent||r.parent.inlineContent)return!1;let s=bi(r.parent.contentMatchAt(r.indexAfter()));if(!s||!s.isTextblock)return!1;if(e){let o=(!n.parentOffset&&r.index()<r.parent.childCount?n:r).pos,l=i.tr.insert(o,s.createAndFill());l.setSelection(C.create(l.doc,o+1)),e(l.scrollIntoView())}return!0},Ju=(i,e)=>{let{$cursor:t}=i.selection;if(!t||t.parent.content.size)return!1;if(t.depth>1&&t.after()!=t.end(-1)){let s=t.before();if(Qe(i.doc,s))return e&&e(i.tr.split(s).scrollIntoView()),!0}let n=t.blockRange(),r=n&&vt(n);return r==null?!1:(e&&e(i.tr.lift(n,r).scrollIntoView()),!0)};function Hu(i){return(e,t)=>{let{$from:n,$to:r}=e.selection;if(e.selection instanceof k&&e.selection.node.isBlock)return!n.parentOffset||!Qe(e.doc,n.pos)?!1:(t&&t(e.tr.split(n.pos).scrollIntoView()),!0);if(!n.parent.isBlock)return!1;if(t){let s=r.parentOffset==r.parent.content.size,o=e.tr;(e.selection instanceof C||e.selection instanceof U)&&o.deleteSelection();let l=n.depth==0?null:bi(n.node(-1).contentMatchAt(n.indexAfter(-1))),a=s&&l?[{type:l}]:void 0,u=Qe(o.doc,o.mapping.map(n.pos),1,a);if(!a&&!u&&Qe(o.doc,o.mapping.map(n.pos),1,l?[{type:l}]:void 0)&&(l&&(a=[{type:l}]),u=!0),u&&(o.split(o.mapping.map(n.pos),1,a),!s&&!n.parentOffset&&n.parent.type!=l)){let c=o.mapping.map(n.before()),d=o.doc.resolve(c);l&&n.node(-1).canReplaceWith(d.index(),d.index()+1,l)&&o.setNodeMarkup(o.mapping.map(n.before()),l)}t(o.scrollIntoView())}return!0}}const $u=Hu(),Xn=(i,e)=>{let{$from:t,to:n}=i.selection,r,s=t.sharedDepth(n);return s==0?!1:(r=t.before(s),e&&e(i.tr.setSelection(k.create(i.doc,r))),!0)},Ku=(i,e)=>(e&&e(i.tr.setSelection(new U(i.doc))),!0);function Uu(i,e,t){let n=e.nodeBefore,r=e.nodeAfter,s=e.index();return!n||!r||!n.type.compatibleContent(r.type)?!1:!n.content.size&&e.parent.canReplace(s-1,s)?(t&&t(i.tr.delete(e.pos-n.nodeSize,e.pos).scrollIntoView()),!0):!e.parent.canReplace(s,s+1)||!(r.isTextblock||st(i.doc,e.pos))?!1:(t&&t(i.tr.clearIncompatible(e.pos,n.type,n.contentMatchAt(n.childCount)).join(e.pos).scrollIntoView()),!0)}function Qs(i,e,t,n){let r=e.nodeBefore,s=e.nodeAfter,o,l,a=r.type.spec.isolating||s.type.spec.isolating;if(!a&&Uu(i,e,t))return!0;let u=!a&&e.parent.canReplace(e.index(),e.index()+1);if(u&&(o=(l=r.contentMatchAt(r.childCount)).findWrapping(s.type))&&l.matchType(o[0]||s.type).validEnd){if(t){let p=e.pos+s.nodeSize,h=y.empty;for(let x=o.length-1;x>=0;x--)h=y.from(o[x].create(null,h));h=y.from(r.copy(h));let m=i.tr.step(new R(e.pos-1,p,e.pos,p,new b(h,1,0),o.length,!0)),g=p+2*o.length;st(m.doc,g)&&m.join(g),t(m.scrollIntoView())}return!0}let c=s.type.spec.isolating||n>0&&a?null:S.findFrom(e,1),d=c&&c.$from.blockRange(c.$to),f=d&&vt(d);if(f!=null&&f>=e.depth)return t&&t(i.tr.lift(d,f).scrollIntoView()),!0;if(u&&it(s,"start",!0)&&it(r,"end")){let p=r,h=[];for(;h.push(p),!p.isTextblock;)p=p.lastChild;let m=s,g=1;for(;!m.isTextblock;m=m.firstChild)g++;if(p.canReplace(p.childCount,p.childCount,m.content)){if(t){let x=y.empty;for(let W=h.length-1;W>=0;W--)x=y.from(h[W].copy(x));let O=i.tr.step(new R(e.pos-h.length,e.pos+s.nodeSize,e.pos+g,e.pos+s.nodeSize-g,new b(x,h.length,0),0,!0));t(O.scrollIntoView())}return!0}}return!1}function Ys(i){return function(e,t){let n=e.selection,r=i<0?n.$from:n.$to,s=r.depth;for(;r.node(s).isInline;){if(!s)return!1;s--}return r.node(s).isTextblock?(t&&t(e.tr.setSelection(C.create(e.doc,i<0?r.start(s):r.end(s)))),!0):!1}}const ju=Ys(-1),Gu=Ys(1);function Zn(i,e=null){return function(t,n){let{$from:r,$to:s}=t.selection,o=r.blockRange(s),l=o&&oi(o,i,e);return l?(n&&n(t.tr.wrap(o,l).scrollIntoView()),!0):!1}}function _t(i,e=null){return function(t,n){let r=!1;for(let s=0;s<t.selection.ranges.length&&!r;s++){let{$from:{pos:o},$to:{pos:l}}=t.selection.ranges[s];t.doc.nodesBetween(o,l,(a,u)=>{if(r)return!1;if(!(!a.isTextblock||a.hasMarkup(i,e)))if(a.type==i)r=!0;else{let c=t.doc.resolve(u),d=c.index();r=c.parent.canReplaceWith(d,d+1,i)}})}if(!r)return!1;if(n){let s=t.tr;for(let o=0;o<t.selection.ranges.length;o++){let{$from:{pos:l},$to:{pos:a}}=t.selection.ranges[o];s.setBlockType(l,a,i,e)}n(s.scrollIntoView())}return!0}}function Qu(i,e,t,n){for(let r=0;r<e.length;r++){let{$from:s,$to:o}=e[r],l=s.depth==0?i.inlineContent&&i.type.allowsMarkType(t):!1;if(i.nodesBetween(s.pos,o.pos,(a,u)=>{if(l||!n)return!1;l=a.inlineContent&&a.type.allowsMarkType(t)}),l)return!0}return!1}function xe(i,e=null,t){let n=t!==!1;return function(r,s){let{empty:o,$cursor:l,ranges:a}=r.selection;if(o&&!l||!Qu(r.doc,a,i,n))return!1;if(s)if(l)i.isInSet(r.storedMarks||l.marks())?s(r.tr.removeStoredMark(i)):s(r.tr.addStoredMark(i.create(e)));else{let u,c=r.tr;u=!a.some(d=>r.doc.rangeHasMark(d.$from.pos,d.$to.pos,i));for(let d=0;d<a.length;d++){let{$from:f,$to:p}=a[d];if(!u)c.removeMark(f.pos,p.pos,i);else{let h=f.pos,m=p.pos,g=f.nodeAfter,x=p.nodeBefore,O=g&&g.isText?/^\s*/.exec(g.text)[0].length:0,W=x&&x.isText?/\s*$/.exec(x.text)[0].length:0;h+O<m&&(h+=O,m-=W),c.addMark(h,m,i.create(e))}}s(c.scrollIntoView())}return!0}}function dn(...i){return function(e,t,n){for(let r=0;r<i.length;r++)if(i[r](e,t,n))return!0;return!1}}let Tn=dn(Ks,Pu,zu),wr=dn(Ks,Vu,Fu);const ce={Enter:dn(Wu,_u,Ju,$u),"Mod-Enter":Gs,Backspace:Tn,"Mod-Backspace":Tn,"Shift-Backspace":Tn,Delete:wr,"Mod-Delete":wr,"Mod-a":Ku},Xs={"Ctrl-h":ce.Backspace,"Alt-Backspace":ce["Mod-Backspace"],"Ctrl-d":ce.Delete,"Ctrl-Alt-Backspace":ce["Mod-Delete"],"Alt-Delete":ce["Mod-Delete"],"Alt-d":ce["Mod-Delete"],"Ctrl-a":ju,"Ctrl-e":Gu};for(let i in ce)Xs[i]=ce[i];const Yu=typeof navigator<"u"?/Mac|iP(hone|[oa]d)/.test(navigator.platform):typeof os<"u"&&os.platform?os.platform()=="darwin":!1,Xu=Yu?Xs:ce;function Zu(i={}){return new le({view(e){return new ec(e,i)}})}class ec{constructor(e,t){var n;this.editorView=e,this.cursorPos=null,this.element=null,this.timeout=-1,this.width=(n=t.width)!==null&&n!==void 0?n:1,this.color=t.color===!1?void 0:t.color||"black",this.class=t.class,this.handlers=["dragover","dragend","drop","dragleave"].map(r=>{let s=o=>{this[r](o)};return e.dom.addEventListener(r,s),{name:r,handler:s}})}destroy(){this.handlers.forEach(({name:e,handler:t})=>this.editorView.dom.removeEventListener(e,t))}update(e,t){this.cursorPos!=null&&t.doc!=e.state.doc&&(this.cursorPos>e.state.doc.content.size?this.setCursor(null):this.updateOverlay())}setCursor(e){e!=this.cursorPos&&(this.cursorPos=e,e==null?(this.element.parentNode.removeChild(this.element),this.element=null):this.updateOverlay())}updateOverlay(){let e=this.editorView.state.doc.resolve(this.cursorPos),t=!e.parent.inlineContent,n;if(t){let l=e.nodeBefore,a=e.nodeAfter;if(l||a){let u=this.editorView.nodeDOM(this.cursorPos-(l?l.nodeSize:0));if(u){let c=u.getBoundingClientRect(),d=l?c.bottom:c.top;l&&a&&(d=(d+this.editorView.nodeDOM(this.cursorPos).getBoundingClientRect().top)/2),n={left:c.left,right:c.right,top:d-this.width/2,bottom:d+this.width/2}}}}if(!n){let l=this.editorView.coordsAtPos(this.cursorPos);n={left:l.left-this.width/2,right:l.left+this.width/2,top:l.top,bottom:l.bottom}}let r=this.editorView.dom.offsetParent;this.element||(this.element=r.appendChild(document.createElement("div")),this.class&&(this.element.className=this.class),this.element.style.cssText="position: absolute; z-index: 50; pointer-events: none;",this.color&&(this.element.style.backgroundColor=this.color)),this.element.classList.toggle("prosemirror-dropcursor-block",t),this.element.classList.toggle("prosemirror-dropcursor-inline",!t);let s,o;if(!r||r==document.body&&getComputedStyle(r).position=="static")s=-pageXOffset,o=-pageYOffset;else{let l=r.getBoundingClientRect();s=l.left-r.scrollLeft,o=l.top-r.scrollTop}this.element.style.left=n.left-s+"px",this.element.style.top=n.top-o+"px",this.element.style.width=n.right-n.left+"px",this.element.style.height=n.bottom-n.top+"px"}scheduleRemoval(e){clearTimeout(this.timeout),this.timeout=setTimeout(()=>this.setCursor(null),e)}dragover(e){if(!this.editorView.editable)return;let t=this.editorView.posAtCoords({left:e.clientX,top:e.clientY}),n=t&&t.inside>=0&&this.editorView.state.doc.nodeAt(t.inside),r=n&&n.type.spec.disableDropCursor,s=typeof r=="function"?r(this.editorView,t,e):r;if(t&&!s){let o=t.pos;if(this.editorView.dragging&&this.editorView.dragging.slice){let l=es(this.editorView.state.doc,o,this.editorView.dragging.slice);l!=null&&(o=l)}this.setCursor(o),this.scheduleRemoval(5e3)}}dragend(){this.scheduleRemoval(20)}drop(){this.scheduleRemoval(20)}dragleave(e){(e.target==this.editorView.dom||!this.editorView.dom.contains(e.relatedTarget))&&this.setCursor(null)}}class N extends S{constructor(e){super(e,e)}map(e,t){let n=e.resolve(t.map(this.head));return N.valid(n)?new N(n):S.near(n)}content(){return b.empty}eq(e){return e instanceof N&&e.head==this.head}toJSON(){return{type:"gapcursor",pos:this.head}}static fromJSON(e,t){if(typeof t.pos!="number")throw new RangeError("Invalid input for GapCursor.fromJSON");return new N(e.resolve(t.pos))}getBookmark(){return new xi(this.anchor)}static valid(e){let t=e.parent;if(t.isTextblock||!tc(e)||!nc(e))return!1;let n=t.type.spec.allowGapCursor;if(n!=null)return n;let r=t.contentMatchAt(e.index()).defaultType;return r&&r.isTextblock}static findGapCursorFrom(e,t,n=!1){e:for(;;){if(!n&&N.valid(e))return e;let r=e.pos,s=null;for(let o=e.depth;;o--){let l=e.node(o);if(t>0?e.indexAfter(o)<l.childCount:e.index(o)>0){s=l.child(t>0?e.indexAfter(o):e.index(o)-1);break}else if(o==0)return null;r+=t;let a=e.doc.resolve(r);if(N.valid(a))return a}for(;;){let o=t>0?s.firstChild:s.lastChild;if(!o){if(s.isAtom&&!s.isText&&!k.isSelectable(s)){e=e.doc.resolve(r+s.nodeSize*t),n=!1;continue e}break}s=o,r+=t;let l=e.doc.resolve(r);if(N.valid(l))return l}return null}}}N.prototype.visible=!1;N.findFrom=N.findGapCursorFrom;S.jsonID("gapcursor",N);class xi{constructor(e){this.pos=e}map(e){return new xi(e.map(this.pos))}resolve(e){let t=e.resolve(this.pos);return N.valid(t)?new N(t):S.near(t)}}function tc(i){for(let e=i.depth;e>=0;e--){let t=i.index(e),n=i.node(e);if(t==0){if(n.type.spec.isolating)return!0;continue}for(let r=n.child(t-1);;r=r.lastChild){if(r.childCount==0&&!r.inlineContent||r.isAtom||r.type.spec.isolating)return!0;if(r.inlineContent)return!1}}return!0}function nc(i){for(let e=i.depth;e>=0;e--){let t=i.indexAfter(e),n=i.node(e);if(t==n.childCount){if(n.type.spec.isolating)return!0;continue}for(let r=n.child(t);;r=r.firstChild){if(r.childCount==0&&!r.inlineContent||r.isAtom||r.type.spec.isolating)return!0;if(r.inlineContent)return!1}}return!0}function ic(){return new le({props:{decorations:lc,createSelectionBetween(i,e,t){return e.pos==t.pos&&N.valid(t)?new N(t):null},handleClick:sc,handleKeyDown:rc,handleDOMEvents:{beforeinput:oc}}})}const rc=Js({ArrowLeft:Pt("horiz",-1),ArrowRight:Pt("horiz",1),ArrowUp:Pt("vert",-1),ArrowDown:Pt("vert",1)});function Pt(i,e){const t=i=="vert"?e>0?"down":"up":e>0?"right":"left";return function(n,r,s){let o=n.selection,l=e>0?o.$to:o.$from,a=o.empty;if(o instanceof C){if(!s.endOfTextblock(t)||l.depth==0)return!1;a=!1,l=n.doc.resolve(e>0?l.after():l.before())}let u=N.findGapCursorFrom(l,e,a);return u?(r&&r(n.tr.setSelection(new N(u))),!0):!1}}function sc(i,e,t){if(!i||!i.editable)return!1;let n=i.state.doc.resolve(e);if(!N.valid(n))return!1;let r=i.posAtCoords({left:t.clientX,top:t.clientY});return r&&r.inside>-1&&k.isSelectable(i.state.doc.nodeAt(r.inside))?!1:(i.dispatch(i.state.tr.setSelection(new N(n))),!0)}function oc(i,e){if(e.inputType!="insertCompositionText"||!(i.state.selection instanceof N))return!1;let{$from:t}=i.state.selection,n=t.parent.contentMatchAt(t.index()).findWrapping(i.state.schema.nodes.text);if(!n)return!1;let r=y.empty;for(let o=n.length-1;o>=0;o--)r=y.from(n[o].createAndFill(null,r));let s=i.state.tr.replace(t.pos,t.pos,new b(r,0,0));return s.setSelection(C.near(s.doc.resolve(t.pos+1))),i.dispatch(s),!1}function lc(i){if(!(i.selection instanceof N))return null;let e=document.createElement("div");return e.className="ProseMirror-gapcursor",v.create(i.doc,[J.widget(i.selection.head,e,{key:"gapcursor"})])}function j(){var i=arguments[0];typeof i=="string"&&(i=document.createElement(i));var e=1,t=arguments[1];if(t&&typeof t=="object"&&t.nodeType==null&&!Array.isArray(t)){for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)){var r=t[n];typeof r=="string"?i.setAttribute(n,r):r!=null&&(i[n]=r)}e++}for(;e<arguments.length;e++)Zs(i,arguments[e]);return i}function Zs(i,e){if(typeof e=="string")i.appendChild(document.createTextNode(e));else if(e!=null)if(e.nodeType!=null)i.appendChild(e);else if(Array.isArray(e))for(var t=0;t<e.length;t++)Zs(i,e[t]);else throw new RangeError("Unsupported child node: "+e)}const pt="http://www.w3.org/2000/svg",ac="http://www.w3.org/1999/xlink",ei="ProseMirror-icon";function uc(i){let e=0;for(let t=0;t<i.length;t++)e=(e<<5)-e+i.charCodeAt(t)|0;return e}function cc(i,e){let t=(i.nodeType==9?i:i.ownerDocument)||document,n=t.createElement("div");if(n.className=ei,e.path){let{path:r,width:s,height:o}=e,l="pm-icon-"+uc(r).toString(16);t.getElementById(l)||dc(i,l,e);let a=n.appendChild(t.createElementNS(pt,"svg"));a.style.width=s/o+"em",a.appendChild(t.createElementNS(pt,"use")).setAttributeNS(ac,"href",/([^#]*)/.exec(t.location.toString())[1]+"#"+l)}else if(e.dom)n.appendChild(e.dom.cloneNode(!0));else{let{text:r,css:s}=e;n.appendChild(t.createElement("span")).textContent=r||"",s&&(n.firstChild.style.cssText=s)}return n}function dc(i,e,t){let[n,r]=i.nodeType==9?[i,i.body]:[i.ownerDocument||document,i],s=n.getElementById(ei+"-collection");s||(s=n.createElementNS(pt,"svg"),s.id=ei+"-collection",s.style.display="none",r.insertBefore(s,r.firstChild));let o=n.createElementNS(pt,"symbol");o.id=e,o.setAttribute("viewBox","0 0 "+t.width+" "+t.height),o.appendChild(n.createElementNS(pt,"path")).setAttribute("d",t.path),s.appendChild(o)}const _="ProseMirror-menu";class ne{constructor(e){this.spec=e}render(e){let t=this.spec,n=t.render?t.render(e):t.icon?cc(e.root,t.icon):t.label?j("div",null,Mt(e,t.label)):null;if(!n)throw new RangeError("MenuItem without icon or label property");if(t.title){const s=typeof t.title=="function"?t.title(e.state):t.title;n.setAttribute("title",Mt(e,s))}t.class&&n.classList.add(t.class),t.css&&(n.style.cssText+=t.css),n.addEventListener("mousedown",s=>{s.preventDefault(),n.classList.contains(_+"-disabled")||t.run(e.state,e.dispatch,e,s)});function r(s){if(t.select){let l=t.select(s);if(n.style.display=l?"":"none",!l)return!1}let o=!0;if(t.enable&&(o=t.enable(s)||!1,ti(n,_+"-disabled",!o)),t.active){let l=o&&t.active(s)||!1;ti(n,_+"-active",l)}return!0}return{dom:n,update:r}}}function Mt(i,e){return i._props.translate?i._props.translate(e):e}let mt={time:0,node:null};function eo(i){mt.time=Date.now(),mt.node=i.target}function to(i){return Date.now()-100<mt.time&&mt.node&&i.contains(mt.node)}class Cr{constructor(e,t={}){this.options=t,this.options=t||{},this.content=Array.isArray(e)?e:[e]}render(e){let t=no(this.content,e),n=e.dom.ownerDocument.defaultView||window,r=j("div",{class:_+"-dropdown "+(this.options.class||""),style:this.options.css},Mt(e,this.options.label||""));this.options.title&&r.setAttribute("title",Mt(e,this.options.title));let s=j("div",{class:_+"-dropdown-wrap"},r),o=null,l=null,a=()=>{o&&o.close()&&(o=null,n.removeEventListener("mousedown",l))};r.addEventListener("mousedown",c=>{c.preventDefault(),eo(c),o?a():(o=this.expand(s,t.dom),n.addEventListener("mousedown",l=()=>{to(s)||a()}))});function u(c){let d=t.update(c);return s.style.display=d?"":"none",d}return{dom:s,update:u}}expand(e,t){let n=j("div",{class:_+"-dropdown-menu "+(this.options.class||"")},t),r=!1;function s(){return r?!1:(r=!0,e.removeChild(n),!0)}return e.appendChild(n),{close:s,node:n}}}function no(i,e){let t=[],n=[];for(let r=0;r<i.length;r++){let{dom:s,update:o}=i[r].render(e);t.push(j("div",{class:_+"-dropdown-item"},s)),n.push(o)}return{dom:t,update:io(n,t)}}function io(i,e){return t=>{let n=!1;for(let r=0;r<i.length;r++){let s=i[r](t);e[r].style.display=s?"":"none",s&&(n=!0)}return n}}class fc{constructor(e,t={}){this.options=t,this.content=Array.isArray(e)?e:[e]}render(e){let t=no(this.content,e),n=e.dom.ownerDocument.defaultView||window,r=j("div",{class:_+"-submenu-label"},Mt(e,this.options.label||"")),s=j("div",{class:_+"-submenu-wrap"},r,j("div",{class:_+"-submenu"},t.dom)),o=null;r.addEventListener("mousedown",a=>{a.preventDefault(),eo(a),ti(s,_+"-submenu-wrap-active",!1),o||n.addEventListener("mousedown",o=()=>{to(s)||(s.classList.remove(_+"-submenu-wrap-active"),n.removeEventListener("mousedown",o),o=null)})});function l(a){let u=t.update(a);return s.style.display=u?"":"none",u}return{dom:s,update:l}}}function hc(i,e){let t=document.createDocumentFragment(),n=[],r=[];for(let o=0;o<e.length;o++){let l=e[o],a=[],u=[];for(let c=0;c<l.length;c++){let{dom:d,update:f}=l[c].render(i),p=j("span",{class:_+"item"},d);t.appendChild(p),u.push(p),a.push(f)}a.length&&(n.push(io(a,u)),o<e.length-1&&r.push(t.appendChild(pc())))}function s(o){let l=!1,a=!1;for(let u=0;u<n.length;u++){let c=n[u](o);u&&(r[u-1].style.display=a&&c?"":"none"),a=c,c&&(l=!0)}return l}return{dom:t,update:s}}function pc(){return j("span",{class:_+"separator"})}const Q={join:{width:800,height:900,path:"M0 75h800v125h-800z M0 825h800v-125h-800z M250 400h100v-100h100v100h100v100h-100v100h-100v-100h-100z"},lift:{width:1024,height:1024,path:"M219 310v329q0 7-5 12t-12 5q-8 0-13-5l-164-164q-5-5-5-13t5-13l164-164q5-5 13-5 7 0 12 5t5 12zM1024 749v109q0 7-5 12t-12 5h-987q-7 0-12-5t-5-12v-109q0-7 5-12t12-5h987q7 0 12 5t5 12zM1024 530v109q0 7-5 12t-12 5h-621q-7 0-12-5t-5-12v-109q0-7 5-12t12-5h621q7 0 12 5t5 12zM1024 310v109q0 7-5 12t-12 5h-621q-7 0-12-5t-5-12v-109q0-7 5-12t12-5h621q7 0 12 5t5 12zM1024 91v109q0 7-5 12t-12 5h-987q-7 0-12-5t-5-12v-109q0-7 5-12t12-5h987q7 0 12 5t5 12z"},selectParentNode:{text:"",css:"font-weight: bold"},undo:{width:1024,height:1024,path:"M761 1024c113-206 132-520-313-509v253l-384-384 384-384v248c534-13 594 472 313 775z"},redo:{width:1024,height:1024,path:"M576 248v-248l384 384-384 384v-253c-446-10-427 303-313 509-280-303-221-789 313-775z"},strong:{width:805,height:1024,path:"M317 869q42 18 80 18 214 0 214-191 0-65-23-102-15-25-35-42t-38-26-46-14-48-6-54-1q-41 0-57 5 0 30-0 90t-0 90q0 4-0 38t-0 55 2 47 6 38zM309 442q24 4 62 4 46 0 81-7t62-25 42-51 14-81q0-40-16-70t-45-46-61-24-70-8q-28 0-74 7 0 28 2 86t2 86q0 15-0 45t-0 45q0 26 0 39zM0 950l1-53q8-2 48-9t60-15q4-6 7-15t4-19 3-18 1-21 0-19v-37q0-561-12-585-2-4-12-8t-25-6-28-4-27-2-17-1l-2-47q56-1 194-6t213-5q13 0 39 0t38 0q40 0 78 7t73 24 61 40 42 59 16 78q0 29-9 54t-22 41-36 32-41 25-48 22q88 20 146 76t58 141q0 57-20 102t-53 74-78 48-93 27-100 8q-25 0-75-1t-75-1q-60 0-175 6t-132 6z"},em:{width:585,height:1024,path:"M0 949l9-48q3-1 46-12t63-21q16-20 23-57 0-4 35-165t65-310 29-169v-14q-13-7-31-10t-39-4-33-3l10-58q18 1 68 3t85 4 68 1q27 0 56-1t69-4 56-3q-2 22-10 50-17 5-58 16t-62 19q-4 10-8 24t-5 22-4 26-3 24q-15 84-50 239t-44 203q-1 5-7 33t-11 51-9 47-3 32l0 10q9 2 105 17-1 25-9 56-6 0-18 0t-18 0q-16 0-49-5t-49-5q-78-1-117-1-29 0-81 5t-69 6z"},code:{width:896,height:1024,path:"M608 192l-96 96 224 224-224 224 96 96 288-320-288-320zM288 192l-288 320 288 320 96-96-224-224 224-224-96-96z"},link:{width:951,height:1024,path:"M832 694q0-22-16-38l-118-118q-16-16-38-16-24 0-41 18 1 1 10 10t12 12 8 10 7 14 2 15q0 22-16 38t-38 16q-8 0-15-2t-14-7-10-8-12-12-10-10q-18 17-18 41 0 22 16 38l117 118q15 15 38 15 22 0 38-14l84-83q16-16 16-38zM430 292q0-22-16-38l-117-118q-16-16-38-16-22 0-38 15l-84 83q-16 16-16 38 0 22 16 38l118 118q15 15 38 15 24 0 41-17-1-1-10-10t-12-12-8-10-7-14-2-15q0-22 16-38t38-16q8 0 15 2t14 7 10 8 12 12 10 10q18-17 18-41zM941 694q0 68-48 116l-84 83q-47 47-116 47-69 0-116-48l-117-118q-47-47-47-116 0-70 50-119l-50-50q-49 50-118 50-68 0-116-48l-118-118q-48-48-48-116t48-116l84-83q47-47 116-47 69 0 116 48l117 118q47 47 47 116 0 70-50 119l50 50q49-50 118-50 68 0 116 48l118 118q48 48 48 116z"},bulletList:{width:768,height:896,path:"M0 512h128v-128h-128v128zM0 256h128v-128h-128v128zM0 768h128v-128h-128v128zM256 512h512v-128h-512v128zM256 256h512v-128h-512v128zM256 768h512v-128h-512v128z"},orderedList:{width:768,height:896,path:"M320 512h448v-128h-448v128zM320 768h448v-128h-448v128zM320 128v128h448v-128h-448zM79 384h78v-256h-36l-85 23v50l43-2v185zM189 590c0-36-12-78-96-78-33 0-64 6-83 16l1 66c21-10 42-15 67-15s32 11 32 28c0 26-30 58-110 112v50h192v-67l-91 2c49-30 87-66 87-113l1-1z"},blockquote:{width:640,height:896,path:"M0 448v256h256v-256h-128c0 0 0-128 128-128v-128c0 0-256 0-256 256zM640 320v-128c0 0-256 0-256 256v256h256v-256h-128c0 0 0-128 128-128z"}},mc=new ne({title:"Join with above block",run:Qn,select:i=>Qn(i),icon:Q.join}),gc=new ne({title:"Lift out of enclosing block",run:Yn,select:i=>Yn(i),icon:Q.lift}),yc=new ne({title:"Select parent node",run:Xn,select:i=>Xn(i),icon:Q.selectParentNode});let bc=new ne({title:"Undo last change",run:sn,enable:i=>sn(i),icon:Q.undo}),xc=new ne({title:"Redo last undone change",run:Ct,enable:i=>Ct(i),icon:Q.redo});function kc(i,e){let t={run(n,r){return Zn(i,e.attrs)(n,r)},select(n){return Zn(i,e.attrs)(n)}};for(let n in e)t[n]=e[n];return new ne(t)}function An(i,e){let t=_t(i,e.attrs),n={run:t,enable(r){return t(r)},active(r){let{$from:s,to:o,node:l}=r.selection;return l?l.hasMarkup(i,e.attrs):o<=s.end()&&s.parent.hasMarkup(i,e.attrs)}};for(let r in e)n[r]=e[r];return new ne(n)}function ti(i,e,t){t?i.classList.add(e):i.classList.remove(e)}const zt="ProseMirror-menubar";function Sc(){if(typeof navigator>"u")return!1;let i=navigator.userAgent;return!/Edge\/\d/.test(i)&&/AppleWebKit/.test(i)&&/Mobile\/\w+/.test(i)}function wc(i){return new le({view(e){return new Cc(e,i)}})}class Cc{constructor(e,t){this.editorView=e,this.options=t,this.spacer=null,this.maxHeight=0,this.widthForMaxHeight=0,this.floating=!1,this.scrollHandler=null,this.wrapper=j("div",{class:zt+"-wrapper"}),this.menu=this.wrapper.appendChild(j("div",{class:zt})),this.menu.className=zt,e.dom.parentNode&&e.dom.parentNode.replaceChild(this.wrapper,e.dom),this.wrapper.appendChild(e.dom);let{dom:n,update:r}=hc(this.editorView,this.options.content);if(this.contentUpdate=r,this.menu.appendChild(n),this.update(),t.floating&&!Sc()){this.updateFloat();let s=vc(this.wrapper);this.scrollHandler=o=>{let l=this.editorView.root;(l.body||l).contains(this.wrapper)?this.updateFloat(o.target.getBoundingClientRect?o.target:void 0):s.forEach(a=>a.removeEventListener("scroll",this.scrollHandler))},s.forEach(o=>o.addEventListener("scroll",this.scrollHandler))}}update(){this.contentUpdate(this.editorView.state),this.floating?this.updateScrollCursor():(this.menu.offsetWidth!=this.widthForMaxHeight&&(this.widthForMaxHeight=this.menu.offsetWidth,this.maxHeight=0),this.menu.offsetHeight>this.maxHeight&&(this.maxHeight=this.menu.offsetHeight,this.menu.style.minHeight=this.maxHeight+"px"))}updateScrollCursor(){let e=this.editorView.root.getSelection();if(!e.focusNode)return;let t=e.getRangeAt(0).getClientRects(),n=t[Mc(e)?0:t.length-1];if(!n)return;let r=this.menu.getBoundingClientRect();if(n.top<r.bottom&&n.bottom>r.top){let s=Oc(this.wrapper);s&&(s.scrollTop-=r.bottom-n.top)}}updateFloat(e){let t=this.wrapper,n=t.getBoundingClientRect(),r=e?Math.max(0,e.getBoundingClientRect().top):0;if(this.floating)if(n.top>=r||n.bottom<this.menu.offsetHeight+10)this.floating=!1,this.menu.style.position=this.menu.style.left=this.menu.style.top=this.menu.style.width="",this.menu.style.display="",this.spacer.parentNode.removeChild(this.spacer),this.spacer=null;else{let s=(t.offsetWidth-t.clientWidth)/2;this.menu.style.left=n.left+s+"px",this.menu.style.display=n.top>(this.editorView.dom.ownerDocument.defaultView||window).innerHeight?"none":"",e&&(this.menu.style.top=r+"px")}else if(n.top<r&&n.bottom>=this.menu.offsetHeight+10){this.floating=!0;let s=this.menu.getBoundingClientRect();this.menu.style.left=s.left+"px",this.menu.style.width=s.width+"px",e&&(this.menu.style.top=r+"px"),this.menu.style.position="fixed",this.spacer=j("div",{class:zt+"-spacer",style:`height: ${s.height}px`}),t.insertBefore(this.spacer,this.menu)}}destroy(){this.wrapper.parentNode&&this.wrapper.parentNode.replaceChild(this.editorView.dom,this.wrapper)}}function Mc(i){return i.anchorNode==i.focusNode?i.anchorOffset>i.focusOffset:i.anchorNode.compareDocumentPosition(i.focusNode)==Node.DOCUMENT_POSITION_FOLLOWING}function Oc(i){for(let e=i.parentNode;e;e=e.parentNode)if(e.scrollHeight>e.clientHeight)return e}function vc(i){let e=[i.ownerDocument.defaultView||window];for(let t=i.parentNode;t;t=t.parentNode)e.push(t);return e}const Bt="ProseMirror-prompt";function ro(i){let e=document.body.appendChild(document.createElement("div"));e.className=Bt;let t=f=>{e.contains(f.target)||n()};setTimeout(()=>window.addEventListener("mousedown",t),50);let n=()=>{window.removeEventListener("mousedown",t),e.parentNode&&e.parentNode.removeChild(e)},r=[];for(let f in i.fields)r.push(i.fields[f].render());let s=document.createElement("button");s.type="submit",s.className=Bt+"-submit",s.textContent="OK";let o=document.createElement("button");o.type="button",o.className=Bt+"-cancel",o.textContent="Cancel",o.addEventListener("click",n);let l=e.appendChild(document.createElement("form"));i.title&&(l.appendChild(document.createElement("h5")).textContent=i.title),r.forEach(f=>{l.appendChild(document.createElement("div")).appendChild(f)});let a=l.appendChild(document.createElement("div"));a.className=Bt+"-buttons",a.appendChild(s),a.appendChild(document.createTextNode(" ")),a.appendChild(o);let u=e.getBoundingClientRect();e.style.top=(window.innerHeight-u.height)/2+"px",e.style.left=(window.innerWidth-u.width)/2+"px";let c=()=>{let f=Nc(i.fields,r);f&&(n(),i.callback(f))};l.addEventListener("submit",f=>{f.preventDefault(),c()}),l.addEventListener("keydown",f=>{f.keyCode==27?(f.preventDefault(),n()):f.keyCode==13&&!(f.ctrlKey||f.metaKey||f.shiftKey)?(f.preventDefault(),c()):f.keyCode==9&&window.setTimeout(()=>{e.contains(document.activeElement)||n()},500)});let d=l.elements[0];d&&d.focus()}function Nc(i,e){let t=Object.create(null),n=0;for(let r in i){let s=i[r],o=e[n++],l=s.read(o),a=s.validate(l);if(a)return Dc(o,a),null;t[r]=s.clean(l)}return t}function Dc(i,e){let t=i.parentNode,n=t.appendChild(document.createElement("div"));n.style.left=i.offsetLeft+i.offsetWidth+2+"px",n.style.top=i.offsetTop-5+"px",n.className="ProseMirror-invalid",n.textContent=e,setTimeout(()=>t.removeChild(n),1500)}class Ec{constructor(e){this.options=e}read(e){return e.value}validateType(e){return null}validate(e){return!e&&this.options.required?"Required field":this.validateType(e)||(this.options.validate?this.options.validate(e):null)}clean(e){return this.options.clean?this.options.clean(e):e}}class gt extends Ec{render(){let e=document.createElement("input");return e.type="text",e.placeholder=this.options.label,e.value=this.options.value||"",e.autocomplete="off",e}}function so(i,e){let t=i.selection.$from;for(let n=t.depth;n>=0;n--){let r=t.index(n);if(t.node(n).canReplaceWith(r,r,e))return!0}return!1}function Tc(i){return new ne({title:"Insert image",label:"Image",enable(e){return so(e,i)},run(e,t,n){let{from:r,to:s}=e.selection,o=null;e.selection instanceof k&&e.selection.node.type==i&&(o=e.selection.node.attrs),ro({title:"Insert image",fields:{src:new gt({label:"Location",required:!0,value:o&&o.src}),title:new gt({label:"Title",value:o&&o.title}),alt:new gt({label:"Description",value:o?o.alt:e.doc.textBetween(r,s," ")})},callback(l){n.dispatch(n.state.tr.replaceSelectionWith(i.createAndFill(l))),n.focus()}})}})}function oo(i,e){let t={label:e.title,run:i};for(let n in e)t[n]=e[n];return!e.enable&&!e.select&&(t[e.enable?"enable":"select"]=n=>i(n)),new ne(t)}function ni(i,e){let{from:t,$from:n,to:r,empty:s}=i.selection;return s?!!e.isInSet(i.storedMarks||n.marks()):i.doc.rangeHasMark(t,r,e)}function In(i,e){let t={active(n){return ni(n,i)}};for(let n in e)t[n]=e[n];return oo(xe(i),t)}function Ac(i){return new ne({title:"Add or remove link",icon:Q.link,active(e){return ni(e,i)},enable(e){return!e.selection.empty},run(e,t,n){if(ni(e,i))return xe(i)(e,t),!0;ro({title:"Create a link",fields:{href:new gt({label:"Link target",required:!0}),title:new gt({label:"Title"})},callback(r){xe(i,r)(n.state,n.dispatch),n.focus()}})}})}function Mr(i,e){return oo(jn(i,e.attrs),e)}function Ic(i){let e={},t;(t=i.marks.strong)&&(e.toggleStrong=In(t,{title:"Toggle strong style",icon:Q.strong})),(t=i.marks.em)&&(e.toggleEm=In(t,{title:"Toggle emphasis",icon:Q.em})),(t=i.marks.code)&&(e.toggleCode=In(t,{title:"Toggle code font",icon:Q.code})),(t=i.marks.link)&&(e.toggleLink=Ac(t));let n;if((n=i.nodes.image)&&(e.insertImage=Tc(n)),(n=i.nodes.bullet_list)&&(e.wrapBulletList=Mr(n,{title:"Wrap in bullet list",icon:Q.bulletList})),(n=i.nodes.ordered_list)&&(e.wrapOrderedList=Mr(n,{title:"Wrap in ordered list",icon:Q.orderedList})),(n=i.nodes.blockquote)&&(e.wrapBlockQuote=kc(n,{title:"Wrap in block quote",icon:Q.blockquote})),(n=i.nodes.paragraph)&&(e.makeParagraph=An(n,{title:"Change to paragraph",label:"Plain"})),(n=i.nodes.code_block)&&(e.makeCodeBlock=An(n,{title:"Change to code block",label:"Code"})),n=i.nodes.heading)for(let s=1;s<=10;s++)e["makeHead"+s]=An(n,{title:"Change to heading "+s,label:"Level "+s,attrs:{level:s}});if(n=i.nodes.horizontal_rule){let s=n;e.insertHorizontalRule=new ne({title:"Insert horizontal rule",label:"Horizontal rule",enable(o){return so(o,s)},run(o,l){l(o.tr.replaceSelectionWith(s.create()))}})}let r=s=>s.filter(o=>o);return e.insertMenu=new Cr(r([e.insertImage,e.insertHorizontalRule]),{label:"Insert"}),e.typeMenu=new Cr(r([e.makeParagraph,e.makeCodeBlock,e.makeHead1&&new fc(r([e.makeHead1,e.makeHead2,e.makeHead3,e.makeHead4,e.makeHead5,e.makeHead6]),{label:"Heading"})]),{label:"Type..."}),e.inlineMenu=[r([e.toggleStrong,e.toggleEm,e.toggleCode,e.toggleLink])],e.blockMenu=[r([e.wrapBulletList,e.wrapOrderedList,e.wrapBlockQuote,mc,gc,yc])],e.fullMenu=e.inlineMenu.concat([[e.insertMenu,e.typeMenu]],[[bc,xc]],e.blockMenu),e}class De{constructor(e,t,n={}){this.match=e,this.match=e,this.handler=typeof t=="string"?qc(t):t,this.undoable=n.undoable!==!1,this.inCode=n.inCode||!1}}function qc(i){return function(e,t,n,r){let s=i;if(t[1]){let o=t[0].lastIndexOf(t[1]);s+=t[0].slice(o+t[1].length),n+=o;let l=n-r;l>0&&(s=t[0].slice(o-l,o)+s,n=r)}return e.tr.insertText(s,n,r)}}const Rc=500;function Pc({rules:i}){let e=new le({state:{init(){return null},apply(t,n){let r=t.getMeta(this);return r||(t.selectionSet||t.docChanged?null:n)}},props:{handleTextInput(t,n,r,s){return Or(t,n,r,s,i,e)},handleDOMEvents:{compositionend:t=>{setTimeout(()=>{let{$cursor:n}=t.state.selection;n&&Or(t,n.pos,n.pos,"",i,e)})}}},isInputRules:!0});return e}function Or(i,e,t,n,r,s){if(i.composing)return!1;let o=i.state,l=o.doc.resolve(e),a=l.parent.textBetween(Math.max(0,l.parentOffset-Rc),l.parentOffset,null,"")+n;for(let u=0;u<r.length;u++){let c=r[u];if(l.parent.type.spec.code){if(!c.inCode)continue}else if(c.inCode==="only")continue;let d=c.match.exec(a),f=d&&c.handler(o,d,e-(d[0].length-n.length),t);if(f)return c.undoable&&f.setMeta(s,{transform:f,from:e,to:t,text:n}),i.dispatch(f),!0}return!1}const zc=(i,e)=>{let t=i.plugins;for(let n=0;n<t.length;n++){let r=t[n],s;if(r.spec.isInputRules&&(s=r.getState(i))){if(e){let o=i.tr,l=s.transform;for(let a=l.steps.length-1;a>=0;a--)o.step(l.steps[a].invert(l.docs[a]));if(s.text){let a=o.doc.resolve(s.from).marks();o.replaceWith(s.from,s.to,i.schema.text(s.text,a))}else o.delete(s.from,s.to);e(o)}return!0}}return!1},Bc=new De(/--$/,""),Vc=new De(/\.\.\.$/,""),Fc=new De(/(?:^|[\s\{\[\(\<'"\u2018\u201C])(")$/,""),Lc=new De(/"$/,""),Wc=new De(/(?:^|[\s\{\[\(\<'"\u2018\u201C])(')$/,""),_c=new De(/'$/,""),Jc=[Fc,Lc,Wc,_c];function ki(i,e,t=null,n){return new De(i,(r,s,o,l)=>{let a=t instanceof Function?t(s):t,u=r.tr.delete(o,l),c=u.doc.resolve(o),d=c.blockRange(),f=d&&oi(d,e,a);if(!f)return null;u.wrap(d,f);let p=u.doc.resolve(o-1).nodeBefore;return p&&p.type==e&&st(u.doc,o-1)&&(!n||n(s,p))&&u.join(o-1),u})}function lo(i,e,t=null){return new De(i,(n,r,s,o)=>{let l=n.doc.resolve(s),a=t instanceof Function?t(r):t;return l.node(-1).canReplaceWith(l.index(-1),l.indexAfter(-1),e)?n.tr.delete(s,o).setBlockType(s,s,e,a):null})}const vr=typeof navigator<"u"?/Mac|iP(hone|[oa]d)/.test(navigator.platform):!1;function Hc(i,e){let t={},n;function r(s,o){if(e){let l=e[s];if(l===!1)return;l&&(s=l)}t[s]=o}if(r("Mod-z",sn),r("Shift-Mod-z",Ct),r("Backspace",zc),vr||r("Mod-y",Ct),r("Alt-ArrowUp",Qn),r("Alt-ArrowDown",Lu),r("Mod-BracketLeft",Yn),r("Escape",Xn),(n=i.marks.strong)&&(r("Mod-b",xe(n)),r("Mod-B",xe(n))),(n=i.marks.em)&&(r("Mod-i",xe(n)),r("Mod-I",xe(n))),(n=i.marks.code)&&r("Mod-`",xe(n)),(n=i.nodes.bullet_list)&&r("Shift-Ctrl-8",jn(n)),(n=i.nodes.ordered_list)&&r("Shift-Ctrl-9",jn(n)),(n=i.nodes.blockquote)&&r("Ctrl->",Zn(n)),n=i.nodes.hard_break){let s=n,o=dn(Gs,(l,a)=>(a&&a(l.tr.replaceSelectionWith(s.create()).scrollIntoView()),!0));r("Mod-Enter",o),r("Shift-Enter",o),vr&&r("Ctrl-Enter",o)}if((n=i.nodes.list_item)&&(r("Enter",au(n)),r("Mod-[",uu(n)),r("Mod-]",fu(n))),(n=i.nodes.paragraph)&&r("Shift-Ctrl-0",_t(n)),(n=i.nodes.code_block)&&r("Shift-Ctrl-\\",_t(n)),n=i.nodes.heading)for(let s=1;s<=6;s++)r("Shift-Ctrl-"+s,_t(n,{level:s}));if(n=i.nodes.horizontal_rule){let s=n;r("Mod-_",(o,l)=>(l&&l(o.tr.replaceSelectionWith(s.create()).scrollIntoView()),!0))}return t}function $c(i){return ki(/^\s*>\s$/,i)}function Kc(i){return ki(/^(\d+)\.\s$/,i,e=>({order:+e[1]}),(e,t)=>t.childCount+t.attrs.order==+e[1])}function Uc(i){return ki(/^\s*([-+*])\s$/,i)}function jc(i){return lo(/^```$/,i)}function Gc(i,e){return lo(new RegExp("^(#{1,"+e+"})\\s$"),i,t=>({level:t[1].length}))}function Qc(i){let e=Jc.concat(Vc,Bc),t;return(t=i.nodes.blockquote)&&e.push($c(t)),(t=i.nodes.ordered_list)&&e.push(Kc(t)),(t=i.nodes.bullet_list)&&e.push(Uc(t)),(t=i.nodes.code_block)&&e.push(jc(t)),(t=i.nodes.heading)&&e.push(Gc(t,6)),Pc({rules:e})}function Yc(i){let e=[Qc(i.schema),Gn(Hc(i.schema,i.mapKeys)),Gn(Xu),Zu(),ic()];return i.menuBar!==!1&&e.push(wc({floating:i.floatingMenu!==!1,content:i.menuContent||Ic(i.schema).fullMenu})),i.history!==!1&&e.push(qu()),e.concat(new le({props:{attributes:{class:"ProseMirror-example-setup-style"}}}))}let Xc=`
Lorem ipsum odor amet, consectetuer adipiscing elit. Porta fringilla morbi semper risus quis quisque molestie conubia. Egestas montes suspendisse aenean ac, diam porttitor augue congue. Neque odio lectus ex auctor aptent quisque convallis. Auctor mattis mauris libero class felis himenaeos sit dui dis. Quis aliquet mi dignissim magnis efficitur venenatis. Viverra mus adipiscing finibus maximus consequat platea. At risus neque odio cras felis primis aliquam arcu in. Maximus ex at vel sociosqu facilisi arcu natoque feugiat facilisis. Felis natoque sociosqu torquent venenatis tristique suscipit.

Per maximus neque ullamcorper accumsan scelerisque sollicitudin pellentesque libero. Nulla imperdiet nisl suscipit eleifend mattis tellus arcu. Ligula pellentesque tempor sed dapibus netus. Dolor habitasse ad ullamcorper blandit dolor, consectetur id himenaeos ante. Turpis velit lacus consequat tristique morbi. Inceptos malesuada volutpat diam sodales parturient nec, quam hendrerit. Tortor primis sagittis consectetur vel magna commodo in tellus.

Rutrum dui congue class urna nibh platea semper primis? Placerat habitant lacinia non maximus aliquet risus orci diam. Nulla elit eros blandit quam odio sagittis. Lacus inceptos elementum viverra nullam blandit dictum. Laoreet tellus venenatis condimentum cras eget ultrices tempor. Vehicula mollis netus praesent pellentesque quam sem. Elementum cursus urna hac inceptos ornare egestas.

Morbi iaculis massa lobortis facilisi potenti. Porta facilisi consectetur non ad iaculis nam laoreet. Euismod nec a feugiat sapien iaculis fames curabitur senectus. Consectetur pretium tortor ridiculus vivamus morbi turpis. Enim ante magnis etiam suspendisse curae dictumst semper ad. Finibus dui justo amet aptent curae. Natoque sagittis aliquet ornare turpis proin magnis maximus rutrum. Nascetur porta in dapibus placerat; ac ac torquent vulputate. Potenti volutpat nascetur nullam fermentum quam mus libero accumsan.

Adipiscing suspendisse dapibus felis tellus velit. Sapien nulla neque congue conubia taciti. Gravida dignissim penatibus primis dui metus nec. Habitasse tempus fermentum felis risus litora tincidunt nullam interdum. Molestie et nostra eu donec et dictum elementum vulputate. Pretium sit vehicula sem conubia phasellus duis. Hendrerit dui hac iaculis venenatis bibendum suspendisse volutpat.

Velit ex ut sed conubia at faucibus commodo. Sollicitudin sollicitudin pretium consectetur orci; vitae eget penatibus eleifend aliquam? Cras morbi euismod vel lectus platea. Ridiculus taciti senectus sociosqu curae egestas vulputate auctor vivamus. Hac fringilla per tellus dui elit. Velit mus dapibus eget, elementum etiam lacinia luctus sapien. Sagittis mollis maecenas mattis molestie magnis. Orci rutrum ante et cubilia consequat. Et nisl vehicula aliquam augue justo adipiscing nam morbi.

Lobortis in maecenas turpis, nascetur purus pulvinar. Mus conubia id nisi et condimentum nullam faucibus. Ridiculus commodo molestie nisi parturient risus enim interdum. Scelerisque lacus praesent facilisi quam curae. Mi laoreet aliquet nisi interdum enim maecenas sem ullamcorper? Class nec duis habitant sem quis tempor curae nostra magna.

Ridiculus risus sapien mattis luctus cursus; nisi libero enim. Ad felis nisl platea per ut lacus semper ac. Mus orci ut luctus neque torquent lacinia maximus. Per ut vitae maximus, class fames finibus. Interdum blandit massa vulputate porttitor fringilla molestie fames velit. Egestas et risus elit ad dui odio tristique arcu. Accumsan quisque laoreet turpis laoreet feugiat molestie ex. Ultricies augue diam ultrices; rutrum himenaeos eget. Volutpat nascetur phasellus ac dignissim duis. Lectus velit porttitor mollis phasellus vestibulum mauris, maximus dolor phasellus.

Cursus euismod finibus nec magnis conubia integer. Malesuada fusce euismod consequat nam nostra congue cubilia. Feugiat donec lacinia in etiam diam. Maecenas eros lectus id iaculis condimentum nisi. Blandit felis nullam posuere auctor curabitur potenti imperdiet. Donec dui gravida venenatis, senectus facilisi aenean enim. Quis risus cras himenaeos iaculis ligula arcu nam; montes convallis. Libero primis ligula ligula ac per eleifend placerat hac. Augue congue id ridiculus; etiam suscipit sociosqu nam himenaeos.

Finibus suscipit montes a elit duis tempus facilisis ut phasellus. In eros fermentum iaculis primis elit. Dolor aenean cursus scelerisque tincidunt sagittis. Ultricies semper sollicitudin at, non ligula nunc purus. Pulvinar suscipit aenean porta nullam vitae integer. Faucibus in nisi tristique vitae vestibulum justo tellus tristique. Posuere tellus malesuada semper nam vel; lobortis dis. Placerat non mi amet facilisi scelerisque tincidunt sociosqu ultricies?

Parturient litora pretium lacus lacus torquent nibh vestibulum. Penatibus netus consequat justo nulla molestie; nibh blandit. Adipiscing quis montes hendrerit curae enim placerat tempus. Maximus integer litora parturient scelerisque vitae luctus dictum. Purus ipsum purus penatibus faucibus nec. Semper dictum dignissim commodo cras mattis dapibus lacus mi.

Porttitor penatibus condimentum interdum ornare ex mauris. Convallis sollicitudin faucibus potenti nam eu. Efficitur quisque neque luctus, orci platea libero nisl dictum. Platea faucibus tortor inceptos sed montes gravida curae dictum. Posuere sapien quis, dolor blandit gravida sollicitudin porta aenean. Platea in sem quam mattis mauris sagittis. Sodales conubia netus elementum interdum blandit etiam.

Faucibus proin scelerisque senectus conubia ipsum laoreet venenatis vestibulum vulputate. Metus eleifend porta nibh massa dui varius. Nam neque tristique hac per suscipit. Malesuada libero libero risus interdum tristique magnis consectetur. Efficitur commodo pulvinar curabitur quisque ridiculus laoreet cursus tincidunt sapien. Cursus ante congue integer volutpat eleifend integer duis. Natoque ullamcorper suscipit pharetra inceptos euismod. Id torquent consectetur ut neque pharetra magna. Congue dictum consequat dictumst venenatis; taciti nunc efficitur litora.

Leo dis nostra posuere augue convallis tempus vitae purus faucibus. Curabitur mauris pulvinar tristique finibus litora imperdiet montes. Congue donec et condimentum convallis litora, ultrices arcu. Facilisis praesent lacus sodales lacinia euismod mi. Proin sapien montes vehicula; ridiculus penatibus himenaeos. Viverra elit litora fusce torquent dui. Mus maecenas tempus tortor magnis fermentum sociosqu rhoncus. Nascetur ultricies aptent, molestie est viverra tellus. Sapien per ullamcorper tellus suspendisse enim.

Erat maximus leo aptent leo nec sapien libero iaculis. Hendrerit venenatis natoque mollis mauris taciti, etiam quisque. Sapien vitae consequat per eleifend quis fames. Turpis praesent faucibus vulputate ullamcorper at urna rutrum sem libero. Donec magnis gravida integer mauris etiam commodo. Sodales urna justo faucibus morbi dignissim. Interdum penatibus nisl cras fermentum ad. Varius ex ad venenatis; neque imperdiet sollicitudin adipiscing sollicitudin.

Diam in curabitur sem consectetur felis. Tempus semper at erat habitant litora pulvinar porttitor morbi iaculis. Potenti litora commodo potenti bibendum sollicitudin nam. Scelerisque augue vehicula libero vel consectetur. Dapibus enim suscipit; varius torquent at sed interdum sagittis. Sociosqu enim dolor penatibus et sem inceptos tellus cubilia dolor. Suscipit nec dignissim est; feugiat ligula eget! Orci vulputate litora aptent commodo tortor aliquam.

Quis accumsan nulla sodales pellentesque fusce. Tristique aptent litora lorem adipiscing phasellus inceptos pretium. Tellus mauris erat justo egestas porttitor sagittis ex nascetur. Elementum sodales nisl ad, a arcu finibus dictum tempus. Aconubia facilisi ligula hendrerit elementum; neque natoque sollicitudin. Arcu vivamus lectus consequat in lobortis. Dui facilisis eu nulla placerat aliquam consectetur conubia consequat metus. Nibh ac dolor a semper facilisis tempor ultricies. Commodo consequat scelerisque rhoncus proin iaculis commodo litora venenatis.

Eleifend iaculis aliquam id sapien mus hendrerit. Nec nullam risus habitant suscipit vestibulum semper consectetur. Nisi semper amet netus diam ultrices in. Dolor congue ut pulvinar curae himenaeos. Varius praesent nascetur a magnis, torquent malesuada eu. Porttitor inceptos quam donec pulvinar leo condimentum pulvinar iaculis inceptos. Sagittis a aenean laoreet tincidunt efficitur pulvinar nam tortor. Libero egestas iaculis lacus adipiscing at purus mus. Curabitur natoque non auctor pulvinar congue.

Neque fermentum ex dictumst dictum ut. Himenaeos mi ligula litora pulvinar amet. Fusce maecenas facilisis eget lobortis viverra vivamus auctor. Porta donec class senectus interdum iaculis vestibulum ex. Dapibus augue fusce finibus id efficitur aliquam ligula dolor. Neque dis lobortis lectus ad arcu sem arcu. Sollicitudin placerat tristique efficitur tristique per. Torquent conubia lectus amet taciti aenean semper. Integer sapien viverra pharetra risus montes integer interdum eros.

Fringilla mauris est nec feugiat hendrerit tortor proin. Accumsan himenaeos elit tempus sagittis phasellus litora cubilia duis. Taciti phasellus rhoncus sociosqu sociosqu id duis? Porta eros tincidunt fusce; proin ipsum gravida risus odio. Interdum parturient montes hendrerit proin vel platea. Interdum imperdiet netus, litora dolor justo tristique. Scelerisque purus erat scelerisque torquent tristique elit odio vitae. Primis vel tristique fermentum tristique rutrum neque convallis. Ornare ridiculus mus integer maximus tellus nascetur velit.

Eu leo malesuada integer vehicula sed hendrerit diam. Amet est augue nullam elit bibendum conubia erat commodo volutpat. Magnis facilisis tincidunt eget pulvinar, varius natoque cras. Nostra integer penatibus phasellus nullam aliquet posuere luctus. Sed risus sagittis convallis facilisis odio eget egestas facilisis. Maecenas hac hendrerit hac curae et malesuada mollis magna libero.

Imperdiet libero purus montes elementum sit augue hac. Risus purus taciti elementum per lacinia. Bibendum cursus vitae leo, consectetur scelerisque tincidunt. Ullamcorper viverra hac vehicula ultricies hac sagittis sollicitudin fringilla? Platea vehicula mus fusce mollis penatibus aenean bibendum. Massa consectetur dolor magna interdum ac, purus dignissim et. Placerat potenti maximus blandit; id risus sollicitudin. Ullamcorper tempor cursus cursus volutpat pretium ipsum felis accumsan. Velit nullam maximus morbi urna eu metus ex nisi cursus. Sociosqu metus bibendum quisque habitasse litora dui ridiculus magna.

Proin cras pellentesque eget; ex pellentesque ut. Nostra euismod condimentum a; parturient orci laoreet. Malesuada ornare sem elementum nec adipiscing phasellus nullam. Massa himenaeos suspendisse ultricies quisque rutrum risus mauris lacinia. Est sagittis est convallis vitae scelerisque volutpat. At semper donec fusce enim convallis fringilla.

Sem elementum ridiculus lorem velit iaculis in ut vel. Praesent tellus amet ex gravida turpis. Ex netus ligula iaculis condimentum aenean nisl diam dolor. Parturient luctus primis; habitant pellentesque parturient tempus porta. Nostra nascetur eget integer blandit morbi. Facilisi pharetra ac lectus ipsum ad condimentum cursus. Sagittis in rhoncus magna; class sollicitudin enim risus. Cubilia consequat fringilla nulla libero scelerisque vulputate primis? Ipsum a sodales, sociosqu morbi lectus proin justo urna.

Duis augue et lobortis; erat erat per magnis blandit. Elit est diam neque curabitur lacus felis maximus torquent. Imperdiet varius purus integer venenatis massa. Nam fusce facilisi morbi taciti tortor sed nascetur. Aliquet dapibus nisl dapibus facilisi enim quam dolor rutrum eget. Scelerisque pharetra pretium; quisque natoque vel convallis hac. Ridiculus vestibulum et turpis magnis aptent quam elit per. Volutpat in nam enim erat montes eget quam.

Ligula dignissim eu suscipit lorem congue feugiat donec. Taciti fringilla augue quisque penatibus blandit posuere justo nostra. Feugiat feugiat quam consectetur odio morbi. Mi magnis semper eros posuere cras. Nam conubia quis ante fermentum id aliquet mus habitant. Tristique phasellus magnis netus inceptos parturient sapien. Quis phasellus sit felis mollis leo pharetra pharetra ultricies. Ut ut pharetra aptent vulputate tristique mus, erat justo? Augue donec volutpat magnis lectus porta inceptos.

Ultrices porta libero tempor ut scelerisque feugiat pharetra maecenas. Libero aenean pharetra sapien sagittis natoque porta quis mattis? Fermentum efficitur sociosqu etiam sem pharetra per eu. Non mauris ultricies ut tempor mauris iaculis. Velit mus sagittis dictum semper maecenas imperdiet platea risus? Justo nisl elementum nam laoreet efficitur. Placerat donec convallis aptent, fusce maecenas orci sollicitudin. Bibendum pretium leo vitae cursus aenean convallis risus sem ornare. Massa et placerat aliquam fames felis. Lorem ridiculus cursus cras praesent suscipit nibh.

Lacinia finibus posuere commodo sollicitudin finibus laoreet. Turpis ac per augue senectus ac proin ullamcorper. Fermentum dapibus natoque habitant sollicitudin libero; pretium nam inceptos. Habitant ligula faucibus lacus nisi himenaeos bibendum id suspendisse ridiculus. Mollis tristique urna imperdiet dignissim porta sit fringilla condimentum. Himenaeos convallis tempor ad laoreet lectus potenti fusce. Aenean habitasse libero dictumst luctus; taciti posuere sollicitudin. Vehicula duis senectus consectetur magna eget orci potenti platea?

Quisque eros cras habitasse; lectus libero vivamus? Mattis euismod ultricies quis tortor egestas eget ridiculus nascetur. Molestie sapien sapien euismod aliquet pellentesque gravida tempus. Nec tempor vitae vehicula taciti, ultrices conubia velit suscipit est. Leo finibus aptent conubia; ullamcorper dis lobortis tristique ante. Conubia velit tincidunt integer sagittis aliquet nulla pretium. Venenatis sodales erat sociosqu lacus facilisi dictum pharetra.

Dictum nascetur quis platea quam, dis accumsan amet. Euismod nulla semper ut condimentum fusce nisi nisi. Mauris est massa dictumst pellentesque malesuada morbi. Penatibus varius facilisis imperdiet leo dignissim. Consectetur fermentum cubilia erat consectetur malesuada amet velit curabitur. Primis lectus turpis efficitur diam, semper ante ante proin. Etiam sagittis netus netus hendrerit nostra. Cubilia faucibus proin netus proin lectus. Cubilia auctor viverra est ad consequat tincidunt finibus habitant.

Orci vulputate quam volutpat amet vitae interdum mattis. Velit vel conubia ante semper morbi? Torquent rhoncus enim morbi venenatis diam massa penatibus montes. Inceptos magna viverra fermentum nostra tempor eget viverra. Velit sapien dis montes fusce nisi tellus malesuada sagittis integer. Scelerisque diam class aliquet ornare fusce tellus dis.

Amet ac maximus mi eros laoreet aenean vitae himenaeos. Scelerisque consectetur curae; porta hac primis facilisi sem. Metus rutrum erat feugiat nibh euismod cubilia; vestibulum aptent. Aporttitor tincidunt est tincidunt et felis. Netus venenatis justo egestas nascetur ipsum habitasse sollicitudin posuere iaculis. Posuere dapibus pellentesque, hac risus praesent interdum conubia rhoncus. Hendrerit eu condimentum iaculis pellentesque; cubilia per potenti. Mollis eu nisi vitae dictum, ex risus vitae.

Vitae vulputate sit tempor class id litora. Natoque sodales dui arcu et dapibus torquent. Inceptos et et, placerat senectus class vitae fermentum sollicitudin eu. Aliquet ac sed rutrum hac proin quis a leo. Sociosqu ut ut condimentum auctor quam magna. Ante elementum enim curae felis erat. Feugiat et platea ad hendrerit mauris bibendum. Malesuada montes orci quam in vulputate nascetur nunc.

Tortor donec convallis suspendisse dignissim inceptos a convallis. Finibus facilisis lobortis lobortis lacinia consectetur. Eros commodo taciti magnis nisl rhoncus sed. Lorem sodales viverra duis adipiscing magna. Lorem gravida potenti, erat potenti tortor suscipit. Est fames ante euismod maximus dapibus duis magna aliquet ultrices. Fusce molestie lacinia accumsan vulputate aliquam amet placerat.

Enim primis facilisi ad sagittis velit. Erat ridiculus iaculis risus sed at rutrum sociosqu. Magna porta rutrum fusce mi lacus class himenaeos litora. Tincidunt torquent malesuada imperdiet tortor sit. Suspendisse netus felis parturient torquent pretium vehicula. Facilisis ridiculus nec penatibus augue congue massa, facilisi purus congue. Netus blandit justo consequat tristique mollis nisi curae class. Accumsan semper proin donec consectetur himenaeos eros ligula semper amet.

Luctus integer blandit lorem cubilia luctus eu tortor ultrices. Cubilia maximus justo penatibus pretium convallis vivamus. Lacus turpis pulvinar tellus luctus proin vivamus varius. Pretium feugiat ex ullamcorper donec convallis. Accumsan nascetur venenatis rhoncus luctus ex mattis facilisi at. Ultrices ut metus turpis porttitor lectus et! Ad lacus fringilla metus sodales bibendum imperdiet nulla rutrum. Urna facilisis lorem nostra erat mattis platea arcu.

Platea auctor suspendisse donec donec cras justo? Curae neque porta pharetra vel himenaeos. Imperdiet lacus felis; etiam tristique sapien sociosqu. Gravida dui augue nulla inceptos dis class. Diam bibendum dictumst eget magnis amet vel, parturient aliquet. Justo molestie lacus sapien placerat posuere feugiat ante. Varius semper inceptos duis suscipit erat nisl varius nisl. Posuere urna curae libero cubilia potenti condimentum.

Habitant taciti rhoncus potenti consequat volutpat, non duis ultricies. Platea primis etiam litora ipsum mollis. Pretium vestibulum eros dis aliquam, suscipit diam. Aliquet ultricies tempus posuere aptent risus inceptos in iaculis. Parturient sodales class ut egestas litora lacinia ultricies condimentum. Sociosqu nostra massa lectus suspendisse congue nec nisi?

Urna gravida non lacinia eu ac accumsan inceptos. Mus taciti fames finibus tempus eu accumsan. Taciti montes sed aliquam aliquam luctus dictum pellentesque eu. Gravida aliquam convallis et quisque arcu aenean vestibulum porttitor porta. In semper tempor erat neque nunc; venenatis at consectetur. Nisi aptent vivamus diam eu platea facilisi feugiat quis. Quisque maximus justo et nisl massa faucibus nulla. Aliquet torquent finibus dignissim proin vulputate.

Dui felis pretium vel nisl efficitur euismod. Elit dis himenaeos phasellus condimentum purus ullamcorper nam! Luctus nisl luctus parturient cras volutpat mi congue pharetra. Nullam diam inceptos mattis ultricies penatibus posuere. Arcu orci interdum imperdiet efficitur egestas leo et. Malesuada lectus sapien taciti elit dolor hac consequat sagittis mattis. Elit mus a nec netus himenaeos. Potenti velit sit aptent erat primis aliquet lacinia. Cubilia inceptos est vel phasellus mauris montes fringilla. Turpis adipiscing hendrerit vestibulum rhoncus eu lorem enim.

Auctor fames cubilia sed; malesuada porttitor ut. Amet dignissim placerat nunc ad nostra tempus dignissim faucibus. Cras auctor et turpis semper litora fermentum, aptent habitasse. Elit sollicitudin hendrerit consequat rhoncus bibendum pharetra id tellus! Nascetur facilisi porttitor eu; viverra cursus sed. Quis parturient accumsan condimentum scelerisque, maximus velit inceptos porttitor.

Feugiat nec ipsum eros a ut ligula nostra. Nunc curae cursus ultrices mauris ridiculus neque. Fames eros pulvinar congue quam nunc. Vestibulum sit praesent platea rutrum per taciti malesuada. Euismod commodo proin urna eleifend condimentum at et. Quis auctor ac augue; eget dapibus fames sapien? Lacus quam primis, nullam molestie finibus scelerisque volutpat dolor et. Non quis quam massa nec hac fringilla. Aliquam class ipsum elit metus ut; hendrerit ultrices lacinia.

Habitasse imperdiet platea tempor, donec mauris elementum felis vivamus dictum. Enim sem nostra semper mi hac tincidunt mattis mattis. Semper in sagittis massa, torquent elit ridiculus. Ipsum fermentum varius varius habitasse phasellus nulla. Iaculis risus nibh mus placerat quam hendrerit conubia. Morbi quam rhoncus arcu quam dui tortor sodales, non netus. Rutrum ultricies ac sociosqu, vulputate metus nunc. Ut faucibus inceptos urna lectus ex vulputate lacinia. Justo ornare luctus scelerisque aptent habitant aliquam convallis venenatis.

Interdum efficitur ullamcorper mus arcu elementum; nec phasellus suscipit. Risus nec augue varius platea litora dapibus nascetur. Felis nec molestie vulputate porta, quam dolor. Aliquam bibendum litora velit commodo maecenas aliquam felis euismod. Inceptos arcu scelerisque pulvinar accumsan vestibulum. Porta hac et fusce sapien mauris ipsum nisl tempus. Diam ex non montes justo proin a.

Leo ridiculus nibh augue metus ante phasellus; cursus venenatis placerat. Donec a at molestie mollis neque suscipit habitant ante litora. Tellus condimentum lobortis nostra turpis blandit convallis. Dui pharetra urna habitasse ipsum vulputate suscipit quam. Erat urna dapibus ullamcorper nunc purus et rutrum donec. Vitae lacus mauris potenti dui elementum lectus. Nec himenaeos phasellus a vivamus cubilia duis. Habitant netus commodo vel suscipit et auctor.

Mattis libero ante sed feugiat conubia sociosqu accumsan. Fermentum mauris taciti ornare, fringilla porta dignissim. Nullam habitasse sodales etiam sapien risus. Est arcu pretium pellentesque felis vulputate. Ultricies malesuada magnis fringilla metus sollicitudin. Platea montes nisl vulputate porta facilisi libero commodo sit. Potenti eleifend senectus nostra nisl eget, ultrices nibh quam diam. Ac proin ridiculus platea imperdiet; posuere purus enim.

Congue facilisis varius pulvinar risus interdum quis dui senectus nisl. Pulvinar porttitor lacinia facilisis laoreet nisi. Suspendisse eu volutpat fusce; cubilia viverra convallis. Nisi duis auctor id nisi laoreet viverra sociosqu integer. Nibh consectetur lectus mi congue suscipit aptent. Penatibus dapibus congue, ut maecenas aptent aliquam. Mus dis ex, bibendum fames pulvinar mattis. Fusce nibh ex sapien ipsum odio varius. Ut sagittis arcu vitae aptent penatibus. Nibh sagittis ligula mus convallis primis iaculis etiam at litora.

Urna mus donec lobortis ad venenatis fringilla libero bibendum. Eu lectus nostra diam eros dictumst porttitor vel facilisi. Mauris mattis nisl gravida massa in lacus viverra imperdiet. Accumsan netus nulla ullamcorper nostra efficitur facilisis diam at iaculis. Conubia natoque cras ipsum cubilia cras ante ornare justo. Maecenas duis felis sodales leo ex dolor auctor. Sed nec lacinia hac scelerisque ipsum taciti felis aenean.

Sapien convallis felis non ultrices sodales euismod mi. Sagittis convallis egestas facilisis neque aliquet pretium dis. Ut eget rutrum fringilla ridiculus euismod consectetur nisi. Facilisis ligula ac class vulputate id cubilia. Nulla semper condimentum interdum rutrum libero praesent fames turpis amet. Ultrices parturient donec ante amet eget rutrum. Rutrum iaculis nostra torquent mauris phasellus ornare.

Praesent at sociosqu auctor, mattis lobortis dolor. Mus lacus nascetur velit tempus sagittis. Ac neque mollis ipsum himenaeos felis eros auctor. Per curae libero conubia adipiscing laoreet elementum ex. Nullam habitant sapien lacinia amet elementum; montes malesuada rutrum. Augue parturient quisque purus; fringilla dui in! Ornare consequat nec lacinia adipiscing rhoncus ullamcorper egestas.
`,Zc=Xc.split(`
`).filter(i=>i);function ed(i){let e=[],t=i;for(;t>0;){let n=Math.min(t,50);for(let r=0;r<n;r++)e.push(Zc[r]);t-=n}return e}const Ot=new Jr({nodes:ou(xr.spec.nodes,"paragraph block*","block"),marks:xr.spec.marks}),ao="meta_top_level_dec",td="meta_ephemeral";class nd{constructor(e){this.doc=e,this.steps=[],this.step_client_ids=[],this.on_new_steps=[]}receive_steps(e,t,n){e==this.steps.length&&(t.forEach(r=>{this.doc=r.apply(this.doc).doc,this.steps.push(r),this.step_client_ids.push(n)}),this.on_new_steps.forEach(function(r){r()}))}steps_since(e){return{steps:this.steps.slice(e),clientIDs:this.step_client_ids.slice(e)}}}const Vt=new nd(Ze.fromSchema(Ot).parse(document.querySelector("#content")));class id{constructor(e){this.view=e,this.connected=!1,this.on_new_steps=function(){if(this.connected){let t=Vt.steps_since(bu(e.state));e.dispatch(gu(e.state,t.steps,t.clientIDs))}},this.on_new_steps=this.on_new_steps.bind(this)}start(){this.view.state.doc=Vt.doc,this.connect()}connect(){this.connected=!0,this.on_new_steps(),Vt.on_new_steps.push(this.on_new_steps),this.send_steps(this.view.state)}disconnect(){this.connected=!1}send_steps(e){if(this.connected){let t=yu(e);t&&Vt.receive_steps(t.version,t.steps,t.clientID)}}}class Fe extends T{constructor(e,t,n){super(),this.from=e,this.to=t,this.attrs=n}apply(e){return D.ok(e)}invert(){return new Fe(this.from,this.to,this.attrs)}map(e){return new Fe(e.map(this.from),e.map(this.to),this.attrs)}toJSON(){return{stepType:"decoration",from:this.from,to:this.to,attrs:this.attrs}}static fromJSON(e,t){return new Fe(t.from,t.to,t.attrs)}}T.jsonID("highlight_decoration",Fe);let uo=new le({state:{init(i,{doc:e}){return v.create(e,[])},apply(i,e){return i.steps.forEach(t=>{t instanceof Fe&&(e=e.add(i.doc,[J.inline(t.from,t.to,{style:`background: ${t.attrs.color}`})]))}),e.map(i.mapping,i.doc)}},props:{decorations(i){return uo.getState(i)}}});function rd(i,e,t){const{selection:n}=i,{from:r,to:s}=n;let o=i.tr;o.step(new Fe(r,s,{color:t})),e(o)}const sd=20,Nr=document.styleSheets[0];Nr.insertRule(".top_level_dec::before { content: attr(data-top_level_dec_count); color: red; }",Nr.cssRules.length);function od(i){const e=i.getBoundingClientRect();return e.bottom<0?-1:e.top>(window.innerHeight||document.documentElement.clientHeight)?1:0}function ld(i,e){let t=0,n=i.length-1,r=-1;for(;t<=n;){r===-1&&(r=Math.floor((t+n)/2));let s=e(i[r],r);if(s.success)return r;if(s.cmp<0)t=r+1,r=-1;else if(s.cmp>0)n=r-1,r=-1;else{if(t===n)return-1;r===n?(n=Math.floor((t+n)/2),r=-1):r+=1}}return-1}function ad(i,e,t,n=sd){let r=e.content,s=[];r.forEach((u,c,d)=>{s.push({node:u,offset:c,idx:d})});function o(u,c){let{node:d,offset:f,idx:p}=u,h=i.nodeDOM(t.map(f)),m={success:!1,cmp:0};if(h){let g=od(h);g===0?m.success=!0:m.cmp=g}return m}let l=ld(s,o),a={start:0,end:0,data:s};return l>-1&&(a={start:Math.max(0,l-n),end:Math.min(s.length,l+n),data:s}),a}function ii(i){let{state:e,dispatch:t}=i,n=e.tr;n.setMeta(ao,!0),n.setMeta(td,!0),n.setMeta("addToHistory",!1),t(n)}function ud(i){let e=new le({state:{init(t,{doc:n}){let r=v.create(n,[]);return setTimeout(()=>{ii(i.view)},0),r},apply(t,n){if(!t.getMeta(ao))return setTimeout(()=>{ii(i.view)},0),n;let{start:r,end:s,data:o}=ad(i.view,t.doc,t.mapping.invert()),l=[],a=v.empty;for(let u=r;u<s;u++){let c=u,{node:d,offset:f}=o[u],p=J.node(f,f+d.nodeSize,{class:"top_level_dec","data-top_level_dec_count":c+""});l.push(p)}return a.add(t.doc,l)}},props:{decorations(t){return e.getState(t)}}});return e}function ri(i){let e=document.querySelector(i),t=document.createElement("div");e.appendChild(t);let n=document.createElement("div");n.className="editor";let r=document.createElement("div");r.className="controls",t.appendChild(r),t.appendChild(n);let s={view:null},o=new Wa(n,{state:je.create({doc:Ot.nodes.doc.createAndFill(),plugins:[...Yc({schema:Ot}),ud(s),uo,mu({version:0}),Gn({"Mod-y":(d,f,p)=>(f&&rd(d,f,"yellow"),!0)})]}),dispatchTransaction(d){let f=o.state.apply(d);o.updateState(f),l.send_steps(f)}});s.view=o;let l=new id(o);l.start();let a=document.createElement("div");r.appendChild(a);let u=document.createElement("button");u.innerText=l.connected?"Disconnect":"Connect",u.addEventListener("click",d=>{l.connected?l.disconnect():l.connect(),u.innerText=l.connected?"Disconnect":"Connect"}),a.appendChild(u);let c=document.createElement("div");return r.appendChild(c),$e(o,c,1),$e(o,c,5),$e(o,c,10),$e(o,c,50),$e(o,c,1e3),$e(o,c,1e4),o}function co(i,e,t,n){n===void 0&&(n=t);const{state:r,dispatch:s}=i;let o=r.tr.replaceWith(t,n,e);s(o)}function cd(i,e){const{state:t}=i,{selection:n}=t,{from:r,to:s}=n;co(i,e,r,s)}function dd(i,e){const{state:t}=i;let n=t.doc.content.size;co(i,e,n,n)}function fd(i){return i.split(/\n{2,}/).map(n=>Ot.nodes.paragraph.create(null,Ot.text(i)))}function hd(i,e){let t=ed(e).flatMap(n=>fd(n));i.hasFocus()?cd(i,y.from(t)):dd(i,y.from(t))}function $e(i,e,t){let n=document.createElement("button");n.innerHTML="Lorem "+t,n.addEventListener("pointerdown",r=>{r.preventDefault(),hd(i,t)}),e==null||e.appendChild(n)}let fo=[ri("#root"),ri("#root")],Jt=!0;window.addEventListener("scroll",i=>{Jt&&fo.forEach(ii)});{let i=document.getElementById("page_controls");{let e=document.createElement("button");e.innerHTML="Add Editor",e.addEventListener("click",t=>{fo.push(ri("#root"))}),i==null||i.appendChild(e)}{let e="Update Decoration Virtual Window on scroll: ",t=document.createElement("button");t.innerText=e+"On",t.addEventListener("click",n=>{Jt=!Jt,t.innerText=Jt?e+"On":e+"Off"}),i==null||i.appendChild(t)}}
